<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link href="../default.css" type="text/css" rel="stylesheet">
<title> BLOP: container.cc </title>
</head>
<body>

<a href="../index.html" title="Home"> 
<img src="../home.png"  style="border-width:0cm;"> 
</a>
<a href="source.html" title="List of sourcefiles"> 
<img src="../up.png"    style="border-width:0cm;"> 
</a>
 <hr>
<pre>
<a name="__line0"></a>#include "<a href="container.h.html">container.h</a>"
<a name="__line1"></a>#include "<a href="warning.h.html">warning.h</a>"
<a name="__line2"></a>#include "<a href="exc.hh.html">exc.hh</a>"
<a name="__line3"></a>#include &lt;stack&gt;
<a name="__line4"></a>#include &lt;cstdio&gt;
<a name="__line5"></a>#include &lt;algorithm&gt;
<a name="__line6"></a>
<a name="__line7"></a>namespace blop
<a name="__line8"></a>{
<a name="__line9"></a>
<a name="__line10"></a>    grob *container::find(const var &amp;name)
<a name="__line11"></a>    {
<a name="__line12"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i)
<a name="__line13"></a>	{
<a name="__line14"></a>	    if(content_[i]-&gt;name() == name.str()) return content_[i];
<a name="__line15"></a>	    if(container *c = dynamic_cast&lt;container*&gt;(content_[i]))
<a name="__line16"></a>	    {
<a name="__line17"></a>		grob *r = c-&gt;find(name);
<a name="__line18"></a>		if(r) return r;
<a name="__line19"></a>	    }
<a name="__line20"></a>	}
<a name="__line21"></a>	return 0;
<a name="__line22"></a>    }
<a name="__line23"></a>    bool container::find(const grob *p)
<a name="__line24"></a>    {
<a name="__line25"></a>        return( std::find(content_.begin(), content_.end(), p) != content_.end() );
<a name="__line26"></a>    }
<a name="__line27"></a>
<a name="__line28"></a>    void container::update_c_x_(bool left_modified, bool right_modified)
<a name="__line29"></a>    {
<a name="__line30"></a>	<span class=comment>// if the left is modified, we need to update the lmargin or cleft.</span>
<a name="__line31"></a>	<span class=comment>// if any of the last 2 operations on the lmargin was a change of left_,</span>
<a name="__line32"></a>	<span class=comment>// then lmargin_ and cleft_ are set up such that they depend on left_,</span>
<a name="__line33"></a>	<span class=comment>// so there is no need to do anything</span>
<a name="__line34"></a>	if(left_modified)
<a name="__line35"></a>	{
<a name="__line36"></a>	    if(lmargin_history_[0] != Left &amp;&amp; lmargin_history_[1] != Left)
<a name="__line37"></a>	    {
<a name="__line38"></a>		if(lmargin_history_[1] == Cleft)
<a name="__line39"></a>		{
<a name="__line40"></a>		    lmargin_ = !cleft_ - !left_;
<a name="__line41"></a>		}
<a name="__line42"></a>		else
<a name="__line43"></a>		{
<a name="__line44"></a>		    bool cleft_modified, cright_modified;
<a name="__line45"></a>		    set_cleft_(!left_ + !lmargin_, cleft_modified, cright_modified);
<a name="__line46"></a>		}
<a name="__line47"></a>	    }
<a name="__line48"></a>	    if(lmargin_history_[1] != Left)
<a name="__line49"></a>	    {
<a name="__line50"></a>		lmargin_history_[0] = lmargin_history_[1];
<a name="__line51"></a>		lmargin_history_[1] = Left;
<a name="__line52"></a>	    }
<a name="__line53"></a>	}
<a name="__line54"></a>	if(right_modified)
<a name="__line55"></a>	{
<a name="__line56"></a>	    if(rmargin_history_[0] != Right &amp;&amp; rmargin_history_[1] != Right)
<a name="__line57"></a>	    {
<a name="__line58"></a>		if(rmargin_history_[1] == Cright)
<a name="__line59"></a>		{
<a name="__line60"></a>		    rmargin_ = !right_ - !cright_;
<a name="__line61"></a>		}
<a name="__line62"></a>		else
<a name="__line63"></a>		{
<a name="__line64"></a>		    bool cleft_modified, cright_modified;
<a name="__line65"></a>		    set_cright_(!right_ - !rmargin_, cleft_modified, cright_modified);
<a name="__line66"></a>		}
<a name="__line67"></a>	    }
<a name="__line68"></a>	    if(rmargin_history_[1] != Right)
<a name="__line69"></a>	    {
<a name="__line70"></a>		rmargin_history_[0] = rmargin_history_[1];
<a name="__line71"></a>		rmargin_history_[1] = Right;
<a name="__line72"></a>	    }
<a name="__line73"></a>	}
<a name="__line74"></a>
<a name="__line75"></a>    }
<a name="__line76"></a>
<a name="__line77"></a>    void container::update_c_y_(bool bottom_modified, bool top_modified)
<a name="__line78"></a>    {
<a name="__line79"></a>	if(bottom_modified)
<a name="__line80"></a>	{
<a name="__line81"></a>	    if(bmargin_history_[0] != Bottom &amp;&amp; bmargin_history_[1] != Bottom)
<a name="__line82"></a>	    {
<a name="__line83"></a>		if(bmargin_history_[1] == Cbottom)
<a name="__line84"></a>		{
<a name="__line85"></a>		    bmargin_ = !cbottom_ - !bottom_;
<a name="__line86"></a>		}
<a name="__line87"></a>		else
<a name="__line88"></a>		{
<a name="__line89"></a>		    bool cbottom_modified, ctop_modified;
<a name="__line90"></a>		    set_cbottom_(!bottom_ + !bmargin_, cbottom_modified, ctop_modified);
<a name="__line91"></a>		}
<a name="__line92"></a>	    }
<a name="__line93"></a>	    if(bmargin_history_[1] != Bottom)
<a name="__line94"></a>	    {
<a name="__line95"></a>		bmargin_history_[0] = bmargin_history_[1];
<a name="__line96"></a>		bmargin_history_[1] = Bottom;
<a name="__line97"></a>	    }
<a name="__line98"></a>	}
<a name="__line99"></a>	if(top_modified)
<a name="__line100"></a>	{
<a name="__line101"></a>	    if(tmargin_history_[0] != Top &amp;&amp; tmargin_history_[1] != Top)
<a name="__line102"></a>	    {
<a name="__line103"></a>		if(tmargin_history_[1] == Ctop)
<a name="__line104"></a>		{
<a name="__line105"></a>		    tmargin_ = !top_ - !ctop_;
<a name="__line106"></a>		}
<a name="__line107"></a>		else
<a name="__line108"></a>		{
<a name="__line109"></a>		    bool cbottom_modified, ctop_modified;
<a name="__line110"></a>		    set_ctop_(!top_ - !tmargin_, cbottom_modified, ctop_modified);
<a name="__line111"></a>		}
<a name="__line112"></a>	    }
<a name="__line113"></a>	    if(tmargin_history_[1] != Top)
<a name="__line114"></a>	    {
<a name="__line115"></a>		tmargin_history_[0] = tmargin_history_[1];
<a name="__line116"></a>		tmargin_history_[1] = Top;
<a name="__line117"></a>	    }
<a name="__line118"></a>	}
<a name="__line119"></a>    }
<a name="__line120"></a>
<a name="__line121"></a>
<a name="__line122"></a>    void container::update_x_(bool cleft_modified, bool cright_modified)
<a name="__line123"></a>    {
<a name="__line124"></a>	<span class=comment>// if the cleft is modified, we need to update the lmargin and left.</span>
<a name="__line125"></a>	<span class=comment>// if any of the last 2 operations on the lmargin was a change of cleft_,</span>
<a name="__line126"></a>	<span class=comment>// then lmargin_ and left_ are set up such that they depend on cleft_,</span>
<a name="__line127"></a>	<span class=comment>// so there is no need to do anything</span>
<a name="__line128"></a>	if(cleft_modified)
<a name="__line129"></a>	{
<a name="__line130"></a>	    if(lmargin_history_[0] != Cleft &amp;&amp; lmargin_history_[1] != Cleft)
<a name="__line131"></a>	    {
<a name="__line132"></a>		if(lmargin_history_[1] == Left)
<a name="__line133"></a>		{
<a name="__line134"></a>		    lmargin_ = !cleft_ - !left_;
<a name="__line135"></a>		}
<a name="__line136"></a>		else
<a name="__line137"></a>		{
<a name="__line138"></a>		    bool left_modified, right_modified;
<a name="__line139"></a>		    set_left_(!cleft_ - !lmargin_, left_modified, right_modified);
<a name="__line140"></a>		}
<a name="__line141"></a>	    }
<a name="__line142"></a>	    if(lmargin_history_[1] != Cleft)
<a name="__line143"></a>	    {
<a name="__line144"></a>		lmargin_history_[0] = lmargin_history_[1];
<a name="__line145"></a>		lmargin_history_[1] = Cleft;
<a name="__line146"></a>	    }
<a name="__line147"></a>	}
<a name="__line148"></a>	if(cright_modified)
<a name="__line149"></a>	{
<a name="__line150"></a>	    if(rmargin_history_[0] != Cright &amp;&amp; rmargin_history_[1] != Cright)
<a name="__line151"></a>	    {
<a name="__line152"></a>		if(rmargin_history_[1] == Right)
<a name="__line153"></a>		{
<a name="__line154"></a>		    rmargin_ = !right_ - !cright_;
<a name="__line155"></a>		}
<a name="__line156"></a>		else
<a name="__line157"></a>		{
<a name="__line158"></a>		    bool left_modified, right_modified;
<a name="__line159"></a>		    set_right_(!cright_ + !rmargin_, left_modified, right_modified);
<a name="__line160"></a>		}
<a name="__line161"></a>	    }
<a name="__line162"></a>	    if(rmargin_history_[1] != Cright)
<a name="__line163"></a>	    {
<a name="__line164"></a>		rmargin_history_[0] = rmargin_history_[1];
<a name="__line165"></a>		rmargin_history_[1] = Cright;
<a name="__line166"></a>	    }
<a name="__line167"></a>	}
<a name="__line168"></a>	
<a name="__line169"></a>    }
<a name="__line170"></a>
<a name="__line171"></a>    void container::update_y_(bool cbottom_modified, bool ctop_modified)
<a name="__line172"></a>    {
<a name="__line173"></a>	if(cbottom_modified)
<a name="__line174"></a>	{
<a name="__line175"></a>	    if(bmargin_history_[0] != Cbottom &amp;&amp; bmargin_history_[1] != Cbottom)
<a name="__line176"></a>	    {
<a name="__line177"></a>		if(bmargin_history_[1] == Bottom)
<a name="__line178"></a>		{
<a name="__line179"></a>		    bmargin_ = !cbottom_ - !bottom_;
<a name="__line180"></a>		}
<a name="__line181"></a>		else
<a name="__line182"></a>		{
<a name="__line183"></a>		    bool bottom_modified, top_modified;
<a name="__line184"></a>		    set_bottom_(!cbottom_ - !bmargin_, bottom_modified, top_modified);
<a name="__line185"></a>		}
<a name="__line186"></a>	    }
<a name="__line187"></a>	    if(bmargin_history_[1] != Cbottom)
<a name="__line188"></a>	    {
<a name="__line189"></a>		bmargin_history_[0] = bmargin_history_[1];
<a name="__line190"></a>		bmargin_history_[1] = Cbottom;
<a name="__line191"></a>	    }
<a name="__line192"></a>	}
<a name="__line193"></a>	if(ctop_modified)
<a name="__line194"></a>	{
<a name="__line195"></a>	    if(tmargin_history_[0] != Ctop &amp;&amp; tmargin_history_[1] != Ctop)
<a name="__line196"></a>	    {
<a name="__line197"></a>		if(tmargin_history_[1] == Top)
<a name="__line198"></a>		{
<a name="__line199"></a>		    tmargin_ = !top_ - !ctop_;
<a name="__line200"></a>		}
<a name="__line201"></a>		else
<a name="__line202"></a>		{
<a name="__line203"></a>		    bool bottom_modified, top_modified;
<a name="__line204"></a>		    set_top_(!ctop_ + !tmargin_, bottom_modified, top_modified);
<a name="__line205"></a>		}
<a name="__line206"></a>	    }
<a name="__line207"></a>	    if(tmargin_history_[1] != Ctop)
<a name="__line208"></a>	    {
<a name="__line209"></a>		tmargin_history_[0] = tmargin_history_[1];
<a name="__line210"></a>		tmargin_history_[1] = Ctop;
<a name="__line211"></a>	    }
<a name="__line212"></a>	}
<a name="__line213"></a>    }
<a name="__line214"></a>
<a name="__line215"></a>    void container::set_cleft_(const length &amp;l, bool &amp;cleft_modified, bool &amp;cright_modified)
<a name="__line216"></a>    {
<a name="__line217"></a>	modified_ = true;
<a name="__line218"></a>	box::set_(l,cleft_,cright_,cwidth_,cxcenter_,false,cxhistory_,LeftBottom,
<a name="__line219"></a>		  cleft_modified,cright_modified);
<a name="__line220"></a>    }
<a name="__line221"></a>    void container::set_cright_(const length &amp;l, bool &amp;cleft_modified, bool &amp;cright_modified)
<a name="__line222"></a>    {
<a name="__line223"></a>	modified_ = true;
<a name="__line224"></a>	box::set_(l,cleft_,cright_,cwidth_,cxcenter_,false,cxhistory_,RightTop,
<a name="__line225"></a>		  cleft_modified,cright_modified);
<a name="__line226"></a>    }
<a name="__line227"></a>    void container::set_cwidth_(const length &amp;l, bool &amp;cleft_modified, bool &amp;cright_modified)
<a name="__line228"></a>    {
<a name="__line229"></a>	modified_ = true;
<a name="__line230"></a>	box::set_(l,cleft_,cright_,cwidth_,cxcenter_,false,cxhistory_,WidthHeight,
<a name="__line231"></a>		  cleft_modified,cright_modified);
<a name="__line232"></a>    }
<a name="__line233"></a>    void container::set_cxcenter_(const length &amp;l, bool &amp;cleft_modified, bool &amp;cright_modified)
<a name="__line234"></a>    {
<a name="__line235"></a>	modified_ = true;
<a name="__line236"></a>	box::set_(l,cleft_,cright_,cwidth_,cxcenter_,false,cxhistory_,Center,
<a name="__line237"></a>		  cleft_modified,cright_modified);
<a name="__line238"></a>    }
<a name="__line239"></a>
<a name="__line240"></a>
<a name="__line241"></a>    void container::set_cbottom_(const length &amp;l, bool &amp;cbottom_modified, bool &amp;ctop_modified)
<a name="__line242"></a>    {
<a name="__line243"></a>	modified_ = true;
<a name="__line244"></a>	box::set_(l,cbottom_,ctop_,cheight_,cycenter_,false,cyhistory_,LeftBottom,
<a name="__line245"></a>		  cbottom_modified,ctop_modified);
<a name="__line246"></a>    }
<a name="__line247"></a>    void container::set_ctop_(const length &amp;l, bool &amp;cbottom_modified, bool &amp;ctop_modified)
<a name="__line248"></a>    {
<a name="__line249"></a>	modified_ = true;
<a name="__line250"></a>	box::set_(l,cbottom_,ctop_,cheight_,cycenter_,false,cyhistory_,RightTop,
<a name="__line251"></a>		  cbottom_modified,ctop_modified);
<a name="__line252"></a>    }
<a name="__line253"></a>    void container::set_cheight_(const length &amp;l,bool &amp;cbottom_modified, bool &amp;ctop_modified)
<a name="__line254"></a>    {
<a name="__line255"></a>	modified_ = true;
<a name="__line256"></a>	box::set_(l,cbottom_,ctop_,cheight_,cycenter_,false,cyhistory_,WidthHeight,
<a name="__line257"></a>		  cbottom_modified,ctop_modified);
<a name="__line258"></a>    }
<a name="__line259"></a>    void container::set_cycenter_(const length &amp;l,bool &amp;cbottom_modified,bool &amp;ctop_modified)
<a name="__line260"></a>    {
<a name="__line261"></a>	modified_ = true;
<a name="__line262"></a>	box::set_(l,cbottom_,ctop_,cheight_,cycenter_,false,cyhistory_,Center,
<a name="__line263"></a>		  cbottom_modified,ctop_modified);
<a name="__line264"></a>    }
<a name="__line265"></a>
<a name="__line266"></a>
<a name="__line267"></a>    container &amp;container::left(const length &amp;l)
<a name="__line268"></a>    {
<a name="__line269"></a>	bool left_modified, right_modified;
<a name="__line270"></a>	set_left_(l,left_modified, right_modified);
<a name="__line271"></a>	update_c_x_(left_modified, right_modified);
<a name="__line272"></a>	return *this;
<a name="__line273"></a>    }
<a name="__line274"></a>
<a name="__line275"></a>    container &amp;container::right(const length &amp;l)
<a name="__line276"></a>    {
<a name="__line277"></a>	bool left_modified, right_modified;
<a name="__line278"></a>	set_right_(l,left_modified, right_modified);
<a name="__line279"></a>	update_c_x_(left_modified, right_modified);
<a name="__line280"></a>	return *this;
<a name="__line281"></a>    }
<a name="__line282"></a>
<a name="__line283"></a>    container &amp;container::width(const length &amp;l)
<a name="__line284"></a>    {
<a name="__line285"></a>	bool left_modified, right_modified;
<a name="__line286"></a>	set_width_(l,left_modified, right_modified);
<a name="__line287"></a>	update_c_x_(left_modified, right_modified);
<a name="__line288"></a>	return *this;
<a name="__line289"></a>    }
<a name="__line290"></a>
<a name="__line291"></a>    container &amp;container::xcenter(const length &amp;l)
<a name="__line292"></a>    {
<a name="__line293"></a>	bool left_modified, right_modified;
<a name="__line294"></a>	set_xcenter_(l,left_modified, right_modified);
<a name="__line295"></a>	update_c_x_(left_modified, right_modified);
<a name="__line296"></a>	return *this;
<a name="__line297"></a>    }
<a name="__line298"></a>
<a name="__line299"></a>
<a name="__line300"></a>
<a name="__line301"></a>    container &amp;container::bottom(const length &amp;l)
<a name="__line302"></a>    {
<a name="__line303"></a>	bool bottom_modified, top_modified;
<a name="__line304"></a>	set_bottom_(l,bottom_modified, top_modified);
<a name="__line305"></a>	update_c_y_(bottom_modified, top_modified);
<a name="__line306"></a>	return *this;
<a name="__line307"></a>    }
<a name="__line308"></a>
<a name="__line309"></a>    container &amp;container::top(const length &amp;l)
<a name="__line310"></a>    {
<a name="__line311"></a>	bool bottom_modified, top_modified;
<a name="__line312"></a>	set_top_(l,bottom_modified, top_modified);
<a name="__line313"></a>	update_c_y_(bottom_modified, top_modified);
<a name="__line314"></a>	return *this;
<a name="__line315"></a>    }
<a name="__line316"></a>
<a name="__line317"></a>    container &amp;container::height(const length &amp;l)
<a name="__line318"></a>    {
<a name="__line319"></a>	bool bottom_modified, top_modified;
<a name="__line320"></a>	set_height_(l,bottom_modified, top_modified);
<a name="__line321"></a>	update_c_y_(bottom_modified, top_modified);
<a name="__line322"></a>	return *this;
<a name="__line323"></a>    }
<a name="__line324"></a>
<a name="__line325"></a>    container &amp;container::ycenter(const length &amp;l)
<a name="__line326"></a>    {
<a name="__line327"></a>	bool bottom_modified, top_modified;
<a name="__line328"></a>	set_ycenter_(l,bottom_modified, top_modified);
<a name="__line329"></a>	update_c_y_(bottom_modified, top_modified);
<a name="__line330"></a>	return *this;
<a name="__line331"></a>    }
<a name="__line332"></a>
<a name="__line333"></a>    <span class=comment>// Change the container (inner) sizes</span>
<a name="__line334"></a>
<a name="__line335"></a>    container &amp;container::cleft(const length &amp;l)
<a name="__line336"></a>    {
<a name="__line337"></a>	if(caspect_ &gt; 0)
<a name="__line338"></a>	{
<a name="__line339"></a>	    warning::print("Can not set cleft if caspect is fixed");
<a name="__line340"></a>	    return *this;
<a name="__line341"></a>	}
<a name="__line342"></a>	bool cleft_modified, cright_modified;
<a name="__line343"></a>	set_cleft_(l,cleft_modified, cright_modified);
<a name="__line344"></a>	update_x_(cleft_modified, cright_modified);
<a name="__line345"></a>	return *this;
<a name="__line346"></a>    }
<a name="__line347"></a>    container &amp;container::cright(const length &amp;l)
<a name="__line348"></a>    {
<a name="__line349"></a>	if(caspect_ &gt; 0)
<a name="__line350"></a>	{
<a name="__line351"></a>	    warning::print("Can not set cright if caspect is fixed");
<a name="__line352"></a>	    return *this;
<a name="__line353"></a>	}
<a name="__line354"></a>	bool cleft_modified, cright_modified;
<a name="__line355"></a>	set_cright_(l,cleft_modified, cright_modified);
<a name="__line356"></a>	update_x_(cleft_modified, cright_modified);
<a name="__line357"></a>	return *this;
<a name="__line358"></a>    }
<a name="__line359"></a>    container &amp;container::cwidth(const length &amp;l)
<a name="__line360"></a>    {
<a name="__line361"></a>	if(caspect_ &gt; 0)
<a name="__line362"></a>	{
<a name="__line363"></a>	    warning::print("Can not set cwidth if caspect is fixed");
<a name="__line364"></a>	    return *this;
<a name="__line365"></a>	}
<a name="__line366"></a>	bool cleft_modified, cright_modified;
<a name="__line367"></a>	set_cwidth_(l,cleft_modified, cright_modified);
<a name="__line368"></a>	update_x_(cleft_modified, cright_modified);
<a name="__line369"></a>	return *this;
<a name="__line370"></a>    }
<a name="__line371"></a>    container &amp;container::cxcenter(const length &amp;l)
<a name="__line372"></a>    {
<a name="__line373"></a>	if(caspect_ &gt; 0)
<a name="__line374"></a>	{
<a name="__line375"></a>	    warning::print("Can not set cxcenter if caspect is fixed");
<a name="__line376"></a>	    return *this;
<a name="__line377"></a>	}
<a name="__line378"></a>	bool cleft_modified, cright_modified;
<a name="__line379"></a>	set_cxcenter_(l,cleft_modified, cright_modified);
<a name="__line380"></a>	update_x_(cleft_modified, cright_modified);
<a name="__line381"></a>	return *this;
<a name="__line382"></a>    }
<a name="__line383"></a>
<a name="__line384"></a>
<a name="__line385"></a>    container &amp;container::cbottom(const length &amp;l)
<a name="__line386"></a>    {
<a name="__line387"></a>	if(caspect_ &gt; 0)
<a name="__line388"></a>	{
<a name="__line389"></a>	    warning::print("Can not set cbottom if caspect is fixed");
<a name="__line390"></a>	    return *this;
<a name="__line391"></a>	}
<a name="__line392"></a>	bool cbottom_modified, ctop_modified;
<a name="__line393"></a>	set_cbottom_(l,cbottom_modified, ctop_modified);
<a name="__line394"></a>	update_y_(cbottom_modified, ctop_modified);
<a name="__line395"></a>	return *this;
<a name="__line396"></a>    }
<a name="__line397"></a>    container &amp;container::ctop(const length &amp;l)
<a name="__line398"></a>    {
<a name="__line399"></a>	if(caspect_ &gt; 0)
<a name="__line400"></a>	{
<a name="__line401"></a>	    warning::print("Can not set ctop if caspect is fixed");
<a name="__line402"></a>	    return *this;
<a name="__line403"></a>	}
<a name="__line404"></a>	bool cbottom_modified, ctop_modified;
<a name="__line405"></a>	set_ctop_(l,cbottom_modified, ctop_modified);
<a name="__line406"></a>	update_y_(cbottom_modified, ctop_modified);
<a name="__line407"></a>	return *this;
<a name="__line408"></a>    }
<a name="__line409"></a>    container &amp;container::cheight(const length &amp;l)
<a name="__line410"></a>    {
<a name="__line411"></a>	if(caspect_ &gt; 0)
<a name="__line412"></a>	{
<a name="__line413"></a>	    warning::print("Can not set cheight if caspect is fixed");
<a name="__line414"></a>	    return *this;
<a name="__line415"></a>	}
<a name="__line416"></a>	bool cbottom_modified, ctop_modified;
<a name="__line417"></a>	set_cheight_(l,cbottom_modified, ctop_modified);
<a name="__line418"></a>	update_y_(cbottom_modified, ctop_modified);
<a name="__line419"></a>	return *this;
<a name="__line420"></a>    }
<a name="__line421"></a>    container &amp;container::cycenter(const length &amp;l)
<a name="__line422"></a>    {
<a name="__line423"></a>	if(caspect_ &gt; 0)
<a name="__line424"></a>	{
<a name="__line425"></a>	    warning::print("Can not set cycenter if caspect is fixed");
<a name="__line426"></a>	    return *this;
<a name="__line427"></a>	}
<a name="__line428"></a>	bool cbottom_modified, ctop_modified;
<a name="__line429"></a>	set_cycenter_(l,cbottom_modified, ctop_modified);
<a name="__line430"></a>	update_y_(cbottom_modified, ctop_modified);
<a name="__line431"></a>	return *this;
<a name="__line432"></a>    }
<a name="__line433"></a>
<a name="__line434"></a>    static bool length_depends_on_any(const length &amp;l, length* d[], int n)
<a name="__line435"></a>    {
<a name="__line436"></a>	for(int i=0; i&lt;n; ++i)
<a name="__line437"></a>	{
<a name="__line438"></a>	    if(l.depends_on(*(d[i]))) return true;
<a name="__line439"></a>	}
<a name="__line440"></a>	return false;
<a name="__line441"></a>    }
<a name="__line442"></a>
<a name="__line443"></a>    container &amp;container::caspect(double r)
<a name="__line444"></a>    {
<a name="__line445"></a>	<span class=comment>// relax the ratio lock, if r is negative</span>
<a name="__line446"></a>	if(r&lt;=0)
<a name="__line447"></a>	{
<a name="__line448"></a>	    caspect_ = r;
<a name="__line449"></a>	    return *this;
<a name="__line450"></a>	}
<a name="__line451"></a>	
<a name="__line452"></a>
<a name="__line453"></a>	length *d[] = {&amp;cleft_, &amp;cright_, &amp;cwidth_, &amp;cxcenter_,
<a name="__line454"></a>		       &amp;cbottom_, &amp;ctop_, &amp;cheight_, &amp;cycenter_};
<a name="__line455"></a>	if(length_depends_on_any(lmargin_,d,8) ||
<a name="__line456"></a>	   length_depends_on_any(rmargin_,d,8) ||
<a name="__line457"></a>	   length_depends_on_any(bmargin_,d,8) ||
<a name="__line458"></a>	   length_depends_on_any(tmargin_,d,8))
<a name="__line459"></a>	{
<a name="__line460"></a>	    warning::print("To fix the caspect, the margins should not depends on "
<a name="__line461"></a>			   "any of cwidth, cleft, etc...");
<a name="__line462"></a>	    return *this;
<a name="__line463"></a>	}
<a name="__line464"></a>
<a name="__line465"></a>	caspect_ = r;
<a name="__line466"></a>
<a name="__line467"></a>	<span class=comment>/*
<a name="__line468"></a>	length csize_for_caspect = length::min(
<a name="__line469"></a>	    !width_ - (cx_lock_==sym::right?rmargin_:lmargin_),
<a name="__line470"></a>	    (!height_ - (cy_lock_==sym::top?tmargin_:bmargin_))/caspect_);
<a name="__line471"></a>	*/</span>
<a name="__line472"></a>	length csize_for_caspect = length::min(
<a name="__line473"></a>	    !width_ - lmargin_ - rmargin_,
<a name="__line474"></a>	    (!height_ - bmargin_ - tmargin_)/caspect_);
<a name="__line475"></a>
<a name="__line476"></a>	if(cx_lock_==sym::right)
<a name="__line477"></a>	{
<a name="__line478"></a>	    lmargin_ = !width_ - rmargin_ - csize_for_caspect;
<a name="__line479"></a>	    lmargin_history_[0] = Left;
<a name="__line480"></a>	    lmargin_history_[1] = Lmargin;
<a name="__line481"></a>
<a name="__line482"></a>	    cleft_  = !left_  + !lmargin_;
<a name="__line483"></a>	    cright_ = !right_ - !rmargin_;
<a name="__line484"></a>	    cwidth_ = !cright_ - !cleft_;
<a name="__line485"></a>	    cxhistory_[0] = LeftBottom;
<a name="__line486"></a>	    cxhistory_[1] = RightTop;
<a name="__line487"></a>
<a name="__line488"></a>	    rmargin_history_[0] = Rmargin;
<a name="__line489"></a>	    rmargin_history_[1] = Rmargin;
<a name="__line490"></a>	}
<a name="__line491"></a>	else
<a name="__line492"></a>	{
<a name="__line493"></a>	    rmargin_ = !width_ - lmargin_ - csize_for_caspect;
<a name="__line494"></a>	    rmargin_history_[0] = Right;
<a name="__line495"></a>	    rmargin_history_[1] = Rmargin;
<a name="__line496"></a>
<a name="__line497"></a>	    cleft_  = !left_  + !lmargin_;
<a name="__line498"></a>	    cright_ = !right_ - !rmargin_;
<a name="__line499"></a>	    cwidth_ = !cright_ - !cleft_;
<a name="__line500"></a>	    cxhistory_[0] = RightTop;
<a name="__line501"></a>	    cxhistory_[1] = LeftBottom;
<a name="__line502"></a>
<a name="__line503"></a>	    lmargin_history_[0] = Lmargin;
<a name="__line504"></a>	    lmargin_history_[1] = Lmargin;
<a name="__line505"></a>
<a name="__line506"></a>	}
<a name="__line507"></a>	cxcenter_ = 0.5*(!cleft_+!cright_);
<a name="__line508"></a>
<a name="__line509"></a>	if(cy_lock_==sym::top)
<a name="__line510"></a>	{
<a name="__line511"></a>	    bmargin_ = !height_ - tmargin_ - csize_for_caspect*caspect_;
<a name="__line512"></a>	    bmargin_history_[0] = Bottom;
<a name="__line513"></a>	    bmargin_history_[1] = Bmargin;
<a name="__line514"></a>
<a name="__line515"></a>	    cbottom_ = !bottom_ + !bmargin_;
<a name="__line516"></a>	    ctop_    = !top_    - !tmargin_;
<a name="__line517"></a>	    cheight_ = !ctop_ - !cbottom_;
<a name="__line518"></a>	    cyhistory_[0] = LeftBottom;
<a name="__line519"></a>	    cyhistory_[1] = RightTop;
<a name="__line520"></a>
<a name="__line521"></a>	    tmargin_history_[0] = Tmargin;
<a name="__line522"></a>	    tmargin_history_[1] = Tmargin;
<a name="__line523"></a>	}
<a name="__line524"></a>	else
<a name="__line525"></a>	{
<a name="__line526"></a>	    tmargin_ = !height_ - bmargin_ - csize_for_caspect*caspect_;
<a name="__line527"></a>	    tmargin_history_[0] = Top;
<a name="__line528"></a>	    tmargin_history_[1] = Tmargin;
<a name="__line529"></a>
<a name="__line530"></a>	    cbottom_  = !bottom_ + !bmargin_;
<a name="__line531"></a>	    ctop_     = !top_    - !tmargin_;
<a name="__line532"></a>	    cheight_  = !ctop_ - !cbottom_;
<a name="__line533"></a>	    cyhistory_[0] = RightTop;
<a name="__line534"></a>	    cyhistory_[1] = LeftBottom;
<a name="__line535"></a>
<a name="__line536"></a>	    bmargin_history_[0] = Bmargin;
<a name="__line537"></a>	    bmargin_history_[1] = Bmargin;
<a name="__line538"></a>
<a name="__line539"></a>	}
<a name="__line540"></a>	cycenter_ = 0.5*(!cbottom_ + !ctop_);
<a name="__line541"></a>
<a name="__line542"></a>	return *this;
<a name="__line543"></a>    }
<a name="__line544"></a>
<a name="__line545"></a>    container &amp;container::cxlock(sym::position a)
<a name="__line546"></a>    {
<a name="__line547"></a>	cerr&lt;&lt;"Do not call container::cxlock yet"&lt;&lt;endl;
<a name="__line548"></a>	<span class=comment>//cx_lock_ = a;</span>
<a name="__line549"></a>	return *this;
<a name="__line550"></a>    }
<a name="__line551"></a>    container &amp;container::cylock(sym::position a)
<a name="__line552"></a>    {
<a name="__line553"></a>	cerr&lt;&lt;"Do not call container::cylock yet"&lt;&lt;endl;
<a name="__line554"></a>	<span class=comment>//cy_lock_ = a;</span>
<a name="__line555"></a>	return *this;
<a name="__line556"></a>    }
<a name="__line557"></a>    
<a name="__line558"></a>    container &amp;container::margins(const length &amp;l)
<a name="__line559"></a>    {
<a name="__line560"></a>	lmargin(l);
<a name="__line561"></a>	rmargin(l);
<a name="__line562"></a>	bmargin(l);
<a name="__line563"></a>	tmargin(l);
<a name="__line564"></a>	return *this;
<a name="__line565"></a>    }
<a name="__line566"></a>
<a name="__line567"></a>    void container::set_lmargin_(const length &amp;l)
<a name="__line568"></a>    {
<a name="__line569"></a>	modified_ = true;
<a name="__line570"></a>	lmargin_ = l;
<a name="__line571"></a>	if(lmargin_history_[0] != Lmargin &amp;&amp; lmargin_history_[1] != Lmargin)
<a name="__line572"></a>	{
<a name="__line573"></a>	    bool dummy1, dummy2;
<a name="__line574"></a>	    if(lmargin_history_[1] == container::Left)
<a name="__line575"></a>	    {
<a name="__line576"></a>		set_cleft_(!left_ + !lmargin_, dummy1, dummy2);
<a name="__line577"></a>	    }
<a name="__line578"></a>	    else if(lmargin_history_[1] == container::Cleft)
<a name="__line579"></a>	    {
<a name="__line580"></a>		set_left_(!cleft_ - !lmargin_, dummy1, dummy2);
<a name="__line581"></a>	    }
<a name="__line582"></a>	}
<a name="__line583"></a>	if(lmargin_history_[1] != container::Lmargin)
<a name="__line584"></a>	{
<a name="__line585"></a>	    lmargin_history_[0] = lmargin_history_[1];
<a name="__line586"></a>	    lmargin_history_[1] = Lmargin;
<a name="__line587"></a>	}
<a name="__line588"></a>    }
<a name="__line589"></a>
<a name="__line590"></a>    container &amp;container::lmargin(const length &amp;l)
<a name="__line591"></a>    {
<a name="__line592"></a>	<span class=comment>// if no caspect is defined, simply set the lmargin</span>
<a name="__line593"></a>	if(caspect_&lt;=0)
<a name="__line594"></a>	{
<a name="__line595"></a>	    set_lmargin_(l);
<a name="__line596"></a>	    return *this;
<a name="__line597"></a>	}
<a name="__line598"></a>
<a name="__line599"></a>	if(l.depends_on(cwidth()) ||
<a name="__line600"></a>	   l.depends_on(cxcenter()) ||
<a name="__line601"></a>	   l.depends_on(cleft()) ||
<a name="__line602"></a>	   l.depends_on(cright()))
<a name="__line603"></a>	{
<a name="__line604"></a>	    warning::print("With a fixed caspect, lmargin can not depend on "
<a name="__line605"></a>			   "cwidth, cxcenter, cleft or cright");
<a name="__line606"></a>	    return *this;
<a name="__line607"></a>	}
<a name="__line608"></a>
<a name="__line609"></a>	length csize_for_caspect;
<a name="__line610"></a>	if(cx_lock_==sym::right)
<a name="__line611"></a>	{
<a name="__line612"></a>	    csize_for_caspect = length::min(
<a name="__line613"></a>		!width_ - rmargin_ - l,
<a name="__line614"></a>		(!height_ - (cy_lock_==sym::top?tmargin_:bmargin_))/caspect_);
<a name="__line615"></a>	    lmargin_ = !width_ - rmargin_ - csize_for_caspect;
<a name="__line616"></a>	}
<a name="__line617"></a>	else
<a name="__line618"></a>	{
<a name="__line619"></a>	    lmargin_ = l;
<a name="__line620"></a>	    csize_for_caspect = length::min(
<a name="__line621"></a>		!width_ - lmargin_ - rmargin_,
<a name="__line622"></a>		(!height_ - (cy_lock_==sym::top?tmargin_:bmargin_))/caspect_);
<a name="__line623"></a>	    rmargin_ = !width_ - lmargin_ - csize_for_caspect;
<a name="__line624"></a>	}
<a name="__line625"></a>	if(cy_lock_ == sym::top) bmargin_ = !height_ - tmargin_ - csize_for_caspect*caspect_;
<a name="__line626"></a>	else                     tmargin_ = !height_ - bmargin_ - csize_for_caspect*caspect_;
<a name="__line627"></a>	return *this;
<a name="__line628"></a>    }
<a name="__line629"></a>
<a name="__line630"></a>    void container::set_rmargin_(const length &amp;l)
<a name="__line631"></a>    {
<a name="__line632"></a>	modified_ = true;
<a name="__line633"></a>	rmargin_ = l;
<a name="__line634"></a>	
<a name="__line635"></a>	if(rmargin_history_[0] != Rmargin &amp;&amp; rmargin_history_[1] != Rmargin)
<a name="__line636"></a>	{
<a name="__line637"></a>	    bool dummy1, dummy2;
<a name="__line638"></a>	    if(rmargin_history_[1] == container::Right)
<a name="__line639"></a>	    {
<a name="__line640"></a>		set_cright_(!right_ - !rmargin_, dummy1, dummy2);
<a name="__line641"></a>	    }
<a name="__line642"></a>	    else if(rmargin_history_[1] == container::Cright)
<a name="__line643"></a>	    {
<a name="__line644"></a>		set_right_(!cright_ + !rmargin_, dummy1, dummy2);
<a name="__line645"></a>	    }
<a name="__line646"></a>	}
<a name="__line647"></a>	if(rmargin_history_[1] != container::Rmargin)
<a name="__line648"></a>	{
<a name="__line649"></a>	    rmargin_history_[0] = rmargin_history_[1];
<a name="__line650"></a>	    rmargin_history_[1] = Rmargin;
<a name="__line651"></a>	}
<a name="__line652"></a>    }
<a name="__line653"></a>
<a name="__line654"></a>    container &amp;container::rmargin(const length &amp;l)
<a name="__line655"></a>    {
<a name="__line656"></a>	if(caspect_&lt;=0)
<a name="__line657"></a>	{
<a name="__line658"></a>	    set_rmargin_(l);
<a name="__line659"></a>	    return *this;
<a name="__line660"></a>	}
<a name="__line661"></a>
<a name="__line662"></a>	if(l.depends_on(cwidth()) ||
<a name="__line663"></a>	   l.depends_on(cxcenter()) ||
<a name="__line664"></a>	   l.depends_on(cleft()) ||
<a name="__line665"></a>	   l.depends_on(cright()))
<a name="__line666"></a>	{
<a name="__line667"></a>	    warning::print("With a fixed caspect, rmargin can not depend on cwidth, cxcenter, cleft or cright");
<a name="__line668"></a>	    return *this;
<a name="__line669"></a>	}
<a name="__line670"></a>
<a name="__line671"></a>	length csize_for_caspect;
<a name="__line672"></a>	if(cx_lock_==sym::right)
<a name="__line673"></a>	{
<a name="__line674"></a>	    rmargin_ = l;
<a name="__line675"></a>	    csize_for_caspect = length::min(
<a name="__line676"></a>		!width_ - lmargin_ - rmargin_,
<a name="__line677"></a>		(!height_ - (cy_lock_==sym::top?tmargin_:bmargin_))/caspect_);
<a name="__line678"></a>	    lmargin_ = !width_ - rmargin_ - csize_for_caspect;
<a name="__line679"></a>	}
<a name="__line680"></a>	else
<a name="__line681"></a>	{
<a name="__line682"></a>	    csize_for_caspect = length::min(
<a name="__line683"></a>		!width_ - lmargin_ - l,
<a name="__line684"></a>		(!height_ - (cy_lock_==sym::top?tmargin_:bmargin_))/caspect_);
<a name="__line685"></a>	    rmargin_ = !width_ - lmargin_ - csize_for_caspect;
<a name="__line686"></a>	}
<a name="__line687"></a>	if(cy_lock_ == sym::top) bmargin_ = !height_ - tmargin_ - csize_for_caspect*caspect_;
<a name="__line688"></a>	else                     tmargin_ = !height_ - bmargin_ - csize_for_caspect*caspect_;
<a name="__line689"></a>
<a name="__line690"></a>	return *this;
<a name="__line691"></a>    }
<a name="__line692"></a>
<a name="__line693"></a>    void container::set_bmargin_(const length &amp;l)
<a name="__line694"></a>    {
<a name="__line695"></a>	modified_ = true;
<a name="__line696"></a>	bmargin_ = l;
<a name="__line697"></a>	if(bmargin_history_[0] != Bmargin &amp;&amp; bmargin_history_[1] != Bmargin)
<a name="__line698"></a>	{
<a name="__line699"></a>	    bool dummy1, dummy2;
<a name="__line700"></a>	    if(bmargin_history_[1] == container::Bottom)
<a name="__line701"></a>	    {
<a name="__line702"></a>		set_cbottom_(!bottom_ + !bmargin_, dummy1, dummy2);
<a name="__line703"></a>	    }
<a name="__line704"></a>	    else if(bmargin_history_[1] == container::Cbottom)
<a name="__line705"></a>	    {
<a name="__line706"></a>		set_bottom_(!cbottom_ - !bmargin_, dummy1, dummy2);
<a name="__line707"></a>	    }
<a name="__line708"></a>	}
<a name="__line709"></a>	if(bmargin_history_[1] != container::Bmargin)
<a name="__line710"></a>	{
<a name="__line711"></a>	    bmargin_history_[0] = bmargin_history_[1];
<a name="__line712"></a>	    bmargin_history_[1] = Bmargin;
<a name="__line713"></a>	}
<a name="__line714"></a>    }
<a name="__line715"></a>    container &amp;container::bmargin(const length &amp;l)
<a name="__line716"></a>    {
<a name="__line717"></a>	if(caspect_&lt;=0)
<a name="__line718"></a>	{
<a name="__line719"></a>	    set_bmargin_(l);
<a name="__line720"></a>	    return *this;
<a name="__line721"></a>	}
<a name="__line722"></a>
<a name="__line723"></a>	if(l.depends_on(cheight()) ||
<a name="__line724"></a>	   l.depends_on(cycenter()) ||
<a name="__line725"></a>	   l.depends_on(cbottom()) ||
<a name="__line726"></a>	   l.depends_on(ctop()))
<a name="__line727"></a>	{
<a name="__line728"></a>	    warning::print("With a fixed caspect, bmargin can not depend on cwidth, cxcenter, cleft or cright");
<a name="__line729"></a>	    return *this;
<a name="__line730"></a>	}
<a name="__line731"></a>
<a name="__line732"></a>	length csize_for_caspect;
<a name="__line733"></a>	if(cx_lock_==sym::top)
<a name="__line734"></a>	{
<a name="__line735"></a>	    csize_for_caspect = length::min(
<a name="__line736"></a>		!width_ - (cx_lock_==sym::right?rmargin_:lmargin_),
<a name="__line737"></a>		(!height_ - tmargin_ - l)/caspect_);
<a name="__line738"></a>	    bmargin_ = !height_ - tmargin_ - csize_for_caspect*caspect_;
<a name="__line739"></a>	}
<a name="__line740"></a>	else
<a name="__line741"></a>	{
<a name="__line742"></a>	    bmargin_ = l;
<a name="__line743"></a>	    csize_for_caspect = length::min(
<a name="__line744"></a>		!width_ - (cx_lock_==sym::right?rmargin_:lmargin_),
<a name="__line745"></a>		(!height_ - bmargin_ - tmargin_)/caspect_);
<a name="__line746"></a>	    tmargin_ = !height_ - bmargin_ - csize_for_caspect*caspect_;
<a name="__line747"></a>	}
<a name="__line748"></a>	if(cx_lock_ == sym::right) lmargin_ = !width_ - rmargin_ - csize_for_caspect;
<a name="__line749"></a>	else                       rmargin_ = !width_ - lmargin_ - csize_for_caspect;
<a name="__line750"></a>
<a name="__line751"></a>	return *this;
<a name="__line752"></a>
<a name="__line753"></a>    }
<a name="__line754"></a>
<a name="__line755"></a>    void container::set_tmargin_(const length &amp;l)
<a name="__line756"></a>    {
<a name="__line757"></a>	modified_ = true;
<a name="__line758"></a>	tmargin_ = l;
<a name="__line759"></a>	if(tmargin_history_[0] != Tmargin &amp;&amp; tmargin_history_[1] != Tmargin)
<a name="__line760"></a>	{
<a name="__line761"></a>	    bool dummy1, dummy2;
<a name="__line762"></a>	    if(tmargin_history_[1] == container::Top)
<a name="__line763"></a>	    {
<a name="__line764"></a>		set_ctop_(!top_ - !tmargin_, dummy1, dummy2);
<a name="__line765"></a>	    }
<a name="__line766"></a>	    else if(tmargin_history_[1] == container::Ctop)
<a name="__line767"></a>	    {
<a name="__line768"></a>		set_top_(!ctop_ + !tmargin_, dummy1, dummy2);
<a name="__line769"></a>	    }
<a name="__line770"></a>	}
<a name="__line771"></a>	if(tmargin_history_[1] != container::Tmargin)
<a name="__line772"></a>	{
<a name="__line773"></a>	    tmargin_history_[0] = tmargin_history_[1];
<a name="__line774"></a>	    tmargin_history_[1] = Tmargin;
<a name="__line775"></a>	}
<a name="__line776"></a>    }
<a name="__line777"></a>    container &amp;container::tmargin(const length &amp;l)
<a name="__line778"></a>    {
<a name="__line779"></a>	if(caspect_&lt;=0)
<a name="__line780"></a>	{
<a name="__line781"></a>	    set_tmargin_(l);
<a name="__line782"></a>	    return *this;
<a name="__line783"></a>	}
<a name="__line784"></a>
<a name="__line785"></a>	if(l.depends_on(cheight()) ||
<a name="__line786"></a>	   l.depends_on(cycenter()) ||
<a name="__line787"></a>	   l.depends_on(cbottom()) ||
<a name="__line788"></a>	   l.depends_on(ctop()))
<a name="__line789"></a>	{
<a name="__line790"></a>	    warning::print("With a fixed caspect, tmargin can not depend on cwidth, cxcenter, cleft or cright");
<a name="__line791"></a>	    return *this;
<a name="__line792"></a>	}
<a name="__line793"></a>
<a name="__line794"></a>	length csize_for_caspect;
<a name="__line795"></a>	if(cx_lock_==sym::top)
<a name="__line796"></a>	{
<a name="__line797"></a>	    tmargin_ = l;
<a name="__line798"></a>	    csize_for_caspect = length::min(
<a name="__line799"></a>		!width_ - (cx_lock_==sym::right?rmargin_:lmargin_),
<a name="__line800"></a>		(!height_ - bmargin_ - tmargin_)/caspect_);
<a name="__line801"></a>	    bmargin_ = !height_ - tmargin_ - csize_for_caspect*caspect_;
<a name="__line802"></a>	}
<a name="__line803"></a>	else
<a name="__line804"></a>	{
<a name="__line805"></a>	    csize_for_caspect = length::min(
<a name="__line806"></a>		!width_ - (cx_lock_==sym::right?rmargin_:lmargin_),
<a name="__line807"></a>		(!height_ - bmargin_ - l)/caspect_);
<a name="__line808"></a>	    tmargin_ = !height_ - bmargin_ - csize_for_caspect*caspect_;
<a name="__line809"></a>	}
<a name="__line810"></a>	if(cx_lock_ == sym::right) lmargin_ = !width_ - rmargin_ - csize_for_caspect;
<a name="__line811"></a>	else                       rmargin_ = !width_ - lmargin_ - csize_for_caspect;
<a name="__line812"></a>
<a name="__line813"></a>	return *this;
<a name="__line814"></a>    }
<a name="__line815"></a>
<a name="__line816"></a>
<a name="__line817"></a>
<a name="__line818"></a>
<a name="__line819"></a>
<a name="__line820"></a>    bool container::modified() const
<a name="__line821"></a>    {
<a name="__line822"></a>	if(modified_) return true;
<a name="__line823"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i)
<a name="__line824"></a>	{
<a name="__line825"></a>	    if(content_[i]-&gt;modified()) return true;
<a name="__line826"></a>	}
<a name="__line827"></a>	return false;
<a name="__line828"></a>    }
<a name="__line829"></a>
<a name="__line830"></a>    void container::modified(bool f)
<a name="__line831"></a>    {
<a name="__line832"></a>	modified_ = f;
<a name="__line833"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i)
<a name="__line834"></a>	{
<a name="__line835"></a>	    content_[i]-&gt;modified(f);
<a name="__line836"></a>	}
<a name="__line837"></a>    }
<a name="__line838"></a>
<a name="__line839"></a>    void container::cd()
<a name="__line840"></a>    {
<a name="__line841"></a>	std::stack&lt;container *&gt; s;
<a name="__line842"></a>	for(container *p = this; p; p = p-&gt;parent())
<a name="__line843"></a>	{
<a name="__line844"></a>	    s.push(p);
<a name="__line845"></a>	}
<a name="__line846"></a>	for(; !s.empty(); s.pop())
<a name="__line847"></a>	{
<a name="__line848"></a>	    s.top()-&gt;cd_specific();
<a name="__line849"></a>	}
<a name="__line850"></a>    }
<a name="__line851"></a>
<a name="__line852"></a>    const length &amp;container::cleft() const {return cleft_;}
<a name="__line853"></a>    const length &amp;container::cright() const {return cright_;}
<a name="__line854"></a>    const length &amp;container::cwidth() const {return cwidth_;}
<a name="__line855"></a>    const length &amp;container::cxcenter() const { return cxcenter_; }
<a name="__line856"></a>    const length &amp;container::cbottom() const {return cbottom_;}
<a name="__line857"></a>    const length &amp;container::ctop() const {return ctop_;}
<a name="__line858"></a>    const length &amp;container::cheight() const {return cheight_;}
<a name="__line859"></a>    const length &amp;container::cycenter() const { return cycenter_; }
<a name="__line860"></a>
<a name="__line861"></a>    void container::prepare_for_draw()
<a name="__line862"></a>    {
<a name="__line863"></a>	if(print_me_ &lt; 1) return;
<a name="__line864"></a>	box::prepare_for_draw();
<a name="__line865"></a>
<a name="__line866"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i)
<a name="__line867"></a>	{
<a name="__line868"></a>	    content_[i]-&gt;prepare_for_draw();
<a name="__line869"></a>	}
<a name="__line870"></a>
<a name="__line871"></a>	cleft_.set_scale(x_unit());
<a name="__line872"></a>	cright_.set_scale(x_unit());
<a name="__line873"></a>	cwidth_.set_scale(x_unit());
<a name="__line874"></a>	cbottom_.set_scale(y_unit());
<a name="__line875"></a>	ctop_.set_scale(y_unit());
<a name="__line876"></a>	cheight_.set_scale(y_unit());
<a name="__line877"></a>
<a name="__line878"></a>	cleft_.register_me();
<a name="__line879"></a>	cright_.register_me();
<a name="__line880"></a>	cbottom_.register_me();
<a name="__line881"></a>	ctop_.register_me();
<a name="__line882"></a>    }
<a name="__line883"></a>
<a name="__line884"></a>    void container::print(terminal *term)
<a name="__line885"></a>    {
<a name="__line886"></a>	if(print_me_&lt;2) return;
<a name="__line887"></a>	term-&gt;subpicture_begin(terminal::coord(cleft_.termspecific_id(),
<a name="__line888"></a>					       cbottom_.termspecific_id()),
<a name="__line889"></a>			       terminal::coord(cright_.termspecific_id(),
<a name="__line890"></a>					       ctop_.termspecific_id()));
<a name="__line891"></a>	term-&gt;set_color(black);
<a name="__line892"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i) content_[i]-&gt;print(term);
<a name="__line893"></a>	term-&gt;subpicture_end();
<a name="__line894"></a>    }
<a name="__line895"></a>
<a name="__line896"></a>    std::vector&lt;blop::container *&gt; &amp;container::all()
<a name="__line897"></a>    {
<a name="__line898"></a>	static std::vector&lt;blop::container*&gt; *f= new std::vector&lt;blop::container*&gt;;
<a name="__line899"></a>	return *f;
<a name="__line900"></a>    }
<a name="__line901"></a>
<a name="__line902"></a>    container::container()
<a name="__line903"></a>    {
<a name="__line904"></a>	name("container");
<a name="__line905"></a>	all().push_back(this);
<a name="__line906"></a>
<a name="__line907"></a>	caspect_ = -1;
<a name="__line908"></a>	cx_lock_ = sym::left;
<a name="__line909"></a>	cy_lock_ = sym::bottom;
<a name="__line910"></a>
<a name="__line911"></a>	<span class=comment>// set up box dimensions</span>
<a name="__line912"></a>	box::right(1.0);
<a name="__line913"></a>	box::left(0.0);
<a name="__line914"></a>	box::top(1.0);
<a name="__line915"></a>	box::bottom(0.0);
<a name="__line916"></a>
<a name="__line917"></a>	lmargin_ = 0.0;
<a name="__line918"></a>	cleft_ = !left_ + !lmargin_;
<a name="__line919"></a>	lmargin_history_[0] = container::Lmargin;
<a name="__line920"></a>	lmargin_history_[1] = container::Left;
<a name="__line921"></a>
<a name="__line922"></a>	rmargin_ = 0;
<a name="__line923"></a>	cright_ = !right_ - !rmargin_;
<a name="__line924"></a>	rmargin_history_[0] = container::Rmargin;
<a name="__line925"></a>	rmargin_history_[1] = container::Right;
<a name="__line926"></a>
<a name="__line927"></a>	bmargin_ = 0;
<a name="__line928"></a>	cbottom_ = !bottom_ + !bmargin_;
<a name="__line929"></a>	bmargin_history_[0] = container::Bmargin;
<a name="__line930"></a>	bmargin_history_[1] = container::Bottom;
<a name="__line931"></a>
<a name="__line932"></a>	tmargin_ = 0;
<a name="__line933"></a>	ctop_ = !top_ - !tmargin_;
<a name="__line934"></a>	bmargin_history_[0] = container::Bmargin;
<a name="__line935"></a>	bmargin_history_[1] = container::Bottom;
<a name="__line936"></a>
<a name="__line937"></a>	cwidth_  = !cright_ - !cleft_;
<a name="__line938"></a>	cxcenter_ = 0.5*(!cleft_+!cright_);
<a name="__line939"></a>	cheight_ = !ctop_ - !cbottom_;
<a name="__line940"></a>	cycenter_ = 0.5*(!cbottom_+!ctop_);
<a name="__line941"></a>
<a name="__line942"></a>	cxhistory_[0] = RightTop;
<a name="__line943"></a>	cxhistory_[1] = LeftBottom;
<a name="__line944"></a>	cyhistory_[0] = RightTop;
<a name="__line945"></a>	cyhistory_[1] = LeftBottom;
<a name="__line946"></a>
<a name="__line947"></a>    }
<a name="__line948"></a>
<a name="__line949"></a>    container::~container()
<a name="__line950"></a>    {
<a name="__line951"></a>	vector&lt;container *&gt;::iterator i =
<a name="__line952"></a>	    std::find(all().begin(), all().end(), this);
<a name="__line953"></a>
<a name="__line954"></a>	if(i == all().end())
<a name="__line955"></a>	    err("Unregistered container (programming error)");
<a name="__line956"></a>
<a name="__line957"></a>	all().erase(i);
<a name="__line958"></a>
<a name="__line959"></a>	clear();
<a name="__line960"></a>    }
<a name="__line961"></a>
<a name="__line962"></a>    void container::remove_from_all(grob *g)
<a name="__line963"></a>    {
<a name="__line964"></a>	for(unsigned int i=0; i&lt;all().size(); ++i)
<a name="__line965"></a>	{
<a name="__line966"></a>	    all()[i] -&gt; remove(g);
<a name="__line967"></a>	}
<a name="__line968"></a>    }
<a name="__line969"></a>
<a name="__line970"></a>    bool container::remove(grob *g)
<a name="__line971"></a>    {
<a name="__line972"></a>	vector&lt;grob *&gt;::iterator i =
<a name="__line973"></a>	    std::find(content_.begin(), content_.end(), g);
<a name="__line974"></a>	if(i == content_.end()) return false;
<a name="__line975"></a>	g-&gt;parent(0);
<a name="__line976"></a>	content_.erase(i);
<a name="__line977"></a>	modified_ = true;
<a name="__line978"></a>	return true;
<a name="__line979"></a>    }
<a name="__line980"></a>
<a name="__line981"></a>    void container::clear()
<a name="__line982"></a>    {
<a name="__line983"></a>	<span class=comment>// first copy the pointers to a temporary vector</span>
<a name="__line984"></a>	vector&lt;grob*&gt; content = content_;
<a name="__line985"></a>
<a name="__line986"></a>	<span class=comment>// then clear the content_ vector</span>
<a name="__line987"></a>	content_.clear();
<a name="__line988"></a>
<a name="__line989"></a>	<span class=comment>// then delete the autodel=true objects (they will try to</span>
<a name="__line990"></a>	<span class=comment>// remove themselves from the content_ vector, but this has</span>
<a name="__line991"></a>	<span class=comment>// already been cleared, so no problem)</span>
<a name="__line992"></a>	for(unsigned int i=0; i&lt;content.size(); ++i)
<a name="__line993"></a>	{
<a name="__line994"></a>	    if(content[i]-&gt;autodel()) delete content[i];
<a name="__line995"></a>	}
<a name="__line996"></a>
<a name="__line997"></a>	modified(true);
<a name="__line998"></a>    }
<a name="__line999"></a>
<a name="__line1000"></a>    void container::add(grob *g)
<a name="__line1001"></a>    {
<a name="__line1002"></a>	if(g == 0) return;
<a name="__line1003"></a>	if(g-&gt;parent(this)) content_.push_back(g);
<a name="__line1004"></a>	modified_ = true;
<a name="__line1005"></a>    }
<a name="__line1006"></a>
<a name="__line1007"></a>    void container::print_hierarchy(int level)
<a name="__line1008"></a>    {
<a name="__line1009"></a>	for(int i=0; i&lt;level*4; ++i) cout&lt;&lt;" ";
<a name="__line1010"></a>	cout&lt;&lt;name()&lt;&lt;endl;
<a name="__line1011"></a>	for(unsigned int i=0; i&lt;content_.size(); ++i)
<a name="__line1012"></a>	{
<a name="__line1013"></a>	    content_[i]-&gt;print_hierarchy(level+1);
<a name="__line1014"></a>	}
<a name="__line1015"></a>    }
<a name="__line1016"></a>
<a name="__line1017"></a>
<a name="__line1018"></a>    bool container::empty() const
<a name="__line1019"></a>    {
<a name="__line1020"></a>	return content_.empty();
<a name="__line1021"></a>    }
<a name="__line1022"></a>}

</pre>
<hr> 
<a href="../index.html" title="Home"> 
<img src="../home.png"  style="border-width:0cm;"> 
</a>
<a href="source.html" title="List of sourcefiles"> 
<img src="../up.png"    style="border-width:0cm;"> 
</a>

</body></html>
