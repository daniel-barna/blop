<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<link href="../default.css" type="text/css" rel="stylesheet">
<title> BLOP: hist.cc </title>
</head>
<body>

<a href="../index.html" title="Home"> 
<img src="../home.png"  style="border-width:0cm;"> 
</a>
<a href="source.html" title="List of sourcefiles"> 
<img src="../up.png"    style="border-width:0cm;"> 
</a>
 <hr>
<pre>
<a name="__line0"></a>#include "<a href="hist.h.html">hist.h</a>"
<a name="__line1"></a>#include "<a href="graph_drawer.h.html">graph_drawer.h</a>"
<a name="__line2"></a>#include &lt;algorithm&gt;
<a name="__line3"></a>#include "<a href="x11_ps.h.html">x11_ps.h</a>"
<a name="__line4"></a>#include &lt;limits&gt;
<a name="__line5"></a>
<a name="__line6"></a>namespace blop
<a name="__line7"></a>{
<a name="__line8"></a>
<a name="__line9"></a>
<a name="__line10"></a><span class=comment>// Class for histogram construction. Also can be used to control histogram </span>
<a name="__line11"></a><span class=comment>// filling from file.</span>
<a name="__line12"></a>
<a name="__line13"></a>    histopt::histopt()
<a name="__line14"></a>        : dim_(0), x_(unset), y_(unset), condition_(unset), x_condition_(unset), y_condition_(unset), maxlines_(-1), buffer_size_(0), dont_clear_buffer_(false)
<a name="__line15"></a>    {
<a name="__line16"></a>    }
<a name="__line17"></a>
<a name="__line18"></a>
<a name="__line19"></a>    histopt::histopt(const histopt &amp;h_other)
<a name="__line20"></a>        : dim_(h_other.dim_), min_(h_other.min_), max_(h_other.max_), bins_(h_other.bins_), 
<a name="__line21"></a>          binsize_(h_other.binsize_), 
<a name="__line22"></a>          axistitle_(h_other.axistitle_), rangetitle_(h_other.rangetitle_), legend_(h_other.legend_), 
<a name="__line23"></a>          x_(h_other.x_), y_(h_other.y_), condition_(unset), x_condition_(h_other.x_condition_), y_condition_(h_other.y_condition_), 
<a name="__line24"></a>          maxlines_(h_other.maxlines_), dont_clear_buffer_(h_other.dont_clear_buffer_)
<a name="__line25"></a>    {
<a name="__line26"></a>    }
<a name="__line27"></a>
<a name="__line28"></a>
<a name="__line29"></a>    histopt::~histopt()
<a name="__line30"></a>    {
<a name="__line31"></a>    }
<a name="__line32"></a>
<a name="__line33"></a>
<a name="__line34"></a>    histopt&amp; histopt::min(const int axis, const double minvalue)
<a name="__line35"></a>    {
<a name="__line36"></a>        if ( axis&lt;1 ) return *this;
<a name="__line37"></a>        if(axis&gt;dim_) dim_=axis;
<a name="__line38"></a>        if ( (int)min_.size()&lt;axis ) min_.resize(axis, unset);
<a name="__line39"></a>        min_[axis-1]=minvalue;
<a name="__line40"></a>        return *this;
<a name="__line41"></a>    }
<a name="__line42"></a>
<a name="__line43"></a>
<a name="__line44"></a>    double histopt::min(const int axis) const
<a name="__line45"></a>    {
<a name="__line46"></a>        if ( axis&lt;1 || axis&gt;(int)min_.size() ) return unset;
<a name="__line47"></a>        return min_[axis-1];
<a name="__line48"></a>    }
<a name="__line49"></a>
<a name="__line50"></a>    double histopt::default_min_=0.0;
<a name="__line51"></a>    bool histopt::default_min_isset_=false;
<a name="__line52"></a>
<a name="__line53"></a>    void histopt::default_min(const double Min)
<a name="__line54"></a>    {
<a name="__line55"></a>        default_min_=Min;
<a name="__line56"></a>        default_min_isset_=true;
<a name="__line57"></a>        if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line58"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line59"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line60"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line61"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line62"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line63"></a>        else if ( default_min_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line64"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line65"></a>        else if ( default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line66"></a>        else if ( default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line67"></a>        else if ( default_min_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line68"></a>        else if ( default_max_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line69"></a>        else if ( default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line70"></a>        else if ( default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line71"></a>        else default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line72"></a>    }
<a name="__line73"></a>
<a name="__line74"></a>
<a name="__line75"></a>
<a name="__line76"></a>    histopt&amp; histopt::max(const int axis, const double maxvalue)
<a name="__line77"></a>    {
<a name="__line78"></a>        if ( axis&lt;1 ) return *this;
<a name="__line79"></a>        if(axis&gt;dim_) dim_=axis;
<a name="__line80"></a>        if ( (int)max_.size()&lt;axis ) max_.resize(axis, unset);
<a name="__line81"></a>        max_[axis-1]=maxvalue;
<a name="__line82"></a>        return *this;
<a name="__line83"></a>    }
<a name="__line84"></a>
<a name="__line85"></a>
<a name="__line86"></a>    double histopt::max(const int axis) const
<a name="__line87"></a>    {
<a name="__line88"></a>        if ( axis&lt;1 || axis&gt;(int)max_.size() ) return unset;
<a name="__line89"></a>        return max_[axis-1];
<a name="__line90"></a>    }
<a name="__line91"></a>
<a name="__line92"></a>
<a name="__line93"></a>    double histopt::default_max_=10.0;
<a name="__line94"></a>    bool histopt::default_max_isset_=false;
<a name="__line95"></a>
<a name="__line96"></a>    void histopt::default_max(const double Max)
<a name="__line97"></a>    {
<a name="__line98"></a>        default_max_=Max;
<a name="__line99"></a>        default_max_isset_=true;
<a name="__line100"></a>        if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line101"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line102"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line103"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line104"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line105"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line106"></a>        else if ( default_min_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line107"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line108"></a>        else if ( default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line109"></a>        else if ( default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line110"></a>        else if ( default_min_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line111"></a>        else if ( default_max_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line112"></a>        else if ( default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line113"></a>        else if ( default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line114"></a>        else default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line115"></a>    }
<a name="__line116"></a>
<a name="__line117"></a>
<a name="__line118"></a>    histopt&amp; histopt::bins(const int axis, const int nbins)
<a name="__line119"></a>    {
<a name="__line120"></a>        if ( axis&lt;1 ) return *this;
<a name="__line121"></a>        if(axis&gt;dim_) dim_=axis;
<a name="__line122"></a>        if ( (int)bins_.size()&lt;axis ) bins_.resize(axis, 0);
<a name="__line123"></a>        bins_[axis-1]=nbins;
<a name="__line124"></a>        return *this;
<a name="__line125"></a>    }
<a name="__line126"></a>
<a name="__line127"></a>
<a name="__line128"></a>    int histopt::bins(const int axis) const
<a name="__line129"></a>    {
<a name="__line130"></a>        if ( axis&lt;1 || axis&gt;(int)bins_.size() ) return 0;
<a name="__line131"></a>        return bins_[axis-1];
<a name="__line132"></a>    }
<a name="__line133"></a>
<a name="__line134"></a>
<a name="__line135"></a>    int histopt::default_bins_=100;
<a name="__line136"></a>    bool histopt::default_bins_isset_=false;
<a name="__line137"></a>
<a name="__line138"></a>    void histopt::default_bins(const int Bins)
<a name="__line139"></a>    {
<a name="__line140"></a>        default_bins_=Bins;
<a name="__line141"></a>        default_bins_isset_=true;
<a name="__line142"></a>        if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line143"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line144"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line145"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line146"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line147"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line148"></a>        else if ( default_min_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line149"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line150"></a>        else if ( default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line151"></a>        else if ( default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line152"></a>        else if ( default_min_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line153"></a>        else if ( default_max_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line154"></a>        else if ( default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line155"></a>        else if ( default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line156"></a>        else default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line157"></a>    }
<a name="__line158"></a>
<a name="__line159"></a>
<a name="__line160"></a>    histopt&amp; histopt::binsize(const int axis, const double binsize)
<a name="__line161"></a>    {
<a name="__line162"></a>        if ( axis&lt;1 ) return *this;
<a name="__line163"></a>        if(axis&gt;dim_) dim_=axis;
<a name="__line164"></a>        if ( (int)binsize_.size()&lt;axis ) binsize_.resize(axis, unset);
<a name="__line165"></a>        binsize_[axis-1]=binsize;
<a name="__line166"></a>        return *this;
<a name="__line167"></a>    }
<a name="__line168"></a>
<a name="__line169"></a>
<a name="__line170"></a>    double histopt::binsize(const int axis) const
<a name="__line171"></a>    {
<a name="__line172"></a>        if ( axis&lt;1 || axis&gt;(int)binsize_.size() ) return unset;
<a name="__line173"></a>        return binsize_[axis-1];
<a name="__line174"></a>    }
<a name="__line175"></a>
<a name="__line176"></a>
<a name="__line177"></a>    double histopt::default_binsize_=0.1;
<a name="__line178"></a>    bool histopt::default_binsize_isset_=false;
<a name="__line179"></a>
<a name="__line180"></a>    void histopt::default_binsize(const double Binsize)
<a name="__line181"></a>    {
<a name="__line182"></a>        default_binsize_=Binsize;
<a name="__line183"></a>        default_binsize_isset_=true;
<a name="__line184"></a>        if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line185"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line186"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line187"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line188"></a>        else if ( default_min_isset_==true &amp;&amp; default_max_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line189"></a>        else if ( default_min_isset_==true &amp;&amp; default_binsize_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line190"></a>        else if ( default_min_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line191"></a>        else if ( default_max_isset_==true &amp;&amp; default_binsize_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line192"></a>        else if ( default_max_isset_==true &amp;&amp; default_bins_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line193"></a>        else if ( default_binsize_isset_==true &amp;&amp; default_bins_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line194"></a>        else if ( default_min_isset_==true ) default_max_=default_min_+default_binsize_*default_bins_;
<a name="__line195"></a>        else if ( default_max_isset_==true ) default_min_=default_max_-default_binsize_*default_bins_;
<a name="__line196"></a>        else if ( default_bins_isset_==true ) default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line197"></a>        else if ( default_binsize_isset_==true ) { default_bins_=(int)((default_max_-default_min_)/default_binsize_); default_bins_=(int)((default_max_-default_min_)/default_binsize_*(1.0+0.001/default_bins_)); }
<a name="__line198"></a>        else default_binsize_=(default_max_-default_min_)/default_bins_;
<a name="__line199"></a>    }
<a name="__line200"></a>
<a name="__line201"></a>
<a name="__line202"></a>    histopt&amp; histopt::axistitle(const int axis, const var &amp;Title)
<a name="__line203"></a>    {
<a name="__line204"></a>        if ( axis&lt;1 ) return *this;
<a name="__line205"></a>        if(axis&gt;dim_) dim_=axis;
<a name="__line206"></a>        if ( (int)axistitle_.size()&lt;axis ) axistitle_.resize(axis, (var)"");
<a name="__line207"></a>        axistitle_[axis-1]=Title;
<a name="__line208"></a>        return *this;
<a name="__line209"></a>    }
<a name="__line210"></a>
<a name="__line211"></a>
<a name="__line212"></a>    var histopt::axistitle(const int axis)
<a name="__line213"></a>    {
<a name="__line214"></a>        if ( axis&lt;1 || axis&gt;(int)axistitle_.size() ) return (var)"";
<a name="__line215"></a>        return axistitle_[axis-1];
<a name="__line216"></a>    }
<a name="__line217"></a>
<a name="__line218"></a>
<a name="__line219"></a>    histopt&amp; histopt::rangetitle(const var &amp;Title)
<a name="__line220"></a>    {
<a name="__line221"></a>        rangetitle_=Title;
<a name="__line222"></a>        return *this;
<a name="__line223"></a>    }
<a name="__line224"></a>
<a name="__line225"></a>
<a name="__line226"></a>    var histopt::rangetitle()
<a name="__line227"></a>    {
<a name="__line228"></a>        return rangetitle_;
<a name="__line229"></a>    }
<a name="__line230"></a>
<a name="__line231"></a>
<a name="__line232"></a>    histopt&amp; histopt::legend(const var &amp;Title)
<a name="__line233"></a>    {
<a name="__line234"></a>        legend_=Title;
<a name="__line235"></a>        return *this;
<a name="__line236"></a>    }
<a name="__line237"></a>
<a name="__line238"></a>
<a name="__line239"></a>    var histopt::legend()
<a name="__line240"></a>    {
<a name="__line241"></a>        return legend_;
<a name="__line242"></a>    }
<a name="__line243"></a>
<a name="__line244"></a>
<a name="__line245"></a>    function histopt::default_x_=ARG(1);
<a name="__line246"></a>    function histopt::default_y_=unset;
<a name="__line247"></a>    function histopt::default_condition_=unset;
<a name="__line248"></a>    function histopt::default_x_condition_=unset;
<a name="__line249"></a>    function histopt::default_y_condition_=unset;
<a name="__line250"></a>    int histopt::default_maxlines_=-1;
<a name="__line251"></a>
<a name="__line252"></a>    histopt&amp; histopt::x(const function &amp;f) { x_ = f; return *this; }
<a name="__line253"></a>    histopt&amp; histopt::x(const function &amp;f1, const function &amp;f2) { x_ = function(f1,f2); return *this; }
<a name="__line254"></a>    histopt&amp; histopt::x(const function &amp;f1, const function &amp;f2, const function &amp;f3) { x_ = function(f1,f2,f3); return *this; }
<a name="__line255"></a>    void histopt::default_x(const function &amp;f)
<a name="__line256"></a>    { default_x_=f; }
<a name="__line257"></a>    void histopt::default_x(const function &amp;f1, const function &amp;f2)
<a name="__line258"></a>    { default_x_=function(f1,f2); }
<a name="__line259"></a>    void histopt::default_x(const function &amp;f1, const function &amp;f2, const function &amp;f3)
<a name="__line260"></a>    { default_x_=function(f1,f2,f3); }
<a name="__line261"></a>    histopt&amp; histopt::y(const function &amp;f) { y_ = f; return *this; }
<a name="__line262"></a>    void histopt::default_y(const function &amp;f)
<a name="__line263"></a>    { default_y_=f; }
<a name="__line264"></a>
<a name="__line265"></a>
<a name="__line266"></a><span class=comment>// Class for merging domain side.</span>
<a name="__line267"></a>
<a name="__line268"></a>    mergeopt_side::mergeopt_side()
<a name="__line269"></a>        : min_(0.0), max_(0.0), merge_(0)
<a name="__line270"></a>    {
<a name="__line271"></a>    }
<a name="__line272"></a>
<a name="__line273"></a>
<a name="__line274"></a>    mergeopt_side::mergeopt_side(const double Min, const double Max, const int Merge)
<a name="__line275"></a>        : min_(Min), max_(Max), merge_(Merge)
<a name="__line276"></a>    {
<a name="__line277"></a>    }
<a name="__line278"></a>
<a name="__line279"></a>
<a name="__line280"></a>    mergeopt_side::mergeopt_side(const mergeopt_side &amp;m_other)
<a name="__line281"></a>        : min_(m_other.min_), max_(m_other.max_), merge_(m_other.merge_)
<a name="__line282"></a>    {
<a name="__line283"></a>    }
<a name="__line284"></a>
<a name="__line285"></a>
<a name="__line286"></a>    mergeopt_side::~mergeopt_side()
<a name="__line287"></a>    {
<a name="__line288"></a>    }
<a name="__line289"></a>
<a name="__line290"></a>
<a name="__line291"></a><span class=comment>// Class for managing the merging of the bins of a multidimensional histogram.</span>
<a name="__line292"></a>
<a name="__line293"></a>    mergeopt&amp; mergeopt::side(const double Min, const double Max, const int Merge)
<a name="__line294"></a>    {
<a name="__line295"></a>        push_back(mergeopt_side(Min, Max, Merge));
<a name="__line296"></a>        return *this;
<a name="__line297"></a>    }
<a name="__line298"></a>
<a name="__line299"></a>
<a name="__line300"></a><span class=comment>// Some local tabularization tools for writing histogram files.</span>
<a name="__line301"></a>
<a name="__line302"></a>    static var tabs(const int n, const var &amp;s)
<a name="__line303"></a>    {
<a name="__line304"></a>        var r="";
<a name="__line305"></a>        int N=8;
<a name="__line306"></a>        if ( n*8-s.length()&gt;0 ) N=n*8-s.length();
<a name="__line307"></a>        for ( int i=0 ; i&lt;=(N-1)/8 ; ++i ) r&amp;="\t";
<a name="__line308"></a>        return r;
<a name="__line309"></a>    }
<a name="__line310"></a>
<a name="__line311"></a>
<a name="__line312"></a>    static var tabs(const int n, const double s)
<a name="__line313"></a>    {
<a name="__line314"></a>        var r="";
<a name="__line315"></a>        int N=8;
<a name="__line316"></a>        std::ostringstream str;
<a name="__line317"></a>        str &lt;&lt; s;
<a name="__line318"></a>        if ( n*8-str.str().length()&gt;0 ) N=n*8-str.str().length();
<a name="__line319"></a>        for ( int i=0 ; i&lt;=(N-1)/8 ; ++i ) r&amp;="\t";
<a name="__line320"></a>        return r;
<a name="__line321"></a>    }
<a name="__line322"></a>
<a name="__line323"></a>
<a name="__line324"></a><span class=comment>// Class for histograms. Axis indices are 1-based on the user side!</span>
<a name="__line325"></a>
<a name="__line326"></a>    hist &amp;hist::dup()
<a name="__line327"></a>    {
<a name="__line328"></a>        hist *result = new hist(*this);
<a name="__line329"></a>        if(parent_) parent_-&gt;add(result);
<a name="__line330"></a>        return *result;
<a name="__line331"></a>    }
<a name="__line332"></a>
<a name="__line333"></a>
<a name="__line334"></a>    hist::hist()
<a name="__line335"></a>        : plottable(), buffer_size_(0), dim_(0)
<a name="__line336"></a>    {
<a name="__line337"></a>        pointtype(*default_point_drawer_);
<a name="__line338"></a>    }
<a name="__line339"></a>
<a name="__line340"></a>
<a name="__line341"></a>    hist::hist(const histopt &amp;hopt)
<a name="__line342"></a>        : plottable(), dim_(0)
<a name="__line343"></a>    {
<a name="__line344"></a>        reinit(hopt);
<a name="__line345"></a>        pointtype(*default_point_drawer_);
<a name="__line346"></a>    }
<a name="__line347"></a>
<a name="__line348"></a>
<a name="__line349"></a>    hist::hist(const double Min, const double Max, const int Bins, const var &amp;Title, 
<a name="__line350"></a>               const var &amp;rTitle, const var &amp;Legend)
<a name="__line351"></a>        : plottable(), dim_(0)
<a name="__line352"></a>    {
<a name="__line353"></a>        reinit(histopt().min(1,Min).max(1,Max).bins(1,Bins).axistitle(1,Title).rangetitle(rTitle).legend(Legend));
<a name="__line354"></a>        pointtype(*default_point_drawer_);
<a name="__line355"></a>    }
<a name="__line356"></a>
<a name="__line357"></a>
<a name="__line358"></a>    hist::hist(const double Min1, const double Max1, const int Bins1,
<a name="__line359"></a>               const double Min2, const double Max2, const int Bins2)
<a name="__line360"></a>
<a name="__line361"></a>        : plottable(), dim_(0)
<a name="__line362"></a>    {
<a name="__line363"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1).min(2,Min2).max(2,Max2).bins(2,Bins2));
<a name="__line364"></a>        pointtype(*default_point_drawer_);
<a name="__line365"></a>    }
<a name="__line366"></a>
<a name="__line367"></a>    hist::hist(const double Min1, const double Max1, const int Bins1, const var &amp;Title1, 
<a name="__line368"></a>               const double Min2, const double Max2, const int Bins2, const var &amp;Title2, 
<a name="__line369"></a>               const var &amp;rTitle, const var &amp;Legend)
<a name="__line370"></a>        : plottable(), dim_(0)
<a name="__line371"></a>    {
<a name="__line372"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1).axistitle(1,Title1).min(2,Min2).max(2,Max2).bins(2,Bins2).axistitle(2,Title2).rangetitle(rTitle).legend(Legend));
<a name="__line373"></a>        pointtype(*default_point_drawer_);
<a name="__line374"></a>    }
<a name="__line375"></a>
<a name="__line376"></a>
<a name="__line377"></a>    hist::hist(double Min1, double Max1, int Bins1,
<a name="__line378"></a>               double Min2, double Max2, int Bins2,
<a name="__line379"></a>               double Min3, double Max3, int Bins3)
<a name="__line380"></a>        : plottable(), dim_(0)
<a name="__line381"></a>    {
<a name="__line382"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1)
<a name="__line383"></a>               .min(2,Min2).max(2,Max2).bins(2,Bins2)
<a name="__line384"></a>               .min(3,Min3).max(3,Max3).bins(3,Bins3));
<a name="__line385"></a>        pointtype(*default_point_drawer_);
<a name="__line386"></a>    }
<a name="__line387"></a>
<a name="__line388"></a>
<a name="__line389"></a>    hist::hist(const double Min1, const double Max1, const int Bins1, const var &amp;Title1, 
<a name="__line390"></a>               const double Min2, const double Max2, const int Bins2, const var &amp;Title2, 
<a name="__line391"></a>               const double Min3, const double Max3, const int Bins3, const var &amp;Title3, 
<a name="__line392"></a>               const var &amp;rTitle, const var &amp;Legend)
<a name="__line393"></a>        : plottable(), dim_(0)
<a name="__line394"></a>    {
<a name="__line395"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1).axistitle(1,Title1).min(2,Min2).max(2,Max2).bins(2,Bins2).axistitle(2,Title2).min(3,Min3).max(3,Max3).bins(3,Bins3).axistitle(3,Title3).rangetitle(rTitle).legend(Legend));
<a name="__line396"></a>        pointtype(*default_point_drawer_);
<a name="__line397"></a>    }
<a name="__line398"></a>
<a name="__line399"></a>
<a name="__line400"></a>    hist::hist(const hist &amp;h_other)
<a name="__line401"></a>        : plottable(h_other), buffer_size_(h_other.buffer_size_), dim_(h_other.dim_), 
<a name="__line402"></a>          min_(h_other.min_), max_(h_other.max_), bins_(h_other.bins_), 
<a name="__line403"></a>          binsize_(h_other.binsize_), axistitle_(h_other.axistitle_), 
<a name="__line404"></a>          rangetitle_(h_other.rangetitle_), 
<a name="__line405"></a>          mul_(h_other.mul_), ind_(h_other.ind_), 
<a name="__line406"></a>          h_(h_other.h_), m_(h_other.m_), 
<a name="__line407"></a>          sequence_(h_other.sequence_), invsequence_(h_other.invsequence_), 
<a name="__line408"></a>          datapoint_(h_other.datapoint_)
<a name="__line409"></a>    {
<a name="__line410"></a>        pointtype(*default_point_drawer_);
<a name="__line411"></a>    }
<a name="__line412"></a>
<a name="__line413"></a>
<a name="__line414"></a>    hist::~hist()
<a name="__line415"></a>    {
<a name="__line416"></a>    }
<a name="__line417"></a>
<a name="__line418"></a>
<a name="__line419"></a>    void hist::flush_buffer() const
<a name="__line420"></a>    {
<a name="__line421"></a>        if(buffer_.empty()) return;
<a name="__line422"></a>
<a name="__line423"></a>        <span class=comment>// First determine the range of the data in the buffer along all dimensions</span>
<a name="__line424"></a>        vector&lt;double&gt; Min(dim_,numeric_limits&lt;double&gt;::max()), Max(dim_,numeric_limits&lt;double&gt;::min());
<a name="__line425"></a>        for(unsigned int i=0; i&lt;buffer_.size(); i+=dim_+1)
<a name="__line426"></a>        {
<a name="__line427"></a>            for(int d=0; d&lt;dim_; ++d)
<a name="__line428"></a>            {
<a name="__line429"></a>                if(buffer_[i+d] &lt; Min[d]) Min[d] = buffer_[i+d];
<a name="__line430"></a>                if(buffer_[i+d] &gt; Max[d]) Max[d] = buffer_[i+d];
<a name="__line431"></a>            }
<a name="__line432"></a>        }
<a name="__line433"></a>
<a name="__line434"></a>        histopt hopt;
<a name="__line435"></a>        hopt.dont_clear_buffer_ = true;
<a name="__line436"></a>        for(int d=0; d&lt;dim_; ++d)
<a name="__line437"></a>        {
<a name="__line438"></a>            <span class=comment>// Add a little margin around the actual limits</span>
<a name="__line439"></a>            const double range = Max[d]-Min[d];
<a name="__line440"></a>            Min[d] -= 0.05*range;
<a name="__line441"></a>            Max[d] += 0.05*range;
<a name="__line442"></a>
<a name="__line443"></a>            if(min(d+1)!=unset) hopt.min(d+1,min(d+1));
<a name="__line444"></a>            else hopt.min(d+1,Min[d]);
<a name="__line445"></a>            if(max(d+1)!=unset) hopt.max(d+1,max(d+1));
<a name="__line446"></a>            else hopt.max(d+1,Max[d]);
<a name="__line447"></a>            if(bins(d+1)!=0) hopt.bins(d+1,bins(d+1));
<a name="__line448"></a>            else if(binsize(d+1)!=unset) hopt.binsize(d+1,binsize(d+1));
<a name="__line449"></a>            else hopt.bins(d+1,100);
<a name="__line450"></a>        }
<a name="__line451"></a>
<a name="__line452"></a>        reinit(hopt);
<a name="__line453"></a>
<a name="__line454"></a>        <span class=comment>// set buffer_size_ to zero to avoid (recursive) buffering in the fill(...) calls in the loop below</span>
<a name="__line455"></a>        <span class=comment>// and fill directly to the histogram instead</span>
<a name="__line456"></a>        buffer_size_ = 0;
<a name="__line457"></a>
<a name="__line458"></a>        point p(dim_);
<a name="__line459"></a>        for(unsigned int i=0; i&lt;buffer_.size(); i+=dim_+1)
<a name="__line460"></a>        {
<a name="__line461"></a>            for(int d=0; d&lt;dim_; ++d)
<a name="__line462"></a>            {
<a name="__line463"></a>                p[d+1] = buffer_[i+d];
<a name="__line464"></a>            }
<a name="__line465"></a>            fill(p,buffer_[i+dim_]);
<a name="__line466"></a>        }
<a name="__line467"></a>
<a name="__line468"></a>        <span class=comment>// clear the buffer and set size to 0 so that no further buffering will occur</span>
<a name="__line469"></a>        buffer_.clear();
<a name="__line470"></a>
<a name="__line471"></a>    }
<a name="__line472"></a>
<a name="__line473"></a>    point_drawer *hist::default_point_drawer_ = new autopoint;
<a name="__line474"></a>
<a name="__line475"></a>    void hist::default_pointtype(const point_drawer &amp;p)
<a name="__line476"></a>    {
<a name="__line477"></a>        delete default_point_drawer_;
<a name="__line478"></a>        if(dynamic_cast&lt;const autopoint *&gt;(&amp;p)) default_point_drawer_ = new autopoint();
<a name="__line479"></a>        else default_point_drawer_ = p.clone();
<a name="__line480"></a>    }
<a name="__line481"></a>
<a name="__line482"></a>    graph_drawer * &amp;hist::default_graph_drawer_1_()
<a name="__line483"></a>    {
<a name="__line484"></a>        static graph_drawer *d = sxyerrorbars().clip_errorbars(true).clone();
<a name="__line485"></a>        return d;
<a name="__line486"></a>    }
<a name="__line487"></a>    graph_drawer * &amp;hist::default_graph_drawer_2_()
<a name="__line488"></a>    {
<a name="__line489"></a>        static graph_drawer *d = 0;
<a name="__line490"></a>        if(d == 0)
<a name="__line491"></a>        {
<a name="__line492"></a>            d=csboxes().grid_foreground(true).clone();
<a name="__line493"></a>        }
<a name="__line494"></a>        return d;
<a name="__line495"></a>    }
<a name="__line496"></a>
<a name="__line497"></a>    void hist::default_drawstyle_1(const graph_drawer &amp;d)
<a name="__line498"></a>    {
<a name="__line499"></a>        delete default_graph_drawer_1_();
<a name="__line500"></a>        default_graph_drawer_1_() = d.clone();
<a name="__line501"></a>    }
<a name="__line502"></a>    void hist::default_drawstyle_2(const graph_drawer &amp;d)
<a name="__line503"></a>    {
<a name="__line504"></a>        delete default_graph_drawer_2_();
<a name="__line505"></a>        default_graph_drawer_2_() = d.clone();
<a name="__line506"></a>    }
<a name="__line507"></a>
<a name="__line508"></a>    void hist::set_graph_drawer_() const
<a name="__line509"></a>    {
<a name="__line510"></a>        if ( graph_drawer_!=0 ) delete graph_drawer_;
<a name="__line511"></a>        graph_drawer_=0;
<a name="__line512"></a>        if ( dim_==1 )      graph_drawer_ = default_graph_drawer_1_()-&gt;clone();
<a name="__line513"></a>        else if ( dim_==2 )
<a name="__line514"></a>        {
<a name="__line515"></a>            graph_drawer_ = default_graph_drawer_2_()-&gt;clone();
<a name="__line516"></a>            if(csboxes *sc = dynamic_cast&lt;csboxes*&gt;(graph_drawer_))
<a name="__line517"></a>            {
<a name="__line518"></a>                if(rangetitle_.str() != "")
<a name="__line519"></a>                {
<a name="__line520"></a>                    sc-&gt;color_title(rangetitle_);
<a name="__line521"></a>                }
<a name="__line522"></a>            }
<a name="__line523"></a>        }
<a name="__line524"></a>        else graph_drawer_=new lines;
<a name="__line525"></a>    }
<a name="__line526"></a>
<a name="__line527"></a>
<a name="__line528"></a>    void hist::reinit_(const int dim, 
<a name="__line529"></a>                       const std::vector&lt;double&gt; &amp;dbegin, 
<a name="__line530"></a>                       const std::vector&lt;double&gt; &amp;dend, 
<a name="__line531"></a>                       const std::vector&lt;int&gt; &amp;dbins, 
<a name="__line532"></a>                       const std::vector&lt;var&gt; &amp;dtitle, 
<a name="__line533"></a>                       const var &amp;rtitle, 
<a name="__line534"></a>                       const var &amp;hlegend) const
<a name="__line535"></a>    {
<a name="__line536"></a>        int i, j;
<a name="__line537"></a>        dim_=dim;
<a name="__line538"></a>        min_=dbegin;
<a name="__line539"></a>        max_=dend;
<a name="__line540"></a>        bins_=dbins;
<a name="__line541"></a>        binsize_.resize(dim_);
<a name="__line542"></a>        for ( j=0 ; j&lt;dim_ ; ++j ) binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line543"></a>        axistitle_=dtitle;
<a name="__line544"></a>        rangetitle_=rtitle;
<a name="__line545"></a>        legend_=hlegend;
<a name="__line546"></a>        int sizeh=(dim_&gt;0 ? 1 : 0);
<a name="__line547"></a>        mul_.resize(dim_);
<a name="__line548"></a>        ind_.resize(dim_);
<a name="__line549"></a>        if ( dim_&gt;0 )
<a name="__line550"></a>        {
<a name="__line551"></a>            mul_[dim_-1]=1;
<a name="__line552"></a>            for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line553"></a>            {
<a name="__line554"></a>                sizeh*=bins_[j];
<a name="__line555"></a>                if ( j&lt;dim_-1 ) mul_[j]=mul_[j+1]*bins_[j+1];
<a name="__line556"></a>            }
<a name="__line557"></a>        }
<a name="__line558"></a>        h_.resize(sizeh);
<a name="__line559"></a>        m_.resize(sizeh*dim_);
<a name="__line560"></a>        sequence_.resize(sizeh);
<a name="__line561"></a>        invsequence_.resize(sizeh);
<a name="__line562"></a>        for ( i=0 ; i&lt;sizeh ; ++i )
<a name="__line563"></a>        {
<a name="__line564"></a>            h_[i]=0.0;
<a name="__line565"></a>            for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line566"></a>            {
<a name="__line567"></a>                m_[i*dim_+j]=1;
<a name="__line568"></a>            }
<a name="__line569"></a>            sequence_[i]=i;
<a name="__line570"></a>            invsequence_[i]=i;
<a name="__line571"></a>        }
<a name="__line572"></a>        datapoint_.resize(dim_*2+2);
<a name="__line573"></a>
<a name="__line574"></a>        set_graph_drawer_();
<a name="__line575"></a>
<a name="__line576"></a>    }
<a name="__line577"></a>
<a name="__line578"></a>    void hist::reinit(const histopt &amp;hopt)
<a name="__line579"></a>    {
<a name="__line580"></a>        const hist &amp;h = *this;
<a name="__line581"></a>        h.reinit(hopt);
<a name="__line582"></a>    }
<a name="__line583"></a>
<a name="__line584"></a>    void hist::reinit(const histopt &amp;hopt) const
<a name="__line585"></a>    {
<a name="__line586"></a>        dim_=hopt.dim();
<a name="__line587"></a>        <span class=comment>// The following cases should never be true since hopt in principle automatically updates its dim_ variable</span>
<a name="__line588"></a>        <span class=comment>// when any of the following options are set, but I leeave it here for the time being</span>
<a name="__line589"></a>        if ( (int)hopt.min_.size()&gt;dim_ ) dim_=hopt.min_.size();
<a name="__line590"></a>        if ( (int)hopt.max_.size()&gt;dim_ ) dim_=hopt.max_.size();
<a name="__line591"></a>        if ( (int)hopt.bins_.size()&gt;dim_ ) dim_=hopt.bins_.size();
<a name="__line592"></a>        if ( (int)hopt.binsize_.size()&gt;dim_ ) dim_=hopt.binsize_.size();
<a name="__line593"></a>        if ( (int)hopt.axistitle_.size()&gt;dim_ ) dim_=hopt.axistitle_.size();
<a name="__line594"></a>
<a name="__line595"></a>        if(!hopt.dont_clear_buffer_)
<a name="__line596"></a>        {
<a name="__line597"></a>            buffer_size_ = hopt.buffer_size();
<a name="__line598"></a>            buffer_.clear();
<a name="__line599"></a>        }
<a name="__line600"></a>        if(hopt.buffer_size()&gt;0) buffer_.reserve(hopt.buffer_size()*(dim_+1));
<a name="__line601"></a>
<a name="__line602"></a>        if ( dim_&lt;=0 )
<a name="__line603"></a>        {
<a name="__line604"></a>            warning::print("Dimension is not greater than zero! Creating empty histogram.", "void hist::reinit(const histopt&amp;)");
<a name="__line605"></a>            reinit_(0, std::vector&lt;double&gt;(0), std::vector&lt;double&gt;(0), std::vector&lt;int&gt;(0), std::vector&lt;var&gt;(0), (var)"", (var)"");
<a name="__line606"></a>            return;
<a name="__line607"></a>        }
<a name="__line608"></a>        min_.resize(dim_,unset);
<a name="__line609"></a>        max_.resize(dim_,unset);
<a name="__line610"></a>        bins_.resize(dim_,0);
<a name="__line611"></a>        binsize_.resize(dim_,unset);
<a name="__line612"></a>        axistitle_.resize(dim_);
<a name="__line613"></a>        ind_.resize(dim_);
<a name="__line614"></a>        mul_.resize(dim_);
<a name="__line615"></a>        mul_[dim_-1]=1;
<a name="__line616"></a>        int sizeh=1;
<a name="__line617"></a>        for ( int j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line618"></a>        {
<a name="__line619"></a>            if ( hopt.min(j+1)!=unset &amp;&amp; hopt.max(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line620"></a>            {
<a name="__line621"></a>                min_[j]=hopt.min(j+1);
<a name="__line622"></a>                max_[j]=hopt.max(j+1);
<a name="__line623"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line624"></a>                binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line625"></a>            }
<a name="__line626"></a>            else if ( hopt.min(j+1)!=unset &amp;&amp; hopt.max(j+1)!=unset &amp;&amp; hopt.binsize(j+1)!=unset )
<a name="__line627"></a>            {
<a name="__line628"></a>                min_[j]=hopt.min(j+1);
<a name="__line629"></a>                max_[j]=hopt.max(j+1);
<a name="__line630"></a>                bins_[j]=(int)((max_[j]-min_[j])/hopt.binsize(j+1));
<a name="__line631"></a>                bins_[j]=(int)((max_[j]-min_[j])/hopt.binsize(j+1)*(1.0+0.001/bins_[j]));
<a name="__line632"></a>                binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line633"></a>            }
<a name="__line634"></a>            else if ( hopt.min(j+1)!=unset &amp;&amp; hopt.binsize(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line635"></a>            {
<a name="__line636"></a>                min_[j]=hopt.min(j+1);
<a name="__line637"></a>                max_[j]=min_[j]+hopt.binsize(j+1)*hopt.bins(j+1);
<a name="__line638"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line639"></a>                binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line640"></a>            }
<a name="__line641"></a>            else if ( hopt.max(j+1)!=unset &amp;&amp; hopt.binsize(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line642"></a>            {
<a name="__line643"></a>                min_[j]=hopt.max(j+1)-hopt.binsize(j+1)*hopt.bins(j+1);
<a name="__line644"></a>                max_[j]=hopt.max(j+1); 
<a name="__line645"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line646"></a>                binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line647"></a>            }
<a name="__line648"></a>            else if ( hopt.min(j+1)!=unset &amp;&amp; hopt.max(j+1)!=unset )
<a name="__line649"></a>            {
<a name="__line650"></a>                min_[j]=hopt.min(j+1);
<a name="__line651"></a>                max_[j]=hopt.max(j+1);
<a name="__line652"></a>                bins_[j]=histopt::default_bins_;
<a name="__line653"></a>                binsize_[j]=(max_[j]-min_[j])/bins_[j];
<a name="__line654"></a>            }
<a name="__line655"></a>            else if ( hopt.min(j+1)!=unset &amp;&amp; hopt.binsize(j+1)!=unset )
<a name="__line656"></a>            {
<a name="__line657"></a>                min_[j]=hopt.min(j+1);
<a name="__line658"></a>                <span class=comment>//max_[j]=min_[j]+hopt.binsize(j+1)*histopt::default_bins_;</span>
<a name="__line659"></a>                <span class=comment>//bins_[j]=histopt::default_bins_;</span>
<a name="__line660"></a>                binsize_[j]=hopt.binsize(j+1);
<a name="__line661"></a>            }
<a name="__line662"></a>            else if ( hopt.max(j+1)!=unset &amp;&amp; hopt.binsize(j+1)!=unset )
<a name="__line663"></a>            {
<a name="__line664"></a>                <span class=comment>//min_[j]=hopt.max(j+1)-hopt.binsize(j+1)*histopt::default_bins_;</span>
<a name="__line665"></a>                max_[j]=hopt.max(j+1); 
<a name="__line666"></a>                <span class=comment>//bins_[j]=histopt::default_bins_;</span>
<a name="__line667"></a>                binsize_[j]=hopt.binsize(j+1);
<a name="__line668"></a>            }
<a name="__line669"></a>            else if ( hopt.min(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line670"></a>            {
<a name="__line671"></a>                min_[j]=hopt.min(j+1);
<a name="__line672"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line673"></a>            }
<a name="__line674"></a>            else if ( hopt.max(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line675"></a>            {
<a name="__line676"></a>                <span class=comment>//min_[j]=hopt.max_[j]-histopt::default_binsize_*hopt.bins_[j];</span>
<a name="__line677"></a>                max_[j]=hopt.max(j+1); 
<a name="__line678"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line679"></a>            }
<a name="__line680"></a>            else if ( hopt.binsize(j+1)!=unset &amp;&amp; hopt.bins(j+1)!=0 )
<a name="__line681"></a>            {
<a name="__line682"></a>                <span class=comment>//min_[j]=histopt::default_min_;</span>
<a name="__line683"></a>                <span class=comment>///max_[j]=min_[j]+hopt.binsize_[j]*hopt.bins_[j];</span>
<a name="__line684"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line685"></a>                binsize_[j] = hopt.binsize(j+1);
<a name="__line686"></a>            }
<a name="__line687"></a>            else if ( hopt.min(j+1)!=unset )
<a name="__line688"></a>            {
<a name="__line689"></a>                min_[j]=hopt.min(j+1);
<a name="__line690"></a>            }
<a name="__line691"></a>            else if ( hopt.max(j+1)!=unset )
<a name="__line692"></a>            {
<a name="__line693"></a>                max_[j]=hopt.max(j+1); 
<a name="__line694"></a>            }
<a name="__line695"></a>            else if ( hopt.binsize(j+1)!=unset )
<a name="__line696"></a>            {
<a name="__line697"></a>                binsize_[j] = hopt.binsize(j+1);
<a name="__line698"></a>            }
<a name="__line699"></a>            else if ( hopt.bins(j+1)!=0 )
<a name="__line700"></a>            {
<a name="__line701"></a>                bins_[j]=hopt.bins(j+1);
<a name="__line702"></a>            }
<a name="__line703"></a>
<a name="__line704"></a>            if(min_[j]==unset || max_[j]==unset || bins_[j]&lt;=0 || binsize_[j]==unset)
<a name="__line705"></a>            {
<a name="__line706"></a>                if(buffer_size_&lt;=0)
<a name="__line707"></a>                {
<a name="__line708"></a>                    warning::print("Some axis limits of a histogram were not specified. Automatic buffering with 1000 entries will be used","");
<a name="__line709"></a>                    buffer_size_ = 1000;
<a name="__line710"></a>                }
<a name="__line711"></a>            }
<a name="__line712"></a>
<a name="__line713"></a>            <span class=comment>// If we have enough information to set up the indexint multiplicators (?) then do it now. Otherwise postpone later (after buffering)</span>
<a name="__line714"></a>            if(min_[j]!=unset &amp;&amp; max_[j]!=unset &amp;&amp; bins_[j]!=0)
<a name="__line715"></a>            {
<a name="__line716"></a>                if ( j&lt;dim_-1 ) mul_[j]=mul_[j+1]*bins_[j+1];
<a name="__line717"></a>                sizeh*=bins_[j];
<a name="__line718"></a>            }
<a name="__line719"></a>            else
<a name="__line720"></a>            {
<a name="__line721"></a>                sizeh = 0;
<a name="__line722"></a>            }
<a name="__line723"></a>
<a name="__line724"></a>            if ( j&lt;(int)hopt.axistitle_.size() ) axistitle_[j]=hopt.axistitle_[j];
<a name="__line725"></a>            else axistitle_[j]="";
<a name="__line726"></a>        }
<a name="__line727"></a>        rangetitle_=hopt.rangetitle_;
<a name="__line728"></a>        legend_=hopt.legend_;
<a name="__line729"></a>        if(sizeh&gt;0)
<a name="__line730"></a>        {
<a name="__line731"></a>            h_.resize(sizeh);
<a name="__line732"></a>            m_.resize(sizeh*dim_);
<a name="__line733"></a>            sequence_.resize(sizeh);
<a name="__line734"></a>            invsequence_.resize(sizeh);
<a name="__line735"></a>            for ( int i=0 ; i&lt;sizeh ; ++i )
<a name="__line736"></a>            {
<a name="__line737"></a>                h_[i]=0.0;
<a name="__line738"></a>                for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line739"></a>                {
<a name="__line740"></a>                    m_[i*dim_+j]=1;
<a name="__line741"></a>                }
<a name="__line742"></a>                sequence_[i]=i;
<a name="__line743"></a>                invsequence_[i]=i;
<a name="__line744"></a>            }
<a name="__line745"></a>        }
<a name="__line746"></a>        datapoint_.resize(dim_*2+2);
<a name="__line747"></a>
<a name="__line748"></a>        set_graph_drawer_();
<a name="__line749"></a>
<a name="__line750"></a>    }
<a name="__line751"></a>
<a name="__line752"></a>
<a name="__line753"></a>    void hist::reinit(const double Min, const double Max, const int Bins, const var &amp;Title, 
<a name="__line754"></a>                      const var &amp;rTitle, const var &amp;Legend)
<a name="__line755"></a>    {
<a name="__line756"></a>        reinit(histopt().min(1,Min).max(1,Max).bins(1,Bins).axistitle(1,Title).rangetitle(rTitle).legend(Legend));
<a name="__line757"></a>    }
<a name="__line758"></a>
<a name="__line759"></a>
<a name="__line760"></a>    void hist::reinit(const double Min1, const double Max1, const int Bins1, const var &amp;Title1, 
<a name="__line761"></a>                      const double Min2, const double Max2, const int Bins2, const var &amp;Title2, 
<a name="__line762"></a>                      const var &amp;rTitle, const var &amp;Legend)
<a name="__line763"></a>    {
<a name="__line764"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1).axistitle(1,Title1).min(2,Min2).max(2,Max2).bins(2,Bins2).axistitle(2,Title2).rangetitle(rTitle).legend(Legend));
<a name="__line765"></a>    }
<a name="__line766"></a>
<a name="__line767"></a>
<a name="__line768"></a>    void hist::reinit(const double Min1, const double Max1, const int Bins1, const var &amp;Title1, 
<a name="__line769"></a>                      const double Min2, const double Max2, const int Bins2, const var &amp;Title2, 
<a name="__line770"></a>                      const double Min3, const double Max3, const int Bins3, const var &amp;Title3, 
<a name="__line771"></a>                      const var &amp;rTitle, const var &amp;Legend)
<a name="__line772"></a>    {
<a name="__line773"></a>        reinit(histopt().min(1,Min1).max(1,Max1).bins(1,Bins1).axistitle(1,Title1).min(2,Min2).max(2,Max2).bins(2,Bins2).axistitle(2,Title2).min(3,Min3).max(3,Max3).bins(3,Bins3).axistitle(3,Title3).rangetitle(rTitle).legend(Legend));
<a name="__line774"></a>    }
<a name="__line775"></a>
<a name="__line776"></a>
<a name="__line777"></a>    void hist::reinit(const hist &amp;h_other)
<a name="__line778"></a>    {
<a name="__line779"></a>        plottable::copy_style(h_other);
<a name="__line780"></a>        dim_=h_other.dim_;
<a name="__line781"></a>        min_=h_other.min_;
<a name="__line782"></a>        max_=h_other.max_;
<a name="__line783"></a>        bins_=h_other.bins_;
<a name="__line784"></a>        binsize_=h_other.binsize_;
<a name="__line785"></a>        axistitle_=h_other.axistitle_;
<a name="__line786"></a>        rangetitle_=h_other.rangetitle_;
<a name="__line787"></a>        mul_=h_other.mul_;
<a name="__line788"></a>        ind_=h_other.ind_;
<a name="__line789"></a>        h_=h_other.h_;
<a name="__line790"></a>        m_=h_other.m_;
<a name="__line791"></a>        sequence_=h_other.sequence_;
<a name="__line792"></a>        invsequence_=h_other.invsequence_;
<a name="__line793"></a>        datapoint_=h_other.datapoint_;
<a name="__line794"></a>    }
<a name="__line795"></a>
<a name="__line796"></a>
<a name="__line797"></a>    const hist&amp; hist::operator=(const hist &amp;h_other)
<a name="__line798"></a>    {
<a name="__line799"></a>        if ( dim_!=h_other.dim_ )
<a name="__line800"></a>        {
<a name="__line801"></a>            axistitle_.resize(h_other.dim_);
<a name="__line802"></a>            if ( graph_drawer_!=0 ) delete graph_drawer_;
<a name="__line803"></a>            graph_drawer_=h_other.graph_drawer_-&gt;clone();
<a name="__line804"></a>        }
<a name="__line805"></a>        dim_=h_other.dim_;
<a name="__line806"></a>        min_=h_other.min_;
<a name="__line807"></a>        max_=h_other.max_;
<a name="__line808"></a>        bins_=h_other.bins_;
<a name="__line809"></a>        binsize_=h_other.binsize_;
<a name="__line810"></a>        mul_=h_other.mul_;
<a name="__line811"></a>        ind_=h_other.ind_;
<a name="__line812"></a>        h_=h_other.h_;
<a name="__line813"></a>        m_=h_other.m_;
<a name="__line814"></a>        sequence_=h_other.sequence_;
<a name="__line815"></a>        invsequence_=h_other.invsequence_;
<a name="__line816"></a>        datapoint_=h_other.datapoint_;
<a name="__line817"></a>        return *this;
<a name="__line818"></a>    }
<a name="__line819"></a>
<a name="__line820"></a>
<a name="__line821"></a>    const hist&amp; hist::operator+=(const hist &amp;h_other)
<a name="__line822"></a>    {
<a name="__line823"></a>        if ( dim_!=h_other.dim_ )
<a name="__line824"></a>        {
<a name="__line825"></a>            warning::print("Non-matching histograms!", "const hist&amp; hist::operator+=(const hist&amp;)");
<a name="__line826"></a>            return *this;
<a name="__line827"></a>        }
<a name="__line828"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line829"></a>        {
<a name="__line830"></a>            if ( min_[j]!=h_other.min_[j] || 
<a name="__line831"></a>                 max_[j]!=h_other.max_[j]  || 
<a name="__line832"></a>                 bins_[j]!=h_other.bins_[j] )
<a name="__line833"></a>            {
<a name="__line834"></a>                warning::print("Non-matching histograms!", "const hist&amp; hist::operator+=(const hist&amp;)");
<a name="__line835"></a>                return *this;
<a name="__line836"></a>            }
<a name="__line837"></a>        }
<a name="__line838"></a>        bool skip;
<a name="__line839"></a>        int hsize=h_.size();
<a name="__line840"></a>        for ( int i=0 ; i&lt;hsize ; ++i )
<a name="__line841"></a>        {
<a name="__line842"></a>            skip=false;
<a name="__line843"></a>            for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line844"></a>            {
<a name="__line845"></a>                if ( m_[i*dim_+j]!=h_other.m_[i*dim_+j] )
<a name="__line846"></a>                {
<a name="__line847"></a>                    warning::print("Non-matching histograms!", "const hist&amp; hist::operator+=(const hist&amp;)");
<a name="__line848"></a>                    return *this;
<a name="__line849"></a>                }
<a name="__line850"></a>                if ( m_[i*dim_+j]==0 ) { skip=true ; break; }
<a name="__line851"></a>            }
<a name="__line852"></a>            if ( skip==false ) h_[i]+=h_other.h_[i];
<a name="__line853"></a>        }
<a name="__line854"></a>        return *this;
<a name="__line855"></a>    }
<a name="__line856"></a>
<a name="__line857"></a>
<a name="__line858"></a>    const hist&amp; hist::operator-=(const hist &amp;h_other)
<a name="__line859"></a>    {
<a name="__line860"></a>        if ( dim_!=h_other.dim_ )
<a name="__line861"></a>        {
<a name="__line862"></a>            warning::print("Non-matching histograms!", "const hist&amp; hist::operator-=(const hist&amp;)");
<a name="__line863"></a>            return *this;
<a name="__line864"></a>        }
<a name="__line865"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line866"></a>        {
<a name="__line867"></a>            if ( min_[j]!=h_other.min_[j] || 
<a name="__line868"></a>                 max_[j]!=h_other.max_[j]  || 
<a name="__line869"></a>                 bins_[j]!=h_other.bins_[j] )
<a name="__line870"></a>            {
<a name="__line871"></a>                warning::print("Non-matching histograms!", "hist::operator-=(const hist&amp;)");
<a name="__line872"></a>                return *this;
<a name="__line873"></a>            }
<a name="__line874"></a>        }
<a name="__line875"></a>        bool skip;
<a name="__line876"></a>        int hsize=h_.size();
<a name="__line877"></a>        for ( int i=0 ; i&lt;hsize ; ++i )
<a name="__line878"></a>        {
<a name="__line879"></a>            skip=false;
<a name="__line880"></a>            for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line881"></a>            {
<a name="__line882"></a>                if ( m_[i*dim_+j]!=h_other.m_[i*dim_+j] )
<a name="__line883"></a>                {
<a name="__line884"></a>                    warning::print("Non-matching histograms!", "const hist&amp; hist::operator-=(const hist&amp;)");
<a name="__line885"></a>                    return *this;
<a name="__line886"></a>                }
<a name="__line887"></a>                if ( m_[i*dim_+j]==0 ) { skip=true ; break; }
<a name="__line888"></a>            }
<a name="__line889"></a>            if ( skip==false ) h_[i]-=h_other.h_[i];
<a name="__line890"></a>        }
<a name="__line891"></a>        return *this;
<a name="__line892"></a>    }
<a name="__line893"></a>
<a name="__line894"></a>
<a name="__line895"></a>    const hist&amp; hist::operator*=(const hist &amp;h_other)
<a name="__line896"></a>    {
<a name="__line897"></a>        if ( dim_!=h_other.dim_ )
<a name="__line898"></a>        {
<a name="__line899"></a>            warning::print("Non-matching histograms!", "const hist&amp; hist::operator*=(const hist&amp;)");
<a name="__line900"></a>            return *this;
<a name="__line901"></a>        }
<a name="__line902"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line903"></a>        {
<a name="__line904"></a>            if ( min_[j]!=h_other.min_[j] || 
<a name="__line905"></a>                 max_[j]!=h_other.max_[j]  || 
<a name="__line906"></a>                 bins_[j]!=h_other.bins_[j] )
<a name="__line907"></a>            {
<a name="__line908"></a>                warning::print("Non-matching histograms!", "const hist&amp; hist::operator*=(const hist&amp;)");
<a name="__line909"></a>                return *this;
<a name="__line910"></a>            }
<a name="__line911"></a>        }
<a name="__line912"></a>        bool skip;
<a name="__line913"></a>        int hsize=h_.size();
<a name="__line914"></a>        for ( int i=0 ; i&lt;hsize ; ++i )
<a name="__line915"></a>        {
<a name="__line916"></a>            skip=false;
<a name="__line917"></a>            for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line918"></a>            {
<a name="__line919"></a>                if ( m_[i*dim_+j]!=h_other.m_[i*dim_+j] )
<a name="__line920"></a>                {
<a name="__line921"></a>                    warning::print("Non-matching histograms!", "const hist&amp; hist::operator*=(const hist&amp;)");
<a name="__line922"></a>                    return *this;
<a name="__line923"></a>                }
<a name="__line924"></a>                if ( m_[i*dim_+j]==0 ) { skip=true ; break; }
<a name="__line925"></a>            }
<a name="__line926"></a>            if ( skip==false ) h_[i]*=h_other.h_[i];
<a name="__line927"></a>        }
<a name="__line928"></a>        return *this;
<a name="__line929"></a>    }
<a name="__line930"></a>
<a name="__line931"></a>
<a name="__line932"></a>    const hist&amp; hist::operator*=(const meas &amp;a)
<a name="__line933"></a>    {
<a name="__line934"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i ) h_[sequence_[i]]*=a;
<a name="__line935"></a>        return *this;
<a name="__line936"></a>    }
<a name="__line937"></a>
<a name="__line938"></a>
<a name="__line939"></a>    const hist&amp; hist::operator*=(const double a)
<a name="__line940"></a>    {
<a name="__line941"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i ) h_[sequence_[i]]*=a;
<a name="__line942"></a>        return *this;
<a name="__line943"></a>    }
<a name="__line944"></a>
<a name="__line945"></a>
<a name="__line946"></a>    const hist&amp; hist::operator/=(const hist &amp;h_other)
<a name="__line947"></a>    {
<a name="__line948"></a>        if ( dim_!=h_other.dim_ )
<a name="__line949"></a>        {
<a name="__line950"></a>            warning::print("Non-matching histograms!", "const hist&amp; hist::operator/=(const hist&amp;)");
<a name="__line951"></a>            return *this;
<a name="__line952"></a>        }
<a name="__line953"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line954"></a>        {
<a name="__line955"></a>            if ( min_[j]!=h_other.min_[j] || 
<a name="__line956"></a>                 max_[j]!=h_other.max_[j]  || 
<a name="__line957"></a>                 bins_[j]!=h_other.bins_[j] )
<a name="__line958"></a>            {
<a name="__line959"></a>                warning::print("Non-matching histograms!", "const hist&amp; hist::operator/=(const hist&amp;)");
<a name="__line960"></a>                return *this;
<a name="__line961"></a>            }
<a name="__line962"></a>        }
<a name="__line963"></a>        bool skip;
<a name="__line964"></a>        int hsize=h_.size();
<a name="__line965"></a>        for ( int i=0 ; i&lt;hsize ; ++i )
<a name="__line966"></a>        {
<a name="__line967"></a>            skip=false;
<a name="__line968"></a>            for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line969"></a>            {
<a name="__line970"></a>                if ( m_[i*dim_+j]!=h_other.m_[i*dim_+j] )
<a name="__line971"></a>                {
<a name="__line972"></a>                    warning::print("Non-matching histograms!", "const hist&amp; hist::operator/=(const hist&amp;)");
<a name="__line973"></a>                    return *this;
<a name="__line974"></a>                }
<a name="__line975"></a>                if ( m_[i*dim_+j]==0 ) { skip=true ; break; }
<a name="__line976"></a>            }
<a name="__line977"></a>            if ( skip==false ) h_[i]/=h_other.h_[i];
<a name="__line978"></a>        }
<a name="__line979"></a>        return *this;
<a name="__line980"></a>    }
<a name="__line981"></a>
<a name="__line982"></a>
<a name="__line983"></a>    const hist&amp; hist::operator/=(const meas &amp;a)
<a name="__line984"></a>    {
<a name="__line985"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i ) h_[sequence_[i]]/=a;
<a name="__line986"></a>        return *this;
<a name="__line987"></a>    }
<a name="__line988"></a>
<a name="__line989"></a>
<a name="__line990"></a>    const hist&amp; hist::operator/=(const double a)
<a name="__line991"></a>    {
<a name="__line992"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i ) h_[sequence_[i]]/=a;
<a name="__line993"></a>        return *this;
<a name="__line994"></a>    }
<a name="__line995"></a>
<a name="__line996"></a>
<a name="__line997"></a>    hist operator+(const hist &amp;h, const hist &amp;h_other)
<a name="__line998"></a>    {
<a name="__line999"></a>        hist result=h;
<a name="__line1000"></a>        result+=h_other;
<a name="__line1001"></a>        result.legend((const var)"("&amp;h.legend()&amp;"+"&amp;h_other.legend()&amp;")");
<a name="__line1002"></a>        return result;
<a name="__line1003"></a>    }
<a name="__line1004"></a>
<a name="__line1005"></a>
<a name="__line1006"></a>    hist operator-(const hist &amp;h, const hist &amp;h_other)
<a name="__line1007"></a>    {
<a name="__line1008"></a>        hist result=h;
<a name="__line1009"></a>        result-=h_other;
<a name="__line1010"></a>        result.legend((const var)"("&amp;h.legend()&amp;"-"&amp;h_other.legend()&amp;")");
<a name="__line1011"></a>        return result;
<a name="__line1012"></a>    }
<a name="__line1013"></a>
<a name="__line1014"></a>
<a name="__line1015"></a>    hist operator-(const hist &amp;h)
<a name="__line1016"></a>    {
<a name="__line1017"></a>        hist result=h;
<a name="__line1018"></a>        result.annulate();
<a name="__line1019"></a>        result-=h;
<a name="__line1020"></a>        result.legend((const var)"(-"&amp;h.legend()&amp;")");
<a name="__line1021"></a>        return result;
<a name="__line1022"></a>    }
<a name="__line1023"></a>
<a name="__line1024"></a>
<a name="__line1025"></a>    hist operator*(const hist &amp;h, const hist &amp;h_other)
<a name="__line1026"></a>    {
<a name="__line1027"></a>        hist result=h;
<a name="__line1028"></a>        result*=h_other;
<a name="__line1029"></a>        result.legend((const var)"("&amp;h.legend()&amp;"*"&amp;h_other.legend()&amp;")");
<a name="__line1030"></a>        return result;
<a name="__line1031"></a>    }
<a name="__line1032"></a>
<a name="__line1033"></a>
<a name="__line1034"></a>    hist operator*(const hist &amp;h, const meas &amp;a)
<a name="__line1035"></a>    {
<a name="__line1036"></a>        hist result=h;
<a name="__line1037"></a>        result*=a;
<a name="__line1038"></a>        result.legend((const var)"("&amp;h.legend()&amp;"*("&amp;a.to_var()&amp;"))");
<a name="__line1039"></a>        return result;
<a name="__line1040"></a>    }
<a name="__line1041"></a>
<a name="__line1042"></a>
<a name="__line1043"></a>    hist operator*(const hist &amp;h, const double da)
<a name="__line1044"></a>    {
<a name="__line1045"></a>        hist result=h;
<a name="__line1046"></a>        result*=da;
<a name="__line1047"></a>        result.legend((const var)"("&amp;h.legend()&amp;"*("&amp;da&amp;"))");
<a name="__line1048"></a>        return result;
<a name="__line1049"></a>    }
<a name="__line1050"></a>
<a name="__line1051"></a>
<a name="__line1052"></a>    hist operator*(const meas &amp;a, const hist &amp;h)
<a name="__line1053"></a>    {
<a name="__line1054"></a>        hist result=h;
<a name="__line1055"></a>        result*=a;
<a name="__line1056"></a>        result.legend((const var)"(("&amp;a.to_var()&amp;")*"&amp;h.legend()&amp;")");
<a name="__line1057"></a>        return result;
<a name="__line1058"></a>    }
<a name="__line1059"></a>
<a name="__line1060"></a>
<a name="__line1061"></a>    hist operator*(const double da, const hist &amp;h)
<a name="__line1062"></a>    {
<a name="__line1063"></a>        hist result=h;
<a name="__line1064"></a>        result*=da;
<a name="__line1065"></a>        result.legend((const var)"(("&amp;da&amp;")*"&amp;h.legend()&amp;")");
<a name="__line1066"></a>        return result;
<a name="__line1067"></a>    }
<a name="__line1068"></a>
<a name="__line1069"></a>
<a name="__line1070"></a>    hist operator/(const hist &amp;h, const hist &amp;h_other)
<a name="__line1071"></a>    {
<a name="__line1072"></a>        hist result=h;
<a name="__line1073"></a>        result/=h_other;
<a name="__line1074"></a>        result.legend((const var)"("&amp;h.legend()&amp;"/"&amp;h_other.legend()&amp;")");
<a name="__line1075"></a>        return result;
<a name="__line1076"></a>    }
<a name="__line1077"></a>
<a name="__line1078"></a>
<a name="__line1079"></a>    hist operator/(const hist &amp;h, const meas &amp;a)
<a name="__line1080"></a>    {
<a name="__line1081"></a>        hist result=h;
<a name="__line1082"></a>        result/=a;
<a name="__line1083"></a>        result.legend((const var)"("&amp;h.legend()&amp;"/("&amp;a.to_var()&amp;"))");
<a name="__line1084"></a>        return result;
<a name="__line1085"></a>    }
<a name="__line1086"></a>
<a name="__line1087"></a>
<a name="__line1088"></a>    hist operator/(const hist &amp;h, const double da)
<a name="__line1089"></a>    {
<a name="__line1090"></a>        hist result=h;
<a name="__line1091"></a>        result/=da;
<a name="__line1092"></a>        result.legend((const var)"("&amp;h.legend()&amp;"/("&amp;da&amp;"))");
<a name="__line1093"></a>        return result;
<a name="__line1094"></a>    }
<a name="__line1095"></a>
<a name="__line1096"></a>
<a name="__line1097"></a>    hist operator/(const meas &amp;a, const hist &amp;h)
<a name="__line1098"></a>    {
<a name="__line1099"></a>        hist result=h;
<a name="__line1100"></a>        result/=a;
<a name="__line1101"></a>        result.transform(1.0/_1);
<a name="__line1102"></a>        result.legend((const var)"(("&amp;a.to_var()&amp;")/"&amp;h.legend()&amp;")");
<a name="__line1103"></a>        return result;
<a name="__line1104"></a>    }
<a name="__line1105"></a>
<a name="__line1106"></a>
<a name="__line1107"></a>    hist operator/(const double da, const hist &amp;h)
<a name="__line1108"></a>    {
<a name="__line1109"></a>        hist result=h;
<a name="__line1110"></a>        result/=da;
<a name="__line1111"></a>        result.transform(1.0/_1);
<a name="__line1112"></a>        result.legend((const var)"(("&amp;da&amp;")*"&amp;h.legend()&amp;")");
<a name="__line1113"></a>        return result;
<a name="__line1114"></a>    }
<a name="__line1115"></a>
<a name="__line1116"></a>
<a name="__line1117"></a>    hist hist::project_out(const int axis) const
<a name="__line1118"></a>    {
<a name="__line1119"></a>        if ( dim_&lt;=1 )
<a name="__line1120"></a>        {
<a name="__line1121"></a>            warning::print("Dimension has to be greater than 1 for projection!", "hist hist::project_out(const int)");
<a name="__line1122"></a>            return hist();
<a name="__line1123"></a>        }
<a name="__line1124"></a>        int Axis=axis-1;
<a name="__line1125"></a>        if ( Axis&lt;0 || Axis&gt;=dim_ )
<a name="__line1126"></a>        {
<a name="__line1127"></a>            warning::print("Axis index out of range in projection! (1-based indices!!!)", "hist hist::project_out(const int)");
<a name="__line1128"></a>            return hist();
<a name="__line1129"></a>        }
<a name="__line1130"></a>        hist result;
<a name="__line1131"></a>        bool skip=false;
<a name="__line1132"></a>        int i=0, iprime=0, iprimeprime=0;
<a name="__line1133"></a>        int j=0;
<a name="__line1134"></a>        result.dim_=dim_-1;
<a name="__line1135"></a>        result.min_=min_;
<a name="__line1136"></a>        result.min_.erase(result.min_.begin()+Axis);
<a name="__line1137"></a>        result.max_=max_;
<a name="__line1138"></a>        result.max_.erase(result.max_.begin()+Axis);
<a name="__line1139"></a>        result.bins_=bins_;
<a name="__line1140"></a>        result.bins_.erase(result.bins_.begin()+Axis);
<a name="__line1141"></a>        result.binsize_=binsize_;
<a name="__line1142"></a>        result.binsize_.erase(result.binsize_.begin()+Axis);
<a name="__line1143"></a>        result.axistitle_=axistitle_;
<a name="__line1144"></a>        result.axistitle_.erase(result.axistitle_.begin()+Axis);
<a name="__line1145"></a>        result.legend_=(const var)"project_out("&amp;legend_&amp;", "&amp;(Axis+1)&amp;")";
<a name="__line1146"></a>        result.mul_=mul_;
<a name="__line1147"></a>        result.mul_.erase(result.mul_.begin()+Axis);
<a name="__line1148"></a>        result.ind_=ind_;
<a name="__line1149"></a>        result.ind_.erase(result.ind_.begin()+Axis);
<a name="__line1150"></a>        result.datapoint_=datapoint_;
<a name="__line1151"></a>        result.datapoint_.erase(result.datapoint_.begin()+Axis);
<a name="__line1152"></a>        result.datapoint_.erase(result.datapoint_.begin()+result.dim_+1+Axis);
<a name="__line1153"></a>        result.mul_[result.dim_-1]=1;
<a name="__line1154"></a>        for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1155"></a>        {
<a name="__line1156"></a>            if ( j&lt;result.dim_-1 ) result.mul_[j]=result.mul_[j+1]*result.bins_[j+1];
<a name="__line1157"></a>        }
<a name="__line1158"></a>        int hsize=result.mul_[0]*result.bins_[0];
<a name="__line1159"></a>        result.h_.resize(hsize);
<a name="__line1160"></a>        result.m_.resize(hsize*result.dim_);
<a name="__line1161"></a>        result.sequence_.clear();
<a name="__line1162"></a>        result.invsequence_.clear();
<a name="__line1163"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line1164"></a>        {
<a name="__line1165"></a>            result.ind_[result.dim_-1]=i;
<a name="__line1166"></a>            for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1167"></a>            {
<a name="__line1168"></a>                if ( j&lt;result.dim_-1 ) result.ind_[j]=result.ind_[j+1]/result.bins_[j+1];
<a name="__line1169"></a>            }
<a name="__line1170"></a>            int iprimebase=0;
<a name="__line1171"></a>            result.h_[i]=0.0;
<a name="__line1172"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1173"></a>            {
<a name="__line1174"></a>                result.ind_[j]=result.ind_[j]%result.bins_[j];
<a name="__line1175"></a>                if ( j&lt;Axis ) iprimebase+=mul_[j]*result.ind_[j];
<a name="__line1176"></a>                else iprimebase+=mul_[j+1]*result.ind_[j];
<a name="__line1177"></a>                result.m_[i*result.dim_+j]=0;
<a name="__line1178"></a>            }
<a name="__line1179"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1180"></a>            {
<a name="__line1181"></a>                for ( int indprime=0 ; indprime&lt;bins_[Axis] ; ++indprime )
<a name="__line1182"></a>                {
<a name="__line1183"></a>                    iprime=iprimebase+mul_[Axis]*indprime;
<a name="__line1184"></a>                    if ( j&lt;Axis )
<a name="__line1185"></a>                    {
<a name="__line1186"></a>                        if ( m_[iprime*dim_+j]==0 ) { result.m_[i*result.dim_+j]=0; break; }
<a name="__line1187"></a>                        if ( m_[iprime*dim_+j]&gt;result.m_[i*result.dim_+j] ) result.m_[i*result.dim_+j]=m_[iprime*dim_+j];
<a name="__line1188"></a>                    }
<a name="__line1189"></a>                    else
<a name="__line1190"></a>                    {
<a name="__line1191"></a>                        if ( m_[iprime*dim_+j+1]==0 ) { result.m_[i*result.dim_+j]=0; break; }
<a name="__line1192"></a>                        if ( m_[iprime*dim_+j+1]&gt;result.m_[i*result.dim_+j] ) result.m_[i*result.dim_+j]=m_[iprime*dim_+j+1];
<a name="__line1193"></a>                    }
<a name="__line1194"></a>                }
<a name="__line1195"></a>            }
<a name="__line1196"></a>        }
<a name="__line1197"></a>        iprimeprime=0;
<a name="__line1198"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line1199"></a>        {
<a name="__line1200"></a>            int indprime;
<a name="__line1201"></a>            int iprimeprimeprimebase;
<a name="__line1202"></a>            int iprimeprimeprime;
<a name="__line1203"></a>            meas h;
<a name="__line1204"></a>            skip=false;
<a name="__line1205"></a>            result.ind_[result.dim_-1]=i;
<a name="__line1206"></a>            iprimeprimeprimebase=0;
<a name="__line1207"></a>            for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1208"></a>            {
<a name="__line1209"></a>                if ( result.m_[i*result.dim_+j]==0 ) skip=true;
<a name="__line1210"></a>                if ( j&lt;result.dim_-1 ) result.ind_[j]=result.ind_[j+1]/result.bins_[j+1];
<a name="__line1211"></a>                if ( j&lt;Axis ) iprimeprimeprimebase+=mul_[j]*(result.ind_[j]%result.bins_[j]);
<a name="__line1212"></a>                else iprimeprimeprimebase+=mul_[j+1]*(result.ind_[j]%result.bins_[j]);
<a name="__line1213"></a>            }
<a name="__line1214"></a>            if ( skip==false )
<a name="__line1215"></a>            {
<a name="__line1216"></a>                for ( indprime=0 ; indprime&lt;bins_[Axis] ; ++indprime )
<a name="__line1217"></a>                {
<a name="__line1218"></a>                    iprimeprimeprime=iprimeprimeprimebase+mul_[Axis]*indprime;
<a name="__line1219"></a>                    h=h_[iprimeprimeprime];
<a name="__line1220"></a>                    for ( j=0 ; j&lt;dim_ ; ++j ) h*=(double)(m_[iprimeprimeprime*dim_+j]);
<a name="__line1221"></a>                    result.h_[i]+=h;
<a name="__line1222"></a>                }
<a name="__line1223"></a>                result.sequence_.push_back(i);
<a name="__line1224"></a>                result.invsequence_.push_back(iprimeprime);
<a name="__line1225"></a>                ++iprimeprime;
<a name="__line1226"></a>                continue;
<a name="__line1227"></a>            }
<a name="__line1228"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1229"></a>            {
<a name="__line1230"></a>                result.ind_[j]=result.ind_[j]%result.bins_[j];
<a name="__line1231"></a>            }
<a name="__line1232"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1233"></a>            {
<a name="__line1234"></a>                while ( result.ind_[j]&gt;=0 )
<a name="__line1235"></a>                {
<a name="__line1236"></a>                    iprime=0;
<a name="__line1237"></a>                    for ( int jprime=0 ; jprime&lt;result.dim_ ; ++jprime ) iprime+=result.ind_[jprime]*result.mul_[jprime];
<a name="__line1238"></a>                    if ( result.m_[iprime*result.dim_+j]==0 ) { --result.ind_[j]; } else { break; }
<a name="__line1239"></a>                }
<a name="__line1240"></a>            }
<a name="__line1241"></a>            if ( (unsigned int)(iprime)&gt;=result.invsequence_.size() )
<a name="__line1242"></a>            {
<a name="__line1243"></a>                warning::print("Index inconsistency when projecting histogram!", "hist hist::project_out(const int)");
<a name="__line1244"></a>                return hist();
<a name="__line1245"></a>            }
<a name="__line1246"></a>            result.invsequence_.push_back(result.invsequence_[iprime]);
<a name="__line1247"></a>            for ( indprime=0 ; indprime&lt;bins_[Axis] ; ++indprime )
<a name="__line1248"></a>            {
<a name="__line1249"></a>                iprimeprimeprime=iprimeprimeprimebase+mul_[Axis]*indprime;
<a name="__line1250"></a>                h=h_[iprimeprimeprime];
<a name="__line1251"></a>                for ( j=0 ; j&lt;dim_ ; ++j ) h*=(double)(m_[iprimeprimeprime*dim_+j]);
<a name="__line1252"></a>                result.h_[iprime]+=h;
<a name="__line1253"></a>            }
<a name="__line1254"></a>        }
<a name="__line1255"></a>        hsize=result.sequence_.size();
<a name="__line1256"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line1257"></a>        {
<a name="__line1258"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j ) result.h_[result.sequence_[i]]/=(double)(result.m_[result.sequence_[i]*result.dim_+j]);
<a name="__line1259"></a>        }
<a name="__line1260"></a>        return result;
<a name="__line1261"></a>    }
<a name="__line1262"></a>
<a name="__line1263"></a>
<a name="__line1264"></a>    hist hist::slice(const int axis, const double level) const
<a name="__line1265"></a>    {
<a name="__line1266"></a>        if ( dim_&lt;=1 )
<a name="__line1267"></a>        {
<a name="__line1268"></a>            warning::print("Dimension has to be greater than 1 for slicing!", "hist hist::slice(const int, const double)");
<a name="__line1269"></a>            return hist();
<a name="__line1270"></a>        }
<a name="__line1271"></a>        int Axis=axis-1;
<a name="__line1272"></a>        if ( Axis&lt;0 || Axis&gt;=dim_ )
<a name="__line1273"></a>        {
<a name="__line1274"></a>            warning::print("Axis index out of range in slice! (1-based indices!!!)", "hist hist::slice(const int, const double)");
<a name="__line1275"></a>            return hist();
<a name="__line1276"></a>        }
<a name="__line1277"></a>        bool skip=false;
<a name="__line1278"></a>        int i=0, iprime=0, iprimeprime=0;
<a name="__line1279"></a>        int j=0;
<a name="__line1280"></a>        hist result;
<a name="__line1281"></a>        int Level=(int)((level-min_[Axis])/binsize_[Axis]*(1.0+0.001/bins_[Axis]));
<a name="__line1282"></a>        if ( Level&lt;0 ) { Level=0; } if ( Level&gt;bins_[Axis]-1 ) { Level=bins_[Axis]-1; }
<a name="__line1283"></a>        result.dim_=dim_-1;
<a name="__line1284"></a>        result.min_=min_;
<a name="__line1285"></a>        result.min_.erase(result.min_.begin()+Axis);
<a name="__line1286"></a>        result.max_=max_;
<a name="__line1287"></a>        result.max_.erase(result.max_.begin()+Axis);
<a name="__line1288"></a>        result.bins_=bins_;
<a name="__line1289"></a>        result.bins_.erase(result.bins_.begin()+Axis);
<a name="__line1290"></a>        result.binsize_=binsize_;
<a name="__line1291"></a>        result.binsize_.erase(result.binsize_.begin()+Axis);
<a name="__line1292"></a>        result.axistitle_=axistitle_;
<a name="__line1293"></a>        result.axistitle_.erase(result.axistitle_.begin()+Axis);
<a name="__line1294"></a>        result.legend_=(const var)"slice("&amp;legend_&amp;", "&amp;(Axis+1)&amp;", "&amp;(level)&amp;")";
<a name="__line1295"></a>        result.mul_=mul_;
<a name="__line1296"></a>        result.mul_.erase(result.mul_.begin()+Axis);
<a name="__line1297"></a>        result.ind_=ind_;
<a name="__line1298"></a>        result.ind_.erase(result.ind_.begin()+Axis);
<a name="__line1299"></a>        result.datapoint_=datapoint_;
<a name="__line1300"></a>        result.datapoint_.erase(result.datapoint_.begin()+Axis);
<a name="__line1301"></a>        result.datapoint_.erase(result.datapoint_.begin()+result.dim_+1+Axis);
<a name="__line1302"></a>        result.mul_[result.dim_-1]=1;
<a name="__line1303"></a>        for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1304"></a>        {
<a name="__line1305"></a>            if ( j&lt;result.dim_-1 ) result.mul_[j]=result.mul_[j+1]*result.bins_[j+1];
<a name="__line1306"></a>        }
<a name="__line1307"></a>        int hsize=result.mul_[0]*result.bins_[0];
<a name="__line1308"></a>        result.h_.resize(hsize);
<a name="__line1309"></a>        result.m_.resize(hsize*result.dim_);
<a name="__line1310"></a>        result.sequence_.clear();
<a name="__line1311"></a>        result.invsequence_.clear();
<a name="__line1312"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line1313"></a>        {
<a name="__line1314"></a>            result.ind_[result.dim_-1]=i;
<a name="__line1315"></a>            for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1316"></a>            {
<a name="__line1317"></a>                if ( j&lt;result.dim_-1 ) result.ind_[j]=result.ind_[j+1]/result.bins_[j+1];
<a name="__line1318"></a>            }
<a name="__line1319"></a>            int iprimebase=0;
<a name="__line1320"></a>            result.h_[i]=0.0;
<a name="__line1321"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1322"></a>            {
<a name="__line1323"></a>                result.ind_[j]=result.ind_[j]%result.bins_[j];
<a name="__line1324"></a>                if ( j&lt;Axis ) iprimebase+=mul_[j]*result.ind_[j];
<a name="__line1325"></a>                else iprimebase+=mul_[j+1]*result.ind_[j];
<a name="__line1326"></a>                result.m_[i*result.dim_+j]=0;
<a name="__line1327"></a>            }
<a name="__line1328"></a>            for ( int indprime=Level ; indprime&gt;=0 ; --indprime )
<a name="__line1329"></a>            {
<a name="__line1330"></a>                iprime=iprimebase+mul_[Axis]*indprime;
<a name="__line1331"></a>                if ( m_[iprime*dim_+Axis]&gt;0 ) break;
<a name="__line1332"></a>            }
<a name="__line1333"></a>            result.h_[i]=h_[iprime];
<a name="__line1334"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1335"></a>            {
<a name="__line1336"></a>                if ( j&lt;Axis ) result.m_[i*result.dim_+j]=m_[iprime*dim_+j];
<a name="__line1337"></a>                else result.m_[i*result.dim_+j]=m_[iprime*dim_+j+1];
<a name="__line1338"></a>            }
<a name="__line1339"></a>        }
<a name="__line1340"></a>        iprimeprime=0;
<a name="__line1341"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line1342"></a>        {
<a name="__line1343"></a>            skip=false;
<a name="__line1344"></a>            result.ind_[result.dim_-1]=i;
<a name="__line1345"></a>            for ( j=result.dim_-1 ; j&gt;=0 ; --j )
<a name="__line1346"></a>            {
<a name="__line1347"></a>                if ( result.m_[i*result.dim_+j]==0 ) skip=true;
<a name="__line1348"></a>                if ( j&lt;result.dim_-1 ) result.ind_[j]=result.ind_[j+1]/result.bins_[j+1];
<a name="__line1349"></a>            }
<a name="__line1350"></a>            if ( skip==false )
<a name="__line1351"></a>            {
<a name="__line1352"></a>                result.sequence_.push_back(i);
<a name="__line1353"></a>                result.invsequence_.push_back(iprimeprime);
<a name="__line1354"></a>                ++iprimeprime;
<a name="__line1355"></a>                continue;
<a name="__line1356"></a>            }
<a name="__line1357"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1358"></a>            {
<a name="__line1359"></a>                result.ind_[j]=result.ind_[j]%result.bins_[j];
<a name="__line1360"></a>            }
<a name="__line1361"></a>            for ( j=0 ; j&lt;result.dim_ ; ++j )
<a name="__line1362"></a>            {
<a name="__line1363"></a>                while ( result.ind_[j]&gt;=0 )
<a name="__line1364"></a>                {
<a name="__line1365"></a>                    iprime=0;
<a name="__line1366"></a>                    for ( int jprime=0 ; jprime&lt;result.dim_ ; ++jprime ) iprime+=result.ind_[jprime]*result.mul_[jprime];
<a name="__line1367"></a>                    if ( result.m_[iprime*result.dim_+j]==0 ) { --result.ind_[j]; } else { break; }
<a name="__line1368"></a>                }
<a name="__line1369"></a>            }
<a name="__line1370"></a>            if ( (unsigned int)(iprime)&gt;=result.invsequence_.size() )
<a name="__line1371"></a>            {
<a name="__line1372"></a>                warning::print("Index inconsistency when slicing histogram!", "hist hist::slice(const int, const double)");
<a name="__line1373"></a>                return hist();
<a name="__line1374"></a>            }
<a name="__line1375"></a>            result.invsequence_.push_back(result.invsequence_[iprime]);
<a name="__line1376"></a>        }
<a name="__line1377"></a>        return result;
<a name="__line1378"></a>    }
<a name="__line1379"></a>
<a name="__line1380"></a>
<a name="__line1381"></a>    meas hist::integral() const
<a name="__line1382"></a>    {
<a name="__line1383"></a>        meas result(0.0, 0.0);
<a name="__line1384"></a>        bool skip;
<a name="__line1385"></a>        double m;
<a name="__line1386"></a>        for ( unsigned int i=0 ; i&lt;h_.size() ; ++i )
<a name="__line1387"></a>        {
<a name="__line1388"></a>            skip=false;
<a name="__line1389"></a>            m=1.0;
<a name="__line1390"></a>            for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1391"></a>            {
<a name="__line1392"></a>                if ( m_[i*dim_+j]==0 ) { skip=true ; break; }
<a name="__line1393"></a>                m*=m_[i*dim_+j];
<a name="__line1394"></a>            }
<a name="__line1395"></a>            if ( skip==false &amp;&amp; h_[i].isok() ) result+=h_[i]*m;
<a name="__line1396"></a>        }
<a name="__line1397"></a>        return result;
<a name="__line1398"></a>    }
<a name="__line1399"></a>
<a name="__line1400"></a>
<a name="__line1401"></a>    meas integral(const hist &amp;h)
<a name="__line1402"></a>    {
<a name="__line1403"></a>        return h.integral();
<a name="__line1404"></a>    }
<a name="__line1405"></a>
<a name="__line1406"></a>
<a name="__line1407"></a>    hist apply(const function &amp;f, const hist&amp; h)
<a name="__line1408"></a>    {
<a name="__line1409"></a>        hist result=h;
<a name="__line1410"></a>        result.transform(f);
<a name="__line1411"></a>        result.legend(f.sprint().replace("_1", h.legend()));
<a name="__line1412"></a>        return result;
<a name="__line1413"></a>    }
<a name="__line1414"></a>
<a name="__line1415"></a>
<a name="__line1416"></a>    void hist::transform(const function &amp;f)
<a name="__line1417"></a>    {
<a name="__line1418"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1419"></a>        {
<a name="__line1420"></a><span class=comment>//	h_[sequence_[i]].transform(f);</span>
<a name="__line1421"></a>            h_[sequence_[i]] = f(h_[sequence_[i]]); 
<a name="__line1422"></a>        }
<a name="__line1423"></a>    }
<a name="__line1424"></a>
<a name="__line1425"></a>
<a name="__line1426"></a>    bool hist::isfinite() const
<a name="__line1427"></a>    {
<a name="__line1428"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1429"></a>        {
<a name="__line1430"></a>            if ( meas::isfinite(h_[sequence_[i]])==false ) return false;
<a name="__line1431"></a>        }
<a name="__line1432"></a>        return true;
<a name="__line1433"></a>    }
<a name="__line1434"></a>
<a name="__line1435"></a>
<a name="__line1436"></a>    bool hist::isinf() const
<a name="__line1437"></a>    {
<a name="__line1438"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1439"></a>        {
<a name="__line1440"></a>            if ( meas::isinf(h_[sequence_[i]])==true ) return true;
<a name="__line1441"></a>        }
<a name="__line1442"></a>        return false;
<a name="__line1443"></a>    }
<a name="__line1444"></a>
<a name="__line1445"></a>
<a name="__line1446"></a>    bool hist::isnan() const
<a name="__line1447"></a>    {
<a name="__line1448"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1449"></a>        {
<a name="__line1450"></a>            if ( meas::isnan(h_[sequence_[i]])==true ) return true;
<a name="__line1451"></a>        }
<a name="__line1452"></a>        return false;
<a name="__line1453"></a>    }
<a name="__line1454"></a>
<a name="__line1455"></a>
<a name="__line1456"></a>    bool hist::isset() const
<a name="__line1457"></a>    {
<a name="__line1458"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1459"></a>        {
<a name="__line1460"></a>            if ( meas::isset(h_[sequence_[i]])==false ) return false;
<a name="__line1461"></a>        }
<a name="__line1462"></a>        return true;
<a name="__line1463"></a>    }
<a name="__line1464"></a>
<a name="__line1465"></a>
<a name="__line1466"></a>    bool hist::isunset() const
<a name="__line1467"></a>    {
<a name="__line1468"></a>        for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line1469"></a>        {
<a name="__line1470"></a>            if ( meas::isunset(h_[sequence_[i]])==true ) return true;
<a name="__line1471"></a>        }
<a name="__line1472"></a>        return false;
<a name="__line1473"></a>    }
<a name="__line1474"></a>
<a name="__line1475"></a>
<a name="__line1476"></a>    bool hist::isfinite(const hist &amp;h)
<a name="__line1477"></a>    {
<a name="__line1478"></a>        return h.isfinite();
<a name="__line1479"></a>    }
<a name="__line1480"></a>
<a name="__line1481"></a>
<a name="__line1482"></a>    bool hist::isinf(const hist &amp;h)
<a name="__line1483"></a>    {
<a name="__line1484"></a>        return h.isinf();
<a name="__line1485"></a>    }
<a name="__line1486"></a>
<a name="__line1487"></a>
<a name="__line1488"></a>    bool hist::isnan(const hist &amp;h)
<a name="__line1489"></a>    {
<a name="__line1490"></a>        return h.isnan();
<a name="__line1491"></a>    }
<a name="__line1492"></a>
<a name="__line1493"></a>
<a name="__line1494"></a>    bool hist::isset(const hist &amp;h)
<a name="__line1495"></a>    {
<a name="__line1496"></a>        return h.isset();
<a name="__line1497"></a>    }
<a name="__line1498"></a>
<a name="__line1499"></a>
<a name="__line1500"></a>    bool hist::isunset(const hist &amp;h)
<a name="__line1501"></a>    {
<a name="__line1502"></a>        return h.isunset();
<a name="__line1503"></a>    }
<a name="__line1504"></a>
<a name="__line1505"></a>
<a name="__line1506"></a>    void hist::mkfinite(const double newvalue)
<a name="__line1507"></a>    {
<a name="__line1508"></a>        for ( unsigned int i=0 ; i&lt;h_.size() ; ++i )
<a name="__line1509"></a>        {
<a name="__line1510"></a>            if ( meas::isfinite(h_[i])==false ) { h_[i].v=newvalue; h_[i].e=newvalue; }
<a name="__line1511"></a>        }
<a name="__line1512"></a>    }
<a name="__line1513"></a>
<a name="__line1514"></a>
<a name="__line1515"></a>    void hist::annulate(const var &amp;reset)
<a name="__line1516"></a>    {
<a name="__line1517"></a>        if ( reset=="reset" )
<a name="__line1518"></a>        {
<a name="__line1519"></a>            if ( dim_&gt;0 ) sequence_.resize(mul_[0]*bins_[0]);
<a name="__line1520"></a>            int hsize=h_.size();
<a name="__line1521"></a>            for ( int i=0 ; i&lt;hsize ; ++i )
<a name="__line1522"></a>            {
<a name="__line1523"></a>                for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1524"></a>                {
<a name="__line1525"></a>                    m_[i*dim_+j]=1;
<a name="__line1526"></a>                }
<a name="__line1527"></a>                h_[i]=0.0;
<a name="__line1528"></a>                invsequence_[i]=i;
<a name="__line1529"></a>                sequence_[i]=i;
<a name="__line1530"></a>            }
<a name="__line1531"></a>        }
<a name="__line1532"></a>        else
<a name="__line1533"></a>        {
<a name="__line1534"></a>            for ( unsigned int i=0 ; i&lt;h_.size() ; ++i )
<a name="__line1535"></a>            {
<a name="__line1536"></a>                h_[i]=0.0;
<a name="__line1537"></a>            }
<a name="__line1538"></a>        }
<a name="__line1539"></a>    }
<a name="__line1540"></a>
<a name="__line1541"></a>
<a name="__line1542"></a>    unsigned int hist::bin(const point &amp;pos) const
<a name="__line1543"></a>    {
<a name="__line1544"></a>        if ( sequence_.empty() )
<a name="__line1545"></a>        {
<a name="__line1546"></a>            warning::print("Empty indexrange in histogram! Strange.",
<a name="__line1547"></a>                           "unsigned int hist::bin(const point&amp;) const");
<a name="__line1548"></a>            return 0;
<a name="__line1549"></a>        }
<a name="__line1550"></a>        int i=0;
<a name="__line1551"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1552"></a>        {
<a name="__line1553"></a>            if ( j&lt;(int)pos.size() )
<a name="__line1554"></a>            {
<a name="__line1555"></a>                ind_[j]=(int)((pos[j+1]-min_[j])/binsize_[j]);
<a name="__line1556"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; }
<a name="__line1557"></a>                if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1558"></a>            }
<a name="__line1559"></a>            else ind_[j]=0;
<a name="__line1560"></a>            i+=mul_[j]*ind_[j];
<a name="__line1561"></a>        }
<a name="__line1562"></a>        return invsequence_[i];
<a name="__line1563"></a>    }
<a name="__line1564"></a>
<a name="__line1565"></a>
<a name="__line1566"></a>    unsigned int hist::bin(const datapoint &amp;pos) const
<a name="__line1567"></a>    {
<a name="__line1568"></a>        if ( sequence_.empty() )
<a name="__line1569"></a>        {
<a name="__line1570"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const point&amp;) const");
<a name="__line1571"></a>            return 0;
<a name="__line1572"></a>        }
<a name="__line1573"></a>        int i=0;
<a name="__line1574"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1575"></a>        {
<a name="__line1576"></a>            if ( j&lt;(int)pos.size() )
<a name="__line1577"></a>            {
<a name="__line1578"></a>                ind_[j]=(int)((pos[j].dbl()-min_[j])/binsize_[j]);
<a name="__line1579"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1580"></a>            }
<a name="__line1581"></a>            else ind_[j]=0;
<a name="__line1582"></a>            i+=mul_[j]*ind_[j];
<a name="__line1583"></a>        }
<a name="__line1584"></a>        return invsequence_[i];
<a name="__line1585"></a>    }
<a name="__line1586"></a>
<a name="__line1587"></a>
<a name="__line1588"></a>    unsigned int hist::bin(const double x) const
<a name="__line1589"></a>    {
<a name="__line1590"></a>        if ( sequence_.empty() )
<a name="__line1591"></a>        {
<a name="__line1592"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double) const");
<a name="__line1593"></a>            return 0;
<a name="__line1594"></a>        }
<a name="__line1595"></a>        int i=0;
<a name="__line1596"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1597"></a>        {
<a name="__line1598"></a>            if ( j&lt;1 )
<a name="__line1599"></a>            {
<a name="__line1600"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]);
<a name="__line1601"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1602"></a>            }
<a name="__line1603"></a>            else ind_[j]=0;
<a name="__line1604"></a>            i+=mul_[j]*ind_[j];
<a name="__line1605"></a>        }
<a name="__line1606"></a>        return invsequence_[i];
<a name="__line1607"></a>    }
<a name="__line1608"></a>
<a name="__line1609"></a>
<a name="__line1610"></a>    unsigned int hist::bin(const double x, const double y) const
<a name="__line1611"></a>    {
<a name="__line1612"></a>        if ( sequence_.empty() )
<a name="__line1613"></a>        {
<a name="__line1614"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double) const");
<a name="__line1615"></a>            return 0;
<a name="__line1616"></a>        }
<a name="__line1617"></a>        int i=0;
<a name="__line1618"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1619"></a>        {
<a name="__line1620"></a>            if ( j&lt;1 )
<a name="__line1621"></a>            {
<a name="__line1622"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]);
<a name="__line1623"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1624"></a>            }
<a name="__line1625"></a>            else if ( j&lt;2 )
<a name="__line1626"></a>            {
<a name="__line1627"></a>                ind_[j]=(int)((y-min_[j])/binsize_[j]);
<a name="__line1628"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1629"></a>            }
<a name="__line1630"></a>            else ind_[j]=0;
<a name="__line1631"></a>            i+=mul_[j]*ind_[j];
<a name="__line1632"></a>        }
<a name="__line1633"></a>        return invsequence_[i];
<a name="__line1634"></a>    }
<a name="__line1635"></a>
<a name="__line1636"></a>
<a name="__line1637"></a>    unsigned int hist::bin(const double x, const double y, const double z) const
<a name="__line1638"></a>    {
<a name="__line1639"></a>        if ( sequence_.empty() )
<a name="__line1640"></a>        {
<a name="__line1641"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double, const double) const");
<a name="__line1642"></a>            return 0;
<a name="__line1643"></a>        }
<a name="__line1644"></a>        int i=0;
<a name="__line1645"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1646"></a>        {
<a name="__line1647"></a>            if ( j&lt;1 )
<a name="__line1648"></a>            {
<a name="__line1649"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]);
<a name="__line1650"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1651"></a>            }
<a name="__line1652"></a>            else if ( j&lt;2 )
<a name="__line1653"></a>            {
<a name="__line1654"></a>                ind_[j]=(int)((y-min_[j])/binsize_[j]);
<a name="__line1655"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1656"></a>            }
<a name="__line1657"></a>            else if ( j&lt;3 )
<a name="__line1658"></a>            {
<a name="__line1659"></a>                ind_[j]=(int)((z-min_[j])/binsize_[j]);
<a name="__line1660"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1661"></a>            }
<a name="__line1662"></a>            else ind_[j]=0;
<a name="__line1663"></a>            i+=mul_[j]*ind_[j];
<a name="__line1664"></a>        }
<a name="__line1665"></a>        return invsequence_[i];
<a name="__line1666"></a>    }
<a name="__line1667"></a>
<a name="__line1668"></a>
<a name="__line1669"></a>    unsigned int hist::bin(const double x, const double y, const double z, const double t) const
<a name="__line1670"></a>    {
<a name="__line1671"></a>        if ( sequence_.empty() )
<a name="__line1672"></a>        {
<a name="__line1673"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double, const double, const double) const");
<a name="__line1674"></a>            return 0;
<a name="__line1675"></a>        }
<a name="__line1676"></a>        int i=0;
<a name="__line1677"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1678"></a>        {
<a name="__line1679"></a>            if ( j&lt;1 )
<a name="__line1680"></a>            {
<a name="__line1681"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]);
<a name="__line1682"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1683"></a>            }
<a name="__line1684"></a>            else if ( j&lt;2 )
<a name="__line1685"></a>            {
<a name="__line1686"></a>                ind_[j]=(int)((y-min_[j])/binsize_[j]);
<a name="__line1687"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1688"></a>            }
<a name="__line1689"></a>            else if ( j&lt;3 )
<a name="__line1690"></a>            {
<a name="__line1691"></a>                ind_[j]=(int)((z-min_[j])/binsize_[j]);
<a name="__line1692"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1693"></a>            }
<a name="__line1694"></a>            else if ( j&lt;4 )
<a name="__line1695"></a>            {
<a name="__line1696"></a>                ind_[j]=(int)((t-min_[j])/binsize_[j]);
<a name="__line1697"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1698"></a>            }
<a name="__line1699"></a>            else ind_[j]=0;
<a name="__line1700"></a>            i+=mul_[j]*ind_[j];
<a name="__line1701"></a>        }
<a name="__line1702"></a>        return invsequence_[i];
<a name="__line1703"></a>    }
<a name="__line1704"></a>
<a name="__line1705"></a>
<a name="__line1706"></a>    unsigned int hist::bin(const var &amp;x) const
<a name="__line1707"></a>    {
<a name="__line1708"></a>        if ( sequence_.empty() )
<a name="__line1709"></a>        {
<a name="__line1710"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double) const");
<a name="__line1711"></a>            return 0;
<a name="__line1712"></a>        }
<a name="__line1713"></a>        int i=0;
<a name="__line1714"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1715"></a>        {
<a name="__line1716"></a>            if ( j&lt;1 )
<a name="__line1717"></a>            {
<a name="__line1718"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]);
<a name="__line1719"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1720"></a>            }
<a name="__line1721"></a>            else ind_[j]=0;
<a name="__line1722"></a>            i+=mul_[j]*ind_[j];
<a name="__line1723"></a>        }
<a name="__line1724"></a>        return invsequence_[i];
<a name="__line1725"></a>    }
<a name="__line1726"></a>
<a name="__line1727"></a>
<a name="__line1728"></a>    unsigned int hist::bin(const var &amp;x, const var &amp;y) const
<a name="__line1729"></a>    {
<a name="__line1730"></a>        if ( sequence_.empty() )
<a name="__line1731"></a>        {
<a name="__line1732"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double) const");
<a name="__line1733"></a>            return 0;
<a name="__line1734"></a>        }
<a name="__line1735"></a>        int i=0;
<a name="__line1736"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1737"></a>        {
<a name="__line1738"></a>            if ( j&lt;1 )
<a name="__line1739"></a>            {
<a name="__line1740"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]);
<a name="__line1741"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1742"></a>            }
<a name="__line1743"></a>            else if ( j&lt;2 )
<a name="__line1744"></a>            {
<a name="__line1745"></a>                ind_[j]=(int)((y.dbl()-min_[j])/binsize_[j]);
<a name="__line1746"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1747"></a>            }
<a name="__line1748"></a>            else ind_[j]=0;
<a name="__line1749"></a>            i+=mul_[j]*ind_[j];
<a name="__line1750"></a>        }
<a name="__line1751"></a>        return invsequence_[i];
<a name="__line1752"></a>    }
<a name="__line1753"></a>
<a name="__line1754"></a>
<a name="__line1755"></a>    unsigned int hist::bin(const var &amp;x, const var &amp;y, const var &amp;z) const
<a name="__line1756"></a>    {
<a name="__line1757"></a>        if ( sequence_.empty() )
<a name="__line1758"></a>        {
<a name="__line1759"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double, const double) const");
<a name="__line1760"></a>            return 0;
<a name="__line1761"></a>        }
<a name="__line1762"></a>        int i=0;
<a name="__line1763"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1764"></a>        {
<a name="__line1765"></a>            if ( j&lt;1 )
<a name="__line1766"></a>            {
<a name="__line1767"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]);
<a name="__line1768"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1769"></a>            }
<a name="__line1770"></a>            else if ( j&lt;2 )
<a name="__line1771"></a>            {
<a name="__line1772"></a>                ind_[j]=(int)((y.dbl()-min_[j])/binsize_[j]);
<a name="__line1773"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1774"></a>            }
<a name="__line1775"></a>            else if ( j&lt;3 )
<a name="__line1776"></a>            {
<a name="__line1777"></a>                ind_[j]=(int)((z.dbl()-min_[j])/binsize_[j]);
<a name="__line1778"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1779"></a>            }
<a name="__line1780"></a>            else ind_[j]=0;
<a name="__line1781"></a>            i+=mul_[j]*ind_[j];
<a name="__line1782"></a>        }
<a name="__line1783"></a>        return invsequence_[i];
<a name="__line1784"></a>    }
<a name="__line1785"></a>
<a name="__line1786"></a>
<a name="__line1787"></a>    unsigned int hist::bin(const var &amp;x, const var &amp;y, const var &amp;z, const var &amp;t) const
<a name="__line1788"></a>    {
<a name="__line1789"></a>        if ( sequence_.empty() )
<a name="__line1790"></a>        {
<a name="__line1791"></a>            warning::print("Empty indexrange in histogram! Strange.", "unsigned int hist::bin(const double, const double, const double, const double) const");
<a name="__line1792"></a>            return 0;
<a name="__line1793"></a>        }
<a name="__line1794"></a>        int i=0;
<a name="__line1795"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line1796"></a>        {
<a name="__line1797"></a>            if ( j&lt;1 )
<a name="__line1798"></a>            {
<a name="__line1799"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]);
<a name="__line1800"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1801"></a>            }
<a name="__line1802"></a>            else if ( j&lt;2 )
<a name="__line1803"></a>            {
<a name="__line1804"></a>                ind_[j]=(int)((y.dbl()-min_[j])/binsize_[j]);
<a name="__line1805"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1806"></a>            }
<a name="__line1807"></a>            else if ( j&lt;3 )
<a name="__line1808"></a>            {
<a name="__line1809"></a>                ind_[j]=(int)((z.dbl()-min_[j])/binsize_[j]);
<a name="__line1810"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1811"></a>            }
<a name="__line1812"></a>            else if ( j&lt;4 )
<a name="__line1813"></a>            {
<a name="__line1814"></a>                ind_[j]=(int)((t.dbl()-min_[j])/binsize_[j]);
<a name="__line1815"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line1816"></a>            }
<a name="__line1817"></a>            else ind_[j]=0;
<a name="__line1818"></a>            i+=mul_[j]*ind_[j];
<a name="__line1819"></a>        }
<a name="__line1820"></a>        return invsequence_[i];
<a name="__line1821"></a>    }
<a name="__line1822"></a>
<a name="__line1823"></a>
<a name="__line1824"></a>    hist::cell hist::pos(const unsigned int i) const
<a name="__line1825"></a>    {
<a name="__line1826"></a>        cell pos(dim_);
<a name="__line1827"></a>        int j;
<a name="__line1828"></a>        for ( j=0 ; j&lt;dim_ ; ++j ) { pos[j+1].v=0.0; pos[j+1].e=0.0; }
<a name="__line1829"></a>        if ( i&lt;sequence_.size() )
<a name="__line1830"></a>        {
<a name="__line1831"></a>            ind_[dim_-1]=sequence_[i];
<a name="__line1832"></a>            for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line1833"></a>            {
<a name="__line1834"></a>                if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line1835"></a>            }
<a name="__line1836"></a>            for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line1837"></a>            {
<a name="__line1838"></a>                ind_[j]=ind_[j]%bins_[j];
<a name="__line1839"></a>                pos[j+1].v=min_[j]+(ind_[j]+0.5*m_[sequence_[i]*dim_+j])*binsize_[j];
<a name="__line1840"></a>                pos[j+1].e=0.5*binsize_[j]*m_[sequence_[i]*dim_+j];
<a name="__line1841"></a>            }
<a name="__line1842"></a>            return pos;
<a name="__line1843"></a>        }
<a name="__line1844"></a>        else warning::print("Index out of range!", "cell hist::pos(const unsigned int) const");
<a name="__line1845"></a>        if ( sequence_.empty() )
<a name="__line1846"></a>        {
<a name="__line1847"></a>            warning::print("Empty indexrange in histogram! Strange.", "cell hist::pos(const unsigned int) const");
<a name="__line1848"></a>            return pos;
<a name="__line1849"></a>        }
<a name="__line1850"></a>        ind_[dim_-1]=sequence_[sequence_.size()-1];
<a name="__line1851"></a>        for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line1852"></a>        {
<a name="__line1853"></a>            if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line1854"></a>        }
<a name="__line1855"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line1856"></a>        {
<a name="__line1857"></a>            ind_[j]=ind_[j]%bins_[j];
<a name="__line1858"></a>            pos[j+1].v=min_[j]+(ind_[j]+0.5*m_[sequence_[sequence_.size()-1]*dim_+j])*binsize_[j];
<a name="__line1859"></a>            pos[j+1].e=0.5*binsize_[j]*m_[sequence_[sequence_.size()-1]*dim_+j];
<a name="__line1860"></a>        }
<a name="__line1861"></a>        return pos;
<a name="__line1862"></a>    }
<a name="__line1863"></a>
<a name="__line1864"></a>
<a name="__line1865"></a>    meas hist::pos(const unsigned int i, const int axis) const
<a name="__line1866"></a>    {
<a name="__line1867"></a>        meas pos(0.0, 0.0);
<a name="__line1868"></a>        if ( axis&lt;1 || axis&gt;dim_ )
<a name="__line1869"></a>        {
<a name="__line1870"></a>            warning::print("Axis index out of range! (1-based indices!!!)", "meas hist::pos(const unsigned int, const int) const");
<a name="__line1871"></a>            return pos;
<a name="__line1872"></a>        }
<a name="__line1873"></a>        int j;
<a name="__line1874"></a>        if ( i&lt;sequence_.size() )
<a name="__line1875"></a>        {
<a name="__line1876"></a>            ind_[dim_-1]=sequence_[i];
<a name="__line1877"></a>            for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line1878"></a>            {
<a name="__line1879"></a>                if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line1880"></a>                if ( j&lt;=axis-1 ) break;
<a name="__line1881"></a>            }
<a name="__line1882"></a>            for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line1883"></a>            {
<a name="__line1884"></a>                ind_[j]=ind_[j]%bins_[j];
<a name="__line1885"></a>                if ( j&gt;=axis-1 ) break;
<a name="__line1886"></a>            }
<a name="__line1887"></a>            pos.v=min_[axis-1]+(ind_[axis-1]+0.5*m_[sequence_[i]*dim_+axis-1])*binsize_[axis-1];
<a name="__line1888"></a>            pos.e=0.5*binsize_[axis-1]*m_[sequence_[i]*dim_+axis-1];
<a name="__line1889"></a>            return pos;
<a name="__line1890"></a>        }
<a name="__line1891"></a>        else warning::print("Index out of range!", "meas hist::pos(const unsigned int, const int) const");
<a name="__line1892"></a>        if ( sequence_.empty() )
<a name="__line1893"></a>        {
<a name="__line1894"></a>            warning::print("Empty indexrange in histogram! Strange.", "meas hist::pos(const unsigned int, const int) const");
<a name="__line1895"></a>            return pos;
<a name="__line1896"></a>        }
<a name="__line1897"></a>        ind_[dim_-1]=sequence_[sequence_.size()-1];
<a name="__line1898"></a>        for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line1899"></a>        {
<a name="__line1900"></a>            if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line1901"></a>            if ( j&lt;=axis-1 ) break;
<a name="__line1902"></a>        }
<a name="__line1903"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line1904"></a>        {
<a name="__line1905"></a>            ind_[j]=ind_[j]%bins_[j];
<a name="__line1906"></a>            if ( j&gt;=axis-1 ) break;
<a name="__line1907"></a>        }
<a name="__line1908"></a>        pos.v=min_[axis-1]+(ind_[axis-1]+0.5*m_[sequence_[sequence_.size()-1]*dim_+axis-1])*binsize_[axis-1];
<a name="__line1909"></a>        pos.e=0.5*binsize_[axis-1]*m_[sequence_[sequence_.size()-1]*dim_+axis-1];
<a name="__line1910"></a>        return pos;
<a name="__line1911"></a>    }
<a name="__line1912"></a>
<a name="__line1913"></a>    double hist::binsize(int axis) const
<a name="__line1914"></a>    {
<a name="__line1915"></a>        --axis;
<a name="__line1916"></a>        if(axis&lt;0 || (unsigned int)axis&gt;=binsize_.size())
<a name="__line1917"></a>        {
<a name="__line1918"></a>            warning::print("axis index is out of range","hist::binsize(int axis)");
<a name="__line1919"></a>            return 0;
<a name="__line1920"></a>        }
<a name="__line1921"></a>        return binsize_[axis];
<a name="__line1922"></a>    }
<a name="__line1923"></a>
<a name="__line1924"></a>    meas&amp; hist::operator[](const unsigned int i)
<a name="__line1925"></a>    {
<a name="__line1926"></a>        if ( i&lt;sequence_.size() ) return h_[sequence_[i]];
<a name="__line1927"></a>        else warning::print("Index out of range!", "meas&amp; hist::operator[](const unsigned int)");
<a name="__line1928"></a>        if ( sequence_.empty() )
<a name="__line1929"></a>        {
<a name="__line1930"></a>            warning::print("Uninitialized histogram!", "meas&amp; hist::operator[](const unsigned int)");
<a name="__line1931"></a>            static meas meas_null(unset, unset);
<a name="__line1932"></a>            return meas_null;
<a name="__line1933"></a>        }
<a name="__line1934"></a>        return h_[sequence_[sequence_.size()-1]];
<a name="__line1935"></a>    }
<a name="__line1936"></a>
<a name="__line1937"></a>
<a name="__line1938"></a>    const meas&amp; hist::operator[](const unsigned int i) const
<a name="__line1939"></a>    {
<a name="__line1940"></a>        if ( i&lt;sequence_.size() ) return h_[sequence_[i]];
<a name="__line1941"></a>        else warning::print("Index out of range!", "const meas&amp; hist::operator[](const unsigned int) const");
<a name="__line1942"></a>        if ( sequence_.empty() )
<a name="__line1943"></a>        {
<a name="__line1944"></a>            warning::print("Uninitialized histogram!", "const meas&amp; hist::operator[](const unsigned int) const");
<a name="__line1945"></a>            static meas meas_null(unset, unset);
<a name="__line1946"></a>            return meas_null;
<a name="__line1947"></a>        }
<a name="__line1948"></a>        return h_[sequence_[sequence_.size()-1]];
<a name="__line1949"></a>    }
<a name="__line1950"></a>
<a name="__line1951"></a>    hist&amp; hist::fill_range(double x1, double x2, double weight)
<a name="__line1952"></a>    {
<a name="__line1953"></a>        if(dim_ != 1)
<a name="__line1954"></a>        {
<a name="__line1955"></a>            warning::print("Not a 1-dimensional histogram",
<a name="__line1956"></a>                           "hist::fill_range(double,double,double)");
<a name="__line1957"></a>            return *this;
<a name="__line1958"></a>        }
<a name="__line1959"></a>        if(x1 &lt; min_[0])
<a name="__line1960"></a>        {
<a name="__line1961"></a>            weight *= (x2-min_[0])/(x2-x1);
<a name="__line1962"></a>            x1 = min_[0];
<a name="__line1963"></a>        }
<a name="__line1964"></a>        if(x2 &gt; max_[0])
<a name="__line1965"></a>        {
<a name="__line1966"></a>            weight *= (max_[0]-x1)/(x2-x1);
<a name="__line1967"></a>            x2 = max_[0];
<a name="__line1968"></a>        }
<a name="__line1969"></a>        const int bin_index_1 = std::max((int)((x1-min_[0])/binsize_[0]),0);
<a name="__line1970"></a>        const int bin_index_2 = std::min((int)((x2-min_[0])/binsize_[0]),bins_[0]-1);
<a name="__line1971"></a>
<a name="__line1972"></a>        for(int bin_index = bin_index_1; bin_index &lt;= bin_index_2; ++bin_index)
<a name="__line1973"></a>        {
<a name="__line1974"></a>            const double x1_in = std::max(min_[0]+bin_index    *binsize_[0], x1);
<a name="__line1975"></a>            const double x2_in = std::min(min_[0]+(bin_index+1)*binsize_[0], x2);
<a name="__line1976"></a>            const double x = min_[0]+(bin_index+0.5)*binsize_[0];
<a name="__line1977"></a>            fill(x, weight * (x2_in-x1_in)/(x2-x1));
<a name="__line1978"></a>        }
<a name="__line1979"></a>        return *this;
<a name="__line1980"></a>    }
<a name="__line1981"></a>
<a name="__line1982"></a>
<a name="__line1983"></a>    hist &amp;hist::fill(const point &amp;pos, const double weight)
<a name="__line1984"></a>    {
<a name="__line1985"></a>        const hist &amp;h = *this;
<a name="__line1986"></a>        h.fill(pos,weight);
<a name="__line1987"></a>        return *this;
<a name="__line1988"></a>    }
<a name="__line1989"></a>
<a name="__line1990"></a>    const hist&amp; hist::fill(const point &amp;pos, const double weight) const
<a name="__line1991"></a>    {
<a name="__line1992"></a>        <span class=comment>// Redirect to buffer if needed</span>
<a name="__line1993"></a>        if(buffer_size_&gt;0)
<a name="__line1994"></a>        {
<a name="__line1995"></a>            for(int i=1; i&lt;=dim_; ++i) buffer_.push_back(i&lt;=(int)pos.size()?pos[i]:0.0);
<a name="__line1996"></a>            buffer_.push_back(weight);
<a name="__line1997"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line1998"></a>            return *this;
<a name="__line1999"></a>        }
<a name="__line2000"></a>
<a name="__line2001"></a>        if ( sequence_.empty() )
<a name="__line2002"></a>        {
<a name="__line2003"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::fill(const point&amp;, const double)");
<a name="__line2004"></a>            return *this;
<a name="__line2005"></a>        }
<a name="__line2006"></a>        h_[sequence_[bin(pos)]].fill(weight);
<a name="__line2007"></a>        return *this;
<a name="__line2008"></a>    }
<a name="__line2009"></a>
<a name="__line2010"></a>
<a name="__line2011"></a>    hist&amp; hist::remove(const point &amp;pos)
<a name="__line2012"></a>    {
<a name="__line2013"></a>        if ( sequence_.empty() )
<a name="__line2014"></a>        {
<a name="__line2015"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const point&amp;)");
<a name="__line2016"></a>            return *this;
<a name="__line2017"></a>        }
<a name="__line2018"></a>        h_[sequence_[bin(pos)]].remove();
<a name="__line2019"></a>        return *this;
<a name="__line2020"></a>    }
<a name="__line2021"></a>
<a name="__line2022"></a>
<a name="__line2023"></a>    hist&amp; hist::remove(const point &amp;pos, const double weight)
<a name="__line2024"></a>    {
<a name="__line2025"></a>        if ( sequence_.empty() )
<a name="__line2026"></a>        {
<a name="__line2027"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const point&amp;, const double)");
<a name="__line2028"></a>            return *this;
<a name="__line2029"></a>        }
<a name="__line2030"></a>        h_[sequence_[bin(pos)]].remove(weight);
<a name="__line2031"></a>        return *this;
<a name="__line2032"></a>    }
<a name="__line2033"></a>
<a name="__line2034"></a>
<a name="__line2035"></a>
<a name="__line2036"></a>    hist&amp; hist::fill(const datapoint &amp;pos, const var &amp;weight) 
<a name="__line2037"></a>    {
<a name="__line2038"></a>        <span class=comment>// Redirect to buffer if needed</span>
<a name="__line2039"></a>        if(buffer_size_&gt;0)
<a name="__line2040"></a>        {
<a name="__line2041"></a>            for(int i=0; i&lt;dim_; ++i) buffer_.push_back(i&lt;(int)pos.size()?pos[i].dbl():0.0);
<a name="__line2042"></a>            buffer_.push_back(weight);
<a name="__line2043"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line2044"></a>            return *this;
<a name="__line2045"></a>        }
<a name="__line2046"></a>
<a name="__line2047"></a>        if ( sequence_.empty() )
<a name="__line2048"></a>        {
<a name="__line2049"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::fill(const point&amp;, const double)");
<a name="__line2050"></a>            return *this;
<a name="__line2051"></a>        }
<a name="__line2052"></a>        h_[sequence_[bin(pos)]].fill(weight);
<a name="__line2053"></a>        return *this;
<a name="__line2054"></a>    }
<a name="__line2055"></a>
<a name="__line2056"></a>
<a name="__line2057"></a>    hist&amp; hist::remove(const datapoint &amp;pos)
<a name="__line2058"></a>    {
<a name="__line2059"></a>        if ( sequence_.empty() )
<a name="__line2060"></a>        {
<a name="__line2061"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const point&amp;)");
<a name="__line2062"></a>            return *this;
<a name="__line2063"></a>        }
<a name="__line2064"></a>        h_[sequence_[bin(pos)]].remove();
<a name="__line2065"></a>        return *this;
<a name="__line2066"></a>    }
<a name="__line2067"></a>
<a name="__line2068"></a>
<a name="__line2069"></a>    hist&amp; hist::remove(const datapoint &amp;pos, const var &amp;weight)
<a name="__line2070"></a>    {
<a name="__line2071"></a>        if ( sequence_.empty() )
<a name="__line2072"></a>        {
<a name="__line2073"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const point&amp;, const double)");
<a name="__line2074"></a>            return *this;
<a name="__line2075"></a>        }
<a name="__line2076"></a>        h_[sequence_[bin(pos)]].remove(weight);
<a name="__line2077"></a>        return *this;
<a name="__line2078"></a>    }
<a name="__line2079"></a>
<a name="__line2080"></a>
<a name="__line2081"></a>    hist&amp; hist::fill(const double x)
<a name="__line2082"></a>    {
<a name="__line2083"></a>        if(dim_!=1)
<a name="__line2084"></a>        {
<a name="__line2085"></a>            warning::print("Histogram must be 1 dimensional","hist::fill(const double x)");
<a name="__line2086"></a>            return *this;
<a name="__line2087"></a>        }
<a name="__line2088"></a>        if(buffer_size_&gt;0)
<a name="__line2089"></a>        {
<a name="__line2090"></a>            buffer_.push_back(x);
<a name="__line2091"></a>            buffer_.push_back(1.0);
<a name="__line2092"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line2093"></a>            return *this;
<a name="__line2094"></a>        }
<a name="__line2095"></a>
<a name="__line2096"></a>        if ( sequence_.empty() )
<a name="__line2097"></a>        {
<a name="__line2098"></a>            warning::print("Empty indexrange in histogram!",
<a name="__line2099"></a>                           "hist&amp; hist::fill(const double)");
<a name="__line2100"></a>            return *this;
<a name="__line2101"></a>        }
<a name="__line2102"></a>        h_[sequence_[bin(x)]].fill();
<a name="__line2103"></a>        return *this;
<a name="__line2104"></a>    }
<a name="__line2105"></a>
<a name="__line2106"></a>
<a name="__line2107"></a>    hist&amp; hist::fill(const double x, const double y)
<a name="__line2108"></a>    {
<a name="__line2109"></a>        if(dim_!=1 &amp;&amp; dim_!=2)
<a name="__line2110"></a>        {
<a name="__line2111"></a>            warning::print("Histogram must be 1 or 2 dimensional","hist::fill(const double x, const double y)");
<a name="__line2112"></a>            return *this; 
<a name="__line2113"></a>        }
<a name="__line2114"></a>
<a name="__line2115"></a>        if(buffer_size_&gt;0)
<a name="__line2116"></a>        {
<a name="__line2117"></a>            buffer_.push_back(x);
<a name="__line2118"></a>            buffer_.push_back(y);
<a name="__line2119"></a>            if(dim_==2) buffer_.push_back(1.0); <span class=comment>// weight</span>
<a name="__line2120"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line2121"></a>            return *this;
<a name="__line2122"></a>        }
<a name="__line2123"></a>        if ( sequence_.empty() )
<a name="__line2124"></a>        {
<a name="__line2125"></a>            warning::print("Empty indexrange in histogram!",
<a name="__line2126"></a>                           "hist&amp; hist::fill(const double, const double, const double)");
<a name="__line2127"></a>            return *this;
<a name="__line2128"></a>        }
<a name="__line2129"></a>        if(dim_==1) h_[sequence_[bin(x)]].fill(y);
<a name="__line2130"></a>        else        h_[sequence_[bin(x,y)]].fill();
<a name="__line2131"></a>        return *this;
<a name="__line2132"></a>    }
<a name="__line2133"></a>
<a name="__line2134"></a>
<a name="__line2135"></a>    hist&amp; hist::fill(const double x, const double y, const double z)
<a name="__line2136"></a>    {
<a name="__line2137"></a>        if(dim_!=2 &amp;&amp; dim_!=3)
<a name="__line2138"></a>        {
<a name="__line2139"></a>            warning::print("Histogram must be 2 or 3 dimensional","hist::fill(const double x, const double y, const double z)");
<a name="__line2140"></a>            return *this; 
<a name="__line2141"></a>        }
<a name="__line2142"></a>        if(buffer_size_&gt;0)
<a name="__line2143"></a>        {
<a name="__line2144"></a>            buffer_.push_back(x);
<a name="__line2145"></a>            buffer_.push_back(y);
<a name="__line2146"></a>            buffer_.push_back(z);
<a name="__line2147"></a>            if(dim_==3) buffer_.push_back(1.0); <span class=comment>// weight</span>
<a name="__line2148"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line2149"></a>            return *this;
<a name="__line2150"></a>        }
<a name="__line2151"></a>        if ( sequence_.empty() )
<a name="__line2152"></a>        {
<a name="__line2153"></a>            warning::print("Empty indexrange in histogram!",
<a name="__line2154"></a>                           "hist&amp; hist::fill(const double, const double, const double)");
<a name="__line2155"></a>            return *this;
<a name="__line2156"></a>        }
<a name="__line2157"></a>        if(dim_==2) h_[sequence_[bin(x, y)]].fill(z);
<a name="__line2158"></a>        else        h_[sequence_[bin(x, y, z)]].fill();
<a name="__line2159"></a>        return *this;
<a name="__line2160"></a>    }
<a name="__line2161"></a>
<a name="__line2162"></a>
<a name="__line2163"></a>    hist&amp; hist::fill(const double x, const double y, const double z, const double t)
<a name="__line2164"></a>    {
<a name="__line2165"></a>        if(dim_!=3 &amp;&amp; dim_!=4)
<a name="__line2166"></a>        {
<a name="__line2167"></a>            warning::print("Histogram must be3 or 4 dimensional","hist::fill(const double x, const double y, const double z, const double w)");
<a name="__line2168"></a>            return *this;
<a name="__line2169"></a>        }
<a name="__line2170"></a>        if(buffer_size_&gt;0)
<a name="__line2171"></a>        {
<a name="__line2172"></a>            buffer_.push_back(x);
<a name="__line2173"></a>            buffer_.push_back(y);
<a name="__line2174"></a>            buffer_.push_back(z);
<a name="__line2175"></a>            buffer_.push_back(t);
<a name="__line2176"></a>            if(dim_==4) buffer_.push_back(1.0); <span class=comment>// weight</span>
<a name="__line2177"></a>            if((int)buffer_.size()&gt;=buffer_size_*(dim_+1)) flush_buffer();
<a name="__line2178"></a>            return *this;
<a name="__line2179"></a>        }
<a name="__line2180"></a>        if ( sequence_.empty() )
<a name="__line2181"></a>        {
<a name="__line2182"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::fill(const double, const double, const double, const double)");
<a name="__line2183"></a>            return *this;
<a name="__line2184"></a>        }
<a name="__line2185"></a>        if(dim_==3)  h_[sequence_[bin(x, y, z)]].fill(t);
<a name="__line2186"></a>        else         h_[sequence_[bin(x, y, z, t)]].fill();
<a name="__line2187"></a>        return *this;
<a name="__line2188"></a>    }
<a name="__line2189"></a>
<a name="__line2190"></a>
<a name="__line2191"></a>    hist&amp; hist::remove(const double x)
<a name="__line2192"></a>    {
<a name="__line2193"></a>        if ( sequence_.empty() )
<a name="__line2194"></a>        {
<a name="__line2195"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double)");
<a name="__line2196"></a>            return *this;
<a name="__line2197"></a>        }
<a name="__line2198"></a>        h_[sequence_[bin(x)]].remove();
<a name="__line2199"></a>        return *this;
<a name="__line2200"></a>    }
<a name="__line2201"></a>
<a name="__line2202"></a>
<a name="__line2203"></a>    hist&amp; hist::remove(const double x, const double y)
<a name="__line2204"></a>    {
<a name="__line2205"></a>        if ( sequence_.empty() )
<a name="__line2206"></a>        {
<a name="__line2207"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double, const double)");
<a name="__line2208"></a>            return *this;
<a name="__line2209"></a>        }
<a name="__line2210"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2211"></a>        else h_[sequence_[bin(x, y)]].remove();
<a name="__line2212"></a>        return *this;
<a name="__line2213"></a>    }
<a name="__line2214"></a>
<a name="__line2215"></a>
<a name="__line2216"></a>    hist&amp; hist::remove(const double x, const double y, const double z)
<a name="__line2217"></a>    {
<a name="__line2218"></a>        if ( sequence_.empty() )
<a name="__line2219"></a>        {
<a name="__line2220"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double, const double, const double)");
<a name="__line2221"></a>            return *this;
<a name="__line2222"></a>        }
<a name="__line2223"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2224"></a>        if ( dim_&lt;3 ) h_[sequence_[bin(x, y)]].remove(z);
<a name="__line2225"></a>        else h_[sequence_[bin(x, y, z)]].remove();
<a name="__line2226"></a>        return *this;
<a name="__line2227"></a>    }
<a name="__line2228"></a>
<a name="__line2229"></a>
<a name="__line2230"></a>    hist&amp; hist::remove(const double x, const double y, const double z, const double t)
<a name="__line2231"></a>    {
<a name="__line2232"></a>        if ( sequence_.empty() )
<a name="__line2233"></a>        {
<a name="__line2234"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double, const double, const double, const double)");
<a name="__line2235"></a>            return *this;
<a name="__line2236"></a>        }
<a name="__line2237"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2238"></a>        if ( dim_&lt;3 ) h_[sequence_[bin(x, y)]].remove(z);
<a name="__line2239"></a>        if ( dim_&lt;4 ) h_[sequence_[bin(x, y, z)]].remove(t);
<a name="__line2240"></a>        else h_[sequence_[bin(x, y, z, t)]].remove();
<a name="__line2241"></a>        return *this;
<a name="__line2242"></a>    }
<a name="__line2243"></a>
<a name="__line2244"></a>
<a name="__line2245"></a>
<a name="__line2246"></a>
<a name="__line2247"></a>    hist&amp; hist::remove(const var &amp;x)
<a name="__line2248"></a>    {
<a name="__line2249"></a>        if ( sequence_.empty() )
<a name="__line2250"></a>        {
<a name="__line2251"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double)");
<a name="__line2252"></a>            return *this;
<a name="__line2253"></a>        }
<a name="__line2254"></a>        h_[sequence_[bin(x)]].remove();
<a name="__line2255"></a>        return *this;
<a name="__line2256"></a>    }
<a name="__line2257"></a>
<a name="__line2258"></a>
<a name="__line2259"></a>    hist&amp; hist::remove(const var &amp;x, const var &amp;y)
<a name="__line2260"></a>    {
<a name="__line2261"></a>        if ( sequence_.empty() )
<a name="__line2262"></a>        {
<a name="__line2263"></a>            warning::print("Empty indexrange in histogram!", "hist&amp; hist::remove(const double, const double)");
<a name="__line2264"></a>            return *this;
<a name="__line2265"></a>        }
<a name="__line2266"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2267"></a>        else h_[sequence_[bin(x, y)]].remove();
<a name="__line2268"></a>        return *this;
<a name="__line2269"></a>    }
<a name="__line2270"></a>
<a name="__line2271"></a>
<a name="__line2272"></a>    hist&amp; hist::remove(const var &amp;x, const var &amp;y, const var &amp;z)
<a name="__line2273"></a>    {
<a name="__line2274"></a>        if ( sequence_.empty() )
<a name="__line2275"></a>        {
<a name="__line2276"></a>            warning::print("Empty indexrange in histogram!",
<a name="__line2277"></a>                           "hist&amp; hist::remove(const double, const double, const double)");
<a name="__line2278"></a>            return *this;
<a name="__line2279"></a>        }
<a name="__line2280"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2281"></a>        if ( dim_&lt;3 ) h_[sequence_[bin(x, y)]].remove(z);
<a name="__line2282"></a>        else h_[sequence_[bin(x, y, z)]].remove();
<a name="__line2283"></a>        return *this;
<a name="__line2284"></a>    }
<a name="__line2285"></a>
<a name="__line2286"></a>
<a name="__line2287"></a>    hist&amp; hist::remove(const var &amp;x, const var &amp;y, const var &amp;z, const var &amp;t)
<a name="__line2288"></a>    {
<a name="__line2289"></a>        if ( sequence_.empty() )
<a name="__line2290"></a>        {
<a name="__line2291"></a>            warning::print("Empty indexrange in histogram!",
<a name="__line2292"></a>                           "hist&amp; hist::remove(const double, const double, const double, const double)");
<a name="__line2293"></a>            return *this;
<a name="__line2294"></a>        }
<a name="__line2295"></a>        if ( dim_&lt;2 ) h_[sequence_[bin(x)]].remove(y);
<a name="__line2296"></a>        if ( dim_&lt;3 ) h_[sequence_[bin(x, y)]].remove(z);
<a name="__line2297"></a>        if ( dim_&lt;4 ) h_[sequence_[bin(x, y, z)]].remove(t);
<a name="__line2298"></a>        else h_[sequence_[bin(x, y, z, t)]].remove();
<a name="__line2299"></a>        return *this;
<a name="__line2300"></a>    }
<a name="__line2301"></a>
<a name="__line2302"></a>
<a name="__line2303"></a>    hist&amp; hist::merge(const mergeopt &amp;Mergeopt)
<a name="__line2304"></a>    {
<a name="__line2305"></a>        if ( dim_&lt;=0 )
<a name="__line2306"></a>        {
<a name="__line2307"></a>            warning::print("Dimension is not greater than zero when merging!", "hist&amp; hist::merge(const mergeopt&amp;)");
<a name="__line2308"></a>            return *this;
<a name="__line2309"></a>        }
<a name="__line2310"></a>        if ( sequence_.empty() )
<a name="__line2311"></a>        {
<a name="__line2312"></a>            warning::print("Empty histogram when merging!", "hist&amp; hist::merge(const mergeopt&amp;)");
<a name="__line2313"></a>            return *this;
<a name="__line2314"></a>        }
<a name="__line2315"></a>        std::vector&lt;int&gt; indmin(dim_);
<a name="__line2316"></a>        std::vector&lt;int&gt; indmax(dim_);
<a name="__line2317"></a>        int j, jprime;
<a name="__line2318"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2319"></a>        {
<a name="__line2320"></a>            if ( j&lt;(int)Mergeopt.size() )
<a name="__line2321"></a>            {
<a name="__line2322"></a>                indmin[j]=(int)((Mergeopt[j].min_-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2323"></a>                if ( indmin[j]&lt;0 ) { indmin[j]=0; } if ( indmin[j]&gt;bins_[j]-1 ) { indmin[j]=bins_[j]-1; }
<a name="__line2324"></a>                indmax[j]=(int)((Mergeopt[j].max_-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2325"></a>                if ( indmax[j]&lt;0 ) { indmax[j]=0; } if ( indmax[j]&gt;bins_[j]-1 ) { indmax[j]=bins_[j]-1; }
<a name="__line2326"></a>            }
<a name="__line2327"></a>            else
<a name="__line2328"></a>            {
<a name="__line2329"></a>                indmin[j]=0;
<a name="__line2330"></a>                indmax[j]=1;
<a name="__line2331"></a>            }
<a name="__line2332"></a>        }
<a name="__line2333"></a>        int iprime=0;
<a name="__line2334"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2335"></a>        {
<a name="__line2336"></a>            while ( indmin[j]&gt;=0 )
<a name="__line2337"></a>            {
<a name="__line2338"></a>                iprime=0;
<a name="__line2339"></a>                for ( jprime=0 ; jprime&lt;dim_ ; ++jprime ) iprime+=indmin[jprime]*mul_[jprime];
<a name="__line2340"></a>                if ( m_[iprime*dim_+j]==0 ) { --indmin[j]; } else { break; }
<a name="__line2341"></a>            }
<a name="__line2342"></a>            while ( indmax[j]&gt;=0 )
<a name="__line2343"></a>            {
<a name="__line2344"></a>                iprime=0;
<a name="__line2345"></a>                for ( jprime=0 ; jprime&lt;dim_ ; ++jprime ) iprime+=indmax[jprime]*mul_[jprime];
<a name="__line2346"></a>                if ( m_[iprime*dim_+j]==0 ) { --indmax[j]; } else { break; }
<a name="__line2347"></a>            }
<a name="__line2348"></a>        }
<a name="__line2349"></a>        std::vector&lt;int&gt; nbins(dim_);
<a name="__line2350"></a>        int iprimemax=1;
<a name="__line2351"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2352"></a>        {
<a name="__line2353"></a>            if ( indmax[j]+m_[iprime*dim_+j]==bins_[j] ) indmax[j]=bins_[j];
<a name="__line2354"></a>            if ( indmax[j]&lt;=indmin[j] )
<a name="__line2355"></a>            {
<a name="__line2356"></a>                warning::print("Maximum is not greater than minimum when merging!", "hist&amp; hist::merge(const mergeopt&amp;)");
<a name="__line2357"></a>                return *this;
<a name="__line2358"></a>            }
<a name="__line2359"></a>            if ( j&lt;(int)Mergeopt.size() )
<a name="__line2360"></a>            {
<a name="__line2361"></a>                nbins[j]=(Mergeopt[j].merge_&gt;0 &amp;&amp; Mergeopt[j].merge_&lt;=indmax[j]-indmin[j] ? Mergeopt[j].merge_ : indmax[j]-indmin[j]);
<a name="__line2362"></a>            }
<a name="__line2363"></a>            else nbins[j]=1;
<a name="__line2364"></a>            iprimemax*=(indmax[j]-indmin[j]);
<a name="__line2365"></a>        }
<a name="__line2366"></a>        sequence_.clear();
<a name="__line2367"></a>        invsequence_.clear();
<a name="__line2368"></a>        int i;
<a name="__line2369"></a>        int iprimeprime;
<a name="__line2370"></a>        meas h;
<a name="__line2371"></a>        int m=0;
<a name="__line2372"></a>        for ( iprime=0 ; iprime&lt;iprimemax ; ++iprime )
<a name="__line2373"></a>        {
<a name="__line2374"></a>            iprimeprime=0;
<a name="__line2375"></a>            ind_[dim_-1]=iprime;
<a name="__line2376"></a>            for ( jprime=dim_-1 ; jprime&gt;=0 ; --jprime )
<a name="__line2377"></a>            {
<a name="__line2378"></a>                if ( jprime&lt;dim_-1 ) ind_[jprime]=ind_[jprime+1]/(indmax[jprime+1]-indmin[jprime+1]);
<a name="__line2379"></a>                iprimeprime+=mul_[jprime]*(indmin[jprime]+ind_[jprime]%(indmax[jprime]-indmin[jprime]));
<a name="__line2380"></a>            }
<a name="__line2381"></a>            for ( jprime=0 ; jprime&lt;dim_ ; ++jprime ) h_[iprimeprime]*=(double)(m_[iprimeprime*dim_+jprime]);
<a name="__line2382"></a>        }
<a name="__line2383"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2384"></a>        {
<a name="__line2385"></a>            for ( iprime=0 ; iprime&lt;iprimemax ; ++iprime )
<a name="__line2386"></a>            {
<a name="__line2387"></a>                iprimeprime=0;
<a name="__line2388"></a>                ind_[dim_-1]=iprime;
<a name="__line2389"></a>                for ( jprime=dim_-1 ; jprime&gt;=0 ; --jprime )
<a name="__line2390"></a>                {
<a name="__line2391"></a>                    if ( jprime&lt;dim_-1 ) ind_[jprime]=ind_[jprime+1]/(indmax[jprime+1]-indmin[jprime+1]);
<a name="__line2392"></a>                    iprimeprime+=mul_[jprime]*(indmin[jprime]+ind_[jprime]%(indmax[jprime]-indmin[jprime]));
<a name="__line2393"></a>                }
<a name="__line2394"></a>                i=0;
<a name="__line2395"></a>                for ( jprime=0 ; jprime&lt;dim_ ; ++jprime )
<a name="__line2396"></a>                {
<a name="__line2397"></a>                    ind_[jprime]=ind_[jprime]%(indmax[jprime]-indmin[jprime]);
<a name="__line2398"></a>                    if ( jprime!=j ) i+=mul_[jprime]*(indmin[jprime]+ind_[jprime]);
<a name="__line2399"></a>                    else
<a name="__line2400"></a>                    {
<a name="__line2401"></a>                        i+=mul_[jprime]*(indmin[jprime]+(ind_[jprime]/nbins[jprime])*nbins[jprime]);
<a name="__line2402"></a>                        h=h_[iprimeprime];
<a name="__line2403"></a>                        m=m_[iprimeprime*dim_+jprime];
<a name="__line2404"></a>                    }
<a name="__line2405"></a>                }
<a name="__line2406"></a>                h_[iprimeprime]=0.0;
<a name="__line2407"></a>                h_[i]+=h;
<a name="__line2408"></a>                m_[iprimeprime*dim_+j]=0;
<a name="__line2409"></a>                m_[i*dim_+j]+=m;
<a name="__line2410"></a>            }
<a name="__line2411"></a>        }
<a name="__line2412"></a>        for ( iprime=0 ; iprime&lt;iprimemax ; ++iprime )
<a name="__line2413"></a>        {
<a name="__line2414"></a>            iprimeprime=0;
<a name="__line2415"></a>            ind_[dim_-1]=iprime;
<a name="__line2416"></a>            for ( jprime=dim_-1 ; jprime&gt;=0 ; --jprime )
<a name="__line2417"></a>            {
<a name="__line2418"></a>                if ( jprime&lt;dim_-1 ) ind_[jprime]=ind_[jprime+1]/(indmax[jprime+1]-indmin[jprime+1]);
<a name="__line2419"></a>                iprimeprime+=mul_[jprime]*(indmin[jprime]+ind_[jprime]%(indmax[jprime]-indmin[jprime]));
<a name="__line2420"></a>            }
<a name="__line2421"></a>            for ( jprime=0 ; jprime&lt;dim_ ; ++jprime )
<a name="__line2422"></a>            {
<a name="__line2423"></a>                if ( m_[iprimeprime*dim_+jprime]&gt;0 ) h_[iprimeprime]/=(double)(m_[iprimeprime*dim_+jprime]);
<a name="__line2424"></a>            }
<a name="__line2425"></a>        }
<a name="__line2426"></a>        int hsize=h_.size();
<a name="__line2427"></a>        iprimeprime=0;
<a name="__line2428"></a>        bool skip;
<a name="__line2429"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line2430"></a>        {
<a name="__line2431"></a>            skip=false;
<a name="__line2432"></a>            ind_[dim_-1]=i;
<a name="__line2433"></a>            for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line2434"></a>            {
<a name="__line2435"></a>                if ( m_[i*dim_+j]==0 ) skip=true;
<a name="__line2436"></a>                if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line2437"></a>            }
<a name="__line2438"></a>            if ( skip==false )
<a name="__line2439"></a>            {
<a name="__line2440"></a>                sequence_.push_back(i);
<a name="__line2441"></a>                invsequence_.push_back(iprimeprime);
<a name="__line2442"></a>                ++iprimeprime;
<a name="__line2443"></a>                continue;
<a name="__line2444"></a>            }
<a name="__line2445"></a>            for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2446"></a>            {
<a name="__line2447"></a>                ind_[j]=ind_[j]%bins_[j];
<a name="__line2448"></a>            }
<a name="__line2449"></a>            for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line2450"></a>            {
<a name="__line2451"></a>                while ( ind_[j]&gt;=0 )
<a name="__line2452"></a>                {
<a name="__line2453"></a>                    iprime=0;
<a name="__line2454"></a>                    for ( jprime=0 ; jprime&lt;dim_ ; ++jprime ) iprime+=ind_[jprime]*mul_[jprime];
<a name="__line2455"></a>                    if ( m_[iprime*dim_+j]==0 ) { --ind_[j]; } else { break; }
<a name="__line2456"></a>                }
<a name="__line2457"></a>            }
<a name="__line2458"></a>            if ( (unsigned int)(iprime)&gt;=invsequence_.size() )
<a name="__line2459"></a>            {
<a name="__line2460"></a>                warning::print("Index inconsistency when merging histogram! Clearing histogram.", "hist&amp; hist::merge(const mergeopt&amp;)");
<a name="__line2461"></a>                reinit_(0, std::vector&lt;double&gt;(0), std::vector&lt;double&gt;(0), std::vector&lt;int&gt;(0), std::vector&lt;var&gt;(0), (var)"", (var)"");
<a name="__line2462"></a>                return *this;
<a name="__line2463"></a>            }
<a name="__line2464"></a>            invsequence_.push_back(invsequence_[iprime]);
<a name="__line2465"></a>        }
<a name="__line2466"></a>        return *this;
<a name="__line2467"></a>    }
<a name="__line2468"></a>
<a name="__line2469"></a>
<a name="__line2470"></a>    hist&amp; hist::merge(const double Min, const double Max, const int Merge)
<a name="__line2471"></a>    {
<a name="__line2472"></a>        merge(mergeopt().side(Min, Max, Merge));
<a name="__line2473"></a>        return *this;
<a name="__line2474"></a>    }
<a name="__line2475"></a>
<a name="__line2476"></a>
<a name="__line2477"></a>    hist&amp; hist::merge(const double Min1, const double Max1, const int Merge1, const double Min2, const double Max2, const int Merge2)
<a name="__line2478"></a>    {
<a name="__line2479"></a>        merge(mergeopt().side(Min1, Max1, Merge1).side(Min2, Max2, Merge2));
<a name="__line2480"></a>        return *this;
<a name="__line2481"></a>    }
<a name="__line2482"></a>
<a name="__line2483"></a>
<a name="__line2484"></a>    hist&amp; hist::merge(const double Min1, const double Max1, const int Merge1, const double Min2, const double Max2, const int Merge2, const double Min3, const double Max3, const int Merge3)
<a name="__line2485"></a>    {
<a name="__line2486"></a>        merge(mergeopt().side(Min1, Max1, Merge1).side(Min2, Max2, Merge2).side(Min3, Max3, Merge3));
<a name="__line2487"></a>        return *this;
<a name="__line2488"></a>    }
<a name="__line2489"></a>
<a name="__line2490"></a>
<a name="__line2491"></a>    hist&amp; hist::killbin(const unsigned int i)
<a name="__line2492"></a>    {
<a name="__line2493"></a>        if ( i&lt;sequence_.size() ) { h_[sequence_[i]].v=unset; h_[sequence_[i]].e=unset; return *this; }
<a name="__line2494"></a>        else warning::print("Index out of range!", "hist&amp; hist::killbin(const unsigned int)");
<a name="__line2495"></a>        return *this;
<a name="__line2496"></a>    }
<a name="__line2497"></a>
<a name="__line2498"></a>
<a name="__line2499"></a>    hist&amp; hist::killpoint(const point &amp;pos)
<a name="__line2500"></a>    {
<a name="__line2501"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2502"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2503"></a>        int i=0;
<a name="__line2504"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2505"></a>        {
<a name="__line2506"></a>            if ( j&lt;(int)pos.size() )
<a name="__line2507"></a>            {
<a name="__line2508"></a>                ind_[j]=(int)((pos[j+1]-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2509"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2510"></a>            }
<a name="__line2511"></a>            else ind_[j]=0;
<a name="__line2512"></a>            i+=mul_[j]*ind_[j];
<a name="__line2513"></a>        }
<a name="__line2514"></a>        killbin(invsequence_[i]);
<a name="__line2515"></a>        return *this;
<a name="__line2516"></a>    }
<a name="__line2517"></a>
<a name="__line2518"></a>
<a name="__line2519"></a>    hist&amp; hist::killpoint(const datapoint &amp;pos)
<a name="__line2520"></a>    {
<a name="__line2521"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2522"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2523"></a>        int i=0;
<a name="__line2524"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2525"></a>        {
<a name="__line2526"></a>            if ( j&lt;(int)pos.size() )
<a name="__line2527"></a>            {
<a name="__line2528"></a>                ind_[j]=(int)((pos[j].dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2529"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2530"></a>            }
<a name="__line2531"></a>            else ind_[j]=0;
<a name="__line2532"></a>            i+=mul_[j]*ind_[j];
<a name="__line2533"></a>        }
<a name="__line2534"></a>        killbin(invsequence_[i]);
<a name="__line2535"></a>        return *this;
<a name="__line2536"></a>    }
<a name="__line2537"></a>
<a name="__line2538"></a>
<a name="__line2539"></a>    hist&amp; hist::killpoint(const double x)
<a name="__line2540"></a>    {
<a name="__line2541"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2542"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2543"></a>        int i=0;
<a name="__line2544"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2545"></a>        {
<a name="__line2546"></a>            if ( j&lt;1 )
<a name="__line2547"></a>            {
<a name="__line2548"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2549"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2550"></a>            }
<a name="__line2551"></a>            else ind_[j]=0;
<a name="__line2552"></a>            i+=mul_[j]*ind_[j];
<a name="__line2553"></a>        }
<a name="__line2554"></a>        killbin(invsequence_[i]);
<a name="__line2555"></a>        return *this;
<a name="__line2556"></a>    }
<a name="__line2557"></a>
<a name="__line2558"></a>
<a name="__line2559"></a>    hist&amp; hist::killpoint(const double x, const double y)
<a name="__line2560"></a>    {
<a name="__line2561"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2562"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2563"></a>        int i=0;
<a name="__line2564"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2565"></a>        {
<a name="__line2566"></a>            if ( j&lt;1 )
<a name="__line2567"></a>            {
<a name="__line2568"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2569"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2570"></a>            }
<a name="__line2571"></a>            else if ( j&lt;2 )
<a name="__line2572"></a>            {
<a name="__line2573"></a>                ind_[j]=(int)((y-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2574"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2575"></a>            }
<a name="__line2576"></a>            else ind_[j]=0;
<a name="__line2577"></a>            i+=mul_[j]*ind_[j];
<a name="__line2578"></a>        }
<a name="__line2579"></a>        killbin(invsequence_[i]);
<a name="__line2580"></a>        return *this;
<a name="__line2581"></a>    }
<a name="__line2582"></a>
<a name="__line2583"></a>
<a name="__line2584"></a>    hist&amp; hist::killpoint(const double x, const double y, const double z)
<a name="__line2585"></a>    {
<a name="__line2586"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2587"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2588"></a>        int i=0;
<a name="__line2589"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2590"></a>        {
<a name="__line2591"></a>            if ( j&lt;1 )
<a name="__line2592"></a>            {
<a name="__line2593"></a>                ind_[j]=(int)((x-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2594"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2595"></a>            }
<a name="__line2596"></a>            else if ( j&lt;2 )
<a name="__line2597"></a>            {
<a name="__line2598"></a>                ind_[j]=(int)((y-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2599"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2600"></a>            }
<a name="__line2601"></a>            else if ( j&lt;3 )
<a name="__line2602"></a>            {
<a name="__line2603"></a>                ind_[j]=(int)((z-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2604"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2605"></a>            }
<a name="__line2606"></a>            else ind_[j]=0;
<a name="__line2607"></a>            i+=mul_[j]*ind_[j];
<a name="__line2608"></a>        }
<a name="__line2609"></a>        killbin(invsequence_[i]);
<a name="__line2610"></a>        return *this;
<a name="__line2611"></a>    }
<a name="__line2612"></a>
<a name="__line2613"></a>
<a name="__line2614"></a>    hist&amp; hist::killpoint(const var &amp;x)
<a name="__line2615"></a>    {
<a name="__line2616"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2617"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2618"></a>        int i=0;
<a name="__line2619"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2620"></a>        {
<a name="__line2621"></a>            if ( j&lt;1 )
<a name="__line2622"></a>            {
<a name="__line2623"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2624"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2625"></a>            }
<a name="__line2626"></a>            else ind_[j]=0;
<a name="__line2627"></a>            i+=mul_[j]*ind_[j];
<a name="__line2628"></a>        }
<a name="__line2629"></a>        killbin(invsequence_[i]);
<a name="__line2630"></a>        return *this;
<a name="__line2631"></a>    }
<a name="__line2632"></a>
<a name="__line2633"></a>
<a name="__line2634"></a>    hist&amp; hist::killpoint(const var &amp;x, const var &amp;y)
<a name="__line2635"></a>    {
<a name="__line2636"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2637"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2638"></a>        int i=0;
<a name="__line2639"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2640"></a>        {
<a name="__line2641"></a>            if ( j&lt;1 )
<a name="__line2642"></a>            {
<a name="__line2643"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2644"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2645"></a>            }
<a name="__line2646"></a>            else if ( j&lt;2 )
<a name="__line2647"></a>            {
<a name="__line2648"></a>                ind_[j]=(int)((y.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2649"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2650"></a>            }
<a name="__line2651"></a>            else ind_[j]=0;
<a name="__line2652"></a>            i+=mul_[j]*ind_[j];
<a name="__line2653"></a>        }
<a name="__line2654"></a>        killbin(invsequence_[i]);
<a name="__line2655"></a>        return *this;
<a name="__line2656"></a>    }
<a name="__line2657"></a>
<a name="__line2658"></a>
<a name="__line2659"></a>    hist&amp; hist::killpoint(const var &amp;x, const var &amp;y, const var &amp;z)
<a name="__line2660"></a>    {
<a name="__line2661"></a>        if ( dim_&lt;=0 ) return *this;
<a name="__line2662"></a>        if ( sequence_.empty() ) return *this;
<a name="__line2663"></a>        int i=0;
<a name="__line2664"></a>        for ( int j=0 ; j&lt;dim_ ; ++j )
<a name="__line2665"></a>        {
<a name="__line2666"></a>            if ( j&lt;1 )
<a name="__line2667"></a>            {
<a name="__line2668"></a>                ind_[j]=(int)((x.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2669"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2670"></a>            }
<a name="__line2671"></a>            else if ( j&lt;2 )
<a name="__line2672"></a>            {
<a name="__line2673"></a>                ind_[j]=(int)((y.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2674"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2675"></a>            }
<a name="__line2676"></a>            else if ( j&lt;3 )
<a name="__line2677"></a>            {
<a name="__line2678"></a>                ind_[j]=(int)((z.dbl()-min_[j])/binsize_[j]*(1.0+0.001/bins_[j]));
<a name="__line2679"></a>                if ( ind_[j]&lt;0 ) { ind_[j]=0; } if ( ind_[j]&gt;bins_[j]-1 ) { ind_[j]=bins_[j]-1; }
<a name="__line2680"></a>            }
<a name="__line2681"></a>            else ind_[j]=0;
<a name="__line2682"></a>            i+=mul_[j]*ind_[j];
<a name="__line2683"></a>        }
<a name="__line2684"></a>        killbin(invsequence_[i]);
<a name="__line2685"></a>        return *this;
<a name="__line2686"></a>    }
<a name="__line2687"></a>
<a name="__line2688"></a>
<a name="__line2689"></a>    hist hist::interpolate(const hist &amp;other_scheme, const std::string &amp;method) const
<a name="__line2690"></a>    {
<a name="__line2691"></a>        if ( dim_!=1 || other_scheme.dim_!=1 )
<a name="__line2692"></a>        {
<a name="__line2693"></a>            warning::print("Interpolation: 1d-histograms only!", "hist&amp; hist::interpolate(const hist&amp;, const std::string&amp;) const");
<a name="__line2694"></a>            return hist();
<a name="__line2695"></a>        }
<a name="__line2696"></a>        hist result=other_scheme;
<a name="__line2697"></a>        result.annulate();
<a name="__line2698"></a>        result.axistitle_=axistitle_;
<a name="__line2699"></a>        result.rangetitle_=rangetitle_;
<a name="__line2700"></a>        result.legend_=legend_;
<a name="__line2701"></a>        std::vector&lt;double&gt; x, y, ey;
<a name="__line2702"></a>        for ( unsigned int i=0 ; i&lt;size() ; ++i )
<a name="__line2703"></a>        {
<a name="__line2704"></a>            x.push_back(pos(i, 1).v);
<a name="__line2705"></a>            y.push_back(hist::operator[](i).v);
<a name="__line2706"></a>            ey.push_back(hist::operator[](i).e);
<a name="__line2707"></a>        }
<a name="__line2708"></a>        function y_func, ey_func;
<a name="__line2709"></a>        if ( method=="spline" )
<a name="__line2710"></a>        {
<a name="__line2711"></a>            y_func=function::interpolate_spline(x, y);
<a name="__line2712"></a>            ey_func=function::interpolate_spline(x, ey);
<a name="__line2713"></a>        }
<a name="__line2714"></a>        else
<a name="__line2715"></a>        {
<a name="__line2716"></a>            y_func=function::interpolate_linear(x, y);
<a name="__line2717"></a>            ey_func=function::interpolate_linear(x, ey);
<a name="__line2718"></a>        }
<a name="__line2719"></a>        for ( unsigned int i=0 ; i&lt;result.size() ; ++i )
<a name="__line2720"></a>        {
<a name="__line2721"></a>            double pos=result.pos(i, 1).v;
<a name="__line2722"></a>            double val=y_func(pos).dbl();
<a name="__line2723"></a>            double err=ey_func(pos).dbl();
<a name="__line2724"></a>            result[i].v=val;
<a name="__line2725"></a>            result[i].e=err;
<a name="__line2726"></a>        }
<a name="__line2727"></a>        return result;
<a name="__line2728"></a>    }
<a name="__line2729"></a>
<a name="__line2730"></a>
<a name="__line2731"></a>    int hist::dim() const
<a name="__line2732"></a>    {
<a name="__line2733"></a>        return dim_;
<a name="__line2734"></a>    }
<a name="__line2735"></a>
<a name="__line2736"></a>
<a name="__line2737"></a>    hist&amp; hist::axistitle(const int axis, const var &amp;title)
<a name="__line2738"></a>    {
<a name="__line2739"></a>        if ( axis&lt;1 || axis&gt;dim_ )
<a name="__line2740"></a>        {
<a name="__line2741"></a>            warning::print("Axis index out of range! (1-based indices!!!)", "hist&amp; hist::axistitle(const int, const var&amp;)");
<a name="__line2742"></a>            return *this;
<a name="__line2743"></a>        }
<a name="__line2744"></a>        else axistitle_[axis-1]=title;
<a name="__line2745"></a>        return *this;
<a name="__line2746"></a>    }
<a name="__line2747"></a>
<a name="__line2748"></a>
<a name="__line2749"></a>    var hist::axistitle(const int axis) const
<a name="__line2750"></a>    {
<a name="__line2751"></a>        if ( axis&lt;1 || axis&gt;dim_ )
<a name="__line2752"></a>        {
<a name="__line2753"></a>            warning::print("Axis index out of range! (1-based indices!!!)", "var hist::axistitle(const int)");
<a name="__line2754"></a>            return "";
<a name="__line2755"></a>        }
<a name="__line2756"></a>        return axistitle_[axis-1];
<a name="__line2757"></a>    }
<a name="__line2758"></a>
<a name="__line2759"></a>
<a name="__line2760"></a>    hist&amp; hist::rangetitle(const var &amp;title)
<a name="__line2761"></a>    {
<a name="__line2762"></a>        rangetitle_=title;
<a name="__line2763"></a>        if ( dynamic_cast&lt;cboxes*&gt;(graph_drawer_) )
<a name="__line2764"></a>        {
<a name="__line2765"></a>            cboxes *graphd_cbox_tmp=0;
<a name="__line2766"></a>            if ( rangetitle_.str()!="" ) graphd_cbox_tmp=new cboxes(dynamic_cast&lt;cboxes*&gt;(graph_drawer_)-&gt;title(rangetitle_));
<a name="__line2767"></a>            else graphd_cbox_tmp=new cboxes(*(dynamic_cast&lt;cboxes*&gt;(graph_drawer_)));
<a name="__line2768"></a>            if ( graph_drawer_!=0 ) delete graph_drawer_;
<a name="__line2769"></a>            graph_drawer_=0;
<a name="__line2770"></a>            graph_drawer_=new cboxes(*graphd_cbox_tmp);
<a name="__line2771"></a>            delete graphd_cbox_tmp;
<a name="__line2772"></a>        }
<a name="__line2773"></a>        else if ( dynamic_cast&lt;csboxes*&gt;(graph_drawer_) )
<a name="__line2774"></a>        {
<a name="__line2775"></a>            csboxes *graphd_scbox_tmp=0;
<a name="__line2776"></a>            if ( rangetitle_.str()!="" ) graphd_scbox_tmp=new csboxes(dynamic_cast&lt;csboxes*&gt;(graph_drawer_)-&gt;title(rangetitle_));
<a name="__line2777"></a>            else graphd_scbox_tmp=new csboxes(*(dynamic_cast&lt;csboxes*&gt;(graph_drawer_)));
<a name="__line2778"></a>            if ( graph_drawer_!=0 ) delete graph_drawer_;
<a name="__line2779"></a>            graph_drawer_=0;
<a name="__line2780"></a>            graph_drawer_=new csboxes(*graphd_scbox_tmp);
<a name="__line2781"></a>            delete graphd_scbox_tmp;
<a name="__line2782"></a>        }
<a name="__line2783"></a>        else if ( dynamic_cast&lt;isolines*&gt;(graph_drawer_) )
<a name="__line2784"></a>        {
<a name="__line2785"></a>            isolines *graphd_isolines_tmp=0;
<a name="__line2786"></a><span class=comment>//	if ( rangetitle_.str()!="" ) graphd_isolines_tmp=new graphd_isolines(dynamic_cast&lt;graphd_isolines*&gt;(graph_drawer_)-&gt;title(rangetitle_));</span>
<a name="__line2787"></a><span class=comment>//	else</span>
<a name="__line2788"></a>            graphd_isolines_tmp=new isolines(*(dynamic_cast&lt;isolines*&gt;(graph_drawer_)));
<a name="__line2789"></a>            if ( graph_drawer_!=0 ) delete graph_drawer_;
<a name="__line2790"></a>            graph_drawer_=0;
<a name="__line2791"></a>            graph_drawer_=new isolines(*graphd_isolines_tmp);
<a name="__line2792"></a>            delete graphd_isolines_tmp;
<a name="__line2793"></a>        }
<a name="__line2794"></a>        return *this;
<a name="__line2795"></a>    }
<a name="__line2796"></a>
<a name="__line2797"></a>
<a name="__line2798"></a>    var hist::rangetitle() const
<a name="__line2799"></a>    {
<a name="__line2800"></a>        return rangetitle_;
<a name="__line2801"></a>    }
<a name="__line2802"></a>
<a name="__line2803"></a>
<a name="__line2804"></a>    hist&amp; hist::legend(const var &amp;title)
<a name="__line2805"></a>    {
<a name="__line2806"></a>        legend_=title;
<a name="__line2807"></a>        return *this;
<a name="__line2808"></a>    }
<a name="__line2809"></a>
<a name="__line2810"></a>
<a name="__line2811"></a>    var hist::legend() const
<a name="__line2812"></a>    {
<a name="__line2813"></a>        return legend_;
<a name="__line2814"></a>    }
<a name="__line2815"></a>
<a name="__line2816"></a>
<a name="__line2817"></a>    int hist::bins(const int axis) const
<a name="__line2818"></a>    {
<a name="__line2819"></a>        if ( axis&lt;1 || axis&gt;dim_ )
<a name="__line2820"></a>        {
<a name="__line2821"></a>            warning::print("Axis index out of range! (1-based indices!!!)", "int hist::bins(const int)");
<a name="__line2822"></a>            return 0;
<a name="__line2823"></a>        }
<a name="__line2824"></a>        return bins_[axis-1];
<a name="__line2825"></a>    }
<a name="__line2826"></a>
<a name="__line2827"></a>
<a name="__line2828"></a>    hist::write_many::write_many()
<a name="__line2829"></a>        : output_(NULL), isFlushed_(false)
<a name="__line2830"></a>    {
<a name="__line2831"></a>    }
<a name="__line2832"></a>
<a name="__line2833"></a>
<a name="__line2834"></a>    hist::write_many::write_many(ostream &amp;output)
<a name="__line2835"></a>        : output_(&amp;output), isFlushed_(false)
<a name="__line2836"></a>    {
<a name="__line2837"></a>    }
<a name="__line2838"></a>
<a name="__line2839"></a>
<a name="__line2840"></a>    hist::write_many::write_many(const var &amp;datafilename)
<a name="__line2841"></a>        : dataFileName_(datafilename), output_(NULL), isFlushed_(false)
<a name="__line2842"></a>    {
<a name="__line2843"></a>    }
<a name="__line2844"></a>
<a name="__line2845"></a>
<a name="__line2846"></a>    hist::write_many&amp; hist::write_many::reinit(ostream &amp;output)
<a name="__line2847"></a>    {
<a name="__line2848"></a>        dataFileName_="";
<a name="__line2849"></a>        output_=&amp;output;
<a name="__line2850"></a>        oHistos_.clear();
<a name="__line2851"></a>        isFlushed_=false;
<a name="__line2852"></a>        return *this;
<a name="__line2853"></a>    }
<a name="__line2854"></a>
<a name="__line2855"></a>
<a name="__line2856"></a>    hist::write_many&amp; hist::write_many::reinit(const var &amp;datafilename)
<a name="__line2857"></a>    {
<a name="__line2858"></a>        dataFileName_=datafilename;
<a name="__line2859"></a>        output_=NULL;
<a name="__line2860"></a>        oHistos_.clear();
<a name="__line2861"></a>        isFlushed_=false;
<a name="__line2862"></a>        return *this;
<a name="__line2863"></a>    }
<a name="__line2864"></a>
<a name="__line2865"></a>
<a name="__line2866"></a>    hist::write_many&amp; hist::write_many::operator&lt;&lt;(hist &amp;h)
<a name="__line2867"></a>    {
<a name="__line2868"></a>        oHistos_.push_back(&amp;h);
<a name="__line2869"></a>        isFlushed_=false;
<a name="__line2870"></a>        return *this;
<a name="__line2871"></a>    }
<a name="__line2872"></a>
<a name="__line2873"></a>
<a name="__line2874"></a>    hist::write_many&amp; hist::write_many::put(hist &amp;h)
<a name="__line2875"></a>    {
<a name="__line2876"></a>        oHistos_.push_back(&amp;h);
<a name="__line2877"></a>        isFlushed_=false;
<a name="__line2878"></a>        return *this;
<a name="__line2879"></a>    }
<a name="__line2880"></a>
<a name="__line2881"></a>
<a name="__line2882"></a>    hist::write_many&amp; hist::write_many::flush()
<a name="__line2883"></a>    {
<a name="__line2884"></a>        int numHist=oHistos_.size();
<a name="__line2885"></a>        if ( numHist==0 ) { isFlushed_=true; return *this; }
<a name="__line2886"></a>        bool close=false;
<a name="__line2887"></a>        if ( output_==NULL ) { output_=openout(dataFileName_); close=true; }
<a name="__line2888"></a>        if ( output_==NULL )
<a name="__line2889"></a>        {
<a name="__line2890"></a>            warning::print("File was not opened successfully!", "hist::write_many&amp; hist::write_many::flush()");
<a name="__line2891"></a>            isFlushed_=true;
<a name="__line2892"></a>            return *this;
<a name="__line2893"></a>        }
<a name="__line2894"></a>        for ( int k=1 ; k&lt;numHist ; ++k )
<a name="__line2895"></a>        {
<a name="__line2896"></a>            if ( oHistos_[k]-&gt;dim_!=oHistos_[0]-&gt;dim_ )
<a name="__line2897"></a>            {
<a name="__line2898"></a>                warning::print("Non-matching histograms!", "hist::write&amp; hist::write::flush()");
<a name="__line2899"></a>                if ( close==true ) { delete output_; output_=NULL; }
<a name="__line2900"></a>                isFlushed_=true;
<a name="__line2901"></a>                return *this;
<a name="__line2902"></a>            }
<a name="__line2903"></a>            for ( int j=0 ; j&lt;oHistos_[0]-&gt;dim_ ; ++j )
<a name="__line2904"></a>            {
<a name="__line2905"></a>                if ( oHistos_[k]-&gt;min_[j]!=oHistos_[0]-&gt;min_[j] || 
<a name="__line2906"></a>                     oHistos_[k]-&gt;max_[j]!=oHistos_[0]-&gt;max_[j] || 
<a name="__line2907"></a>                     oHistos_[k]-&gt;bins_[j]!=oHistos_[0]-&gt;bins_[j] )
<a name="__line2908"></a>                {
<a name="__line2909"></a>                    warning::print("Non-matching histograms!", "hist::write&amp; hist::write::flush()");
<a name="__line2910"></a>                    if ( close==true ) { delete output_; output_=NULL; }
<a name="__line2911"></a>                    isFlushed_=true;
<a name="__line2912"></a>                    return *this;
<a name="__line2913"></a>                }
<a name="__line2914"></a>            }
<a name="__line2915"></a>        }
<a name="__line2916"></a>
<a name="__line2917"></a>        (*output_) &lt;&lt; "# dimension:" &lt;&lt; tabs(2, "# dimension:") &lt;&lt; oHistos_[0]-&gt;dim_ &lt;&lt; std::endl;
<a name="__line2918"></a>        for ( int j=0 ; j&lt;oHistos_[0]-&gt;dim_ ; ++j )
<a name="__line2919"></a>        {
<a name="__line2920"></a>            (*output_) &lt;&lt; "# minimum(" &lt;&lt; j+1 &lt;&lt; "):" &lt;&lt; tabs(2, (const var)"# minimum("&amp;(const var)(j+1)&amp;"):") &lt;&lt; oHistos_[0]-&gt;min_[j] &lt;&lt; tabs(2, oHistos_[0]-&gt;min_[j]) &lt;&lt; std::endl;
<a name="__line2921"></a>            (*output_) &lt;&lt; "# maximum(" &lt;&lt; j+1 &lt;&lt; "):" &lt;&lt; tabs(2, (const var)"# maximum("&amp;(const var)(j+1)&amp;"):") &lt;&lt; oHistos_[0]-&gt;max_[j] &lt;&lt; tabs(2, oHistos_[0]-&gt;max_[j]) &lt;&lt; std::endl;
<a name="__line2922"></a>            (*output_) &lt;&lt; "# bins(" &lt;&lt; j+1 &lt;&lt; "):" &lt;&lt; tabs(2, (const var)"# bins("&amp;(const var)(j+1)&amp;"):") &lt;&lt; oHistos_[0]-&gt;bins_[j] &lt;&lt; tabs(2, oHistos_[0]-&gt;bins_[j]) &lt;&lt; std::endl;
<a name="__line2923"></a>        }
<a name="__line2924"></a>        (*output_) &lt;&lt; "# legend:" &lt;&lt; tabs(4+(oHistos_[0]-&gt;dim_-1)*6, "# legend:");
<a name="__line2925"></a>        for ( int k=0 ; k&lt;numHist ; ++k )
<a name="__line2926"></a>        {
<a name="__line2927"></a>            (*output_) &lt;&lt; "\t\t" &lt;&lt; "`" &lt;&lt; oHistos_[k]-&gt;legend_ &lt;&lt; "`" &lt;&lt; tabs(4, (const var)"`"&amp;oHistos_[k]-&gt;legend_&amp;"`");
<a name="__line2928"></a>        }
<a name="__line2929"></a>        (*output_) &lt;&lt; std::endl;
<a name="__line2930"></a>        (*output_) &lt;&lt; "#";
<a name="__line2931"></a>        for ( int j=0 ; j&lt;oHistos_[0]-&gt;dim_ ; ++j )
<a name="__line2932"></a>        {
<a name="__line2933"></a>            if ( j==0 ) { (*output_) &lt;&lt; " " &lt;&lt; "`" &lt;&lt; oHistos_[0]-&gt;axistitle_[j] &lt;&lt; "`" &lt;&lt; tabs(4, (const var)"`"&amp;oHistos_[0]-&gt;axistitle_[j]&amp;"`"); }
<a name="__line2934"></a>            else { (*output_) &lt;&lt; "\t\t" &lt;&lt; "`" &lt;&lt; oHistos_[0]-&gt;axistitle_[j] &lt;&lt; "`" &lt;&lt; tabs(4, (const var)"`"&amp;oHistos_[0]-&gt;axistitle_[j]&amp;"`"); }
<a name="__line2935"></a>        }
<a name="__line2936"></a>        for ( int k=0 ; k&lt;numHist ; ++k )
<a name="__line2937"></a>        {
<a name="__line2938"></a>            (*output_) &lt;&lt; "\t\t" &lt;&lt; "`" &lt;&lt; oHistos_[k]-&gt;rangetitle_ &lt;&lt; "`" &lt;&lt; tabs(4, (const var)"`"&amp;oHistos_[k]-&gt;rangetitle_&amp;"`");
<a name="__line2939"></a>        }
<a name="__line2940"></a>        (*output_) &lt;&lt; std::endl;
<a name="__line2941"></a>
<a name="__line2942"></a>        bool skip;
<a name="__line2943"></a>        meas pos;
<a name="__line2944"></a>        var sval, seval;
<a name="__line2945"></a>        int hsize=oHistos_[0]-&gt;h_.size();
<a name="__line2946"></a>        int i;
<a name="__line2947"></a>        int j;
<a name="__line2948"></a>        int k;
<a name="__line2949"></a>        int nendl;
<a name="__line2950"></a>        int l;
<a name="__line2951"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line2952"></a>        {
<a name="__line2953"></a>            skip=false;
<a name="__line2954"></a>            oHistos_[0]-&gt;ind_[oHistos_[0]-&gt;dim_-1]=i;
<a name="__line2955"></a>            for ( j=oHistos_[0]-&gt;dim_-1 ; j&gt;=0 ; --j )
<a name="__line2956"></a>            {
<a name="__line2957"></a>                for ( k=1 ; k&lt;numHist ; ++k )
<a name="__line2958"></a>                {
<a name="__line2959"></a>                    if ( oHistos_[k]-&gt;m_[i*oHistos_[0]-&gt;dim_+j]!=oHistos_[0]-&gt;m_[i*oHistos_[0]-&gt;dim_+j] )
<a name="__line2960"></a>                    {
<a name="__line2961"></a>                        warning::print("Non-matching histograms!", "hist::write&amp; hist::write::flush()");
<a name="__line2962"></a>                        if ( close==true ) { delete output_; output_=NULL; }
<a name="__line2963"></a>                        isFlushed_=true;
<a name="__line2964"></a>                        return *this;
<a name="__line2965"></a>                    }
<a name="__line2966"></a>                }
<a name="__line2967"></a>                if ( oHistos_[0]-&gt;m_[i*oHistos_[0]-&gt;dim_+j]==0 ) { skip=true; break; }
<a name="__line2968"></a>                if ( j&lt;oHistos_[0]-&gt;dim_-1 ) oHistos_[0]-&gt;ind_[j]=oHistos_[0]-&gt;ind_[j+1]/oHistos_[0]-&gt;bins_[j+1];
<a name="__line2969"></a>            }
<a name="__line2970"></a>            if ( skip==true ) continue;
<a name="__line2971"></a>            for ( j=0 ; j&lt;oHistos_[0]-&gt;dim_ ; ++j )
<a name="__line2972"></a>            {
<a name="__line2973"></a>                oHistos_[0]-&gt;ind_[j]=oHistos_[0]-&gt;ind_[j]%oHistos_[0]-&gt;bins_[j];
<a name="__line2974"></a>                pos.v=oHistos_[0]-&gt;min_[j]+(oHistos_[0]-&gt;ind_[j]+0.5*oHistos_[0]-&gt;m_[i*oHistos_[0]-&gt;dim_+j])*oHistos_[0]-&gt;binsize_[j];
<a name="__line2975"></a>                pos.e=0.5*oHistos_[0]-&gt;binsize_[j]*oHistos_[0]-&gt;m_[i*oHistos_[0]-&gt;dim_+j];
<a name="__line2976"></a>                if ( j==0 ) { (*output_) &lt;&lt; "  " &lt;&lt; pos.v &lt;&lt; tabs(2, pos.v) &lt;&lt; " +/- "  &lt;&lt; pos.e &lt;&lt; tabs(2, (const var)" +/- "&amp;pos.e); }
<a name="__line2977"></a>                else { (*output_) &lt;&lt; "\t\t" &lt;&lt; pos.v &lt;&lt; tabs(2, pos.v) &lt;&lt; " +/- "  &lt;&lt; pos.e &lt;&lt; tabs(2, (const var)" +/- "&amp;pos.e); }
<a name="__line2978"></a>            }
<a name="__line2979"></a>            for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line2980"></a>            {
<a name="__line2981"></a>                if ( oHistos_[k]-&gt;h_[i].v==unset ) sval="unset";
<a name="__line2982"></a>                else sval=oHistos_[k]-&gt;h_[i].v;
<a name="__line2983"></a>                if ( oHistos_[k]-&gt;h_[i].e==unset ) seval="unset";
<a name="__line2984"></a>                else seval=oHistos_[k]-&gt;h_[i].e;
<a name="__line2985"></a>                (*output_) &lt;&lt; "\t\t" &lt;&lt; sval &lt;&lt; tabs(2, sval) 
<a name="__line2986"></a>                           &lt;&lt; " +/- "  &lt;&lt; seval &lt;&lt; tabs(2, (const var)" +/- "&amp;seval);
<a name="__line2987"></a>            }
<a name="__line2988"></a>            nendl=1;
<a name="__line2989"></a>            for ( j=oHistos_[0]-&gt;dim_-1 ; j&gt;=0 ; --j )
<a name="__line2990"></a>            {
<a name="__line2991"></a>                if ( oHistos_[0]-&gt;ind_[j]+oHistos_[0]-&gt;m_[i*oHistos_[0]-&gt;dim_+j]!=oHistos_[0]-&gt;bins_[j] ) break;
<a name="__line2992"></a>                ++nendl;
<a name="__line2993"></a>            }
<a name="__line2994"></a>            for ( l=0 ; l&lt;nendl ; ++l ) (*output_) &lt;&lt; std::endl;
<a name="__line2995"></a>        }
<a name="__line2996"></a>        (*output_) &lt;&lt; "# end" &lt;&lt; std::endl;
<a name="__line2997"></a>        if ( close==true ) { delete output_; output_=NULL; }
<a name="__line2998"></a>        isFlushed_=true;
<a name="__line2999"></a>        return *this;
<a name="__line3000"></a>    }
<a name="__line3001"></a>
<a name="__line3002"></a>
<a name="__line3003"></a>    hist::write_many::~write_many()
<a name="__line3004"></a>    {
<a name="__line3005"></a>        if ( isFlushed_==false ) flush();
<a name="__line3006"></a>    }
<a name="__line3007"></a>
<a name="__line3008"></a>
<a name="__line3009"></a>    hist&amp; hist::write(ostream &amp;output)
<a name="__line3010"></a>    {
<a name="__line3011"></a>        write_many(output)&lt;&lt;(*this);
<a name="__line3012"></a>        return *this;
<a name="__line3013"></a>    }
<a name="__line3014"></a>
<a name="__line3015"></a>
<a name="__line3016"></a>    hist&amp; hist::write(const var &amp;datafilename)
<a name="__line3017"></a>    {
<a name="__line3018"></a>        write_many(datafilename)&lt;&lt;(*this);
<a name="__line3019"></a>        return *this;
<a name="__line3020"></a>    }
<a name="__line3021"></a>
<a name="__line3022"></a>
<a name="__line3023"></a>    hist&amp; hist::fill_from(istream &amp;input, const histopt &amp;hopt)
<a name="__line3024"></a>    {
<a name="__line3025"></a>        if(buffer_size_&gt;0) warning::print("hist::fill_from(istream&amp;,const histopt &amp;) does not handle buffering yet","hist::fill_from");
<a name="__line3026"></a>        function condition=unset;
<a name="__line3027"></a>        if ( hopt.x_condition_.initialized() ) condition.append(hopt.x_condition_);
<a name="__line3028"></a>        else if ( histopt::default_x_condition_.initialized() ) condition.append(histopt::default_x_condition_);
<a name="__line3029"></a>        if ( hopt.y_condition_.initialized() ) condition.append(hopt.y_condition_);
<a name="__line3030"></a>        else if ( histopt::default_y_condition_.initialized() ) condition.append(histopt::default_y_condition_);
<a name="__line3031"></a>        function filter=unset;
<a name="__line3032"></a>        if ( hopt.x_.initialized() ) filter.append(hopt.x_);
<a name="__line3033"></a>        else if ( histopt::default_x_.initialized() ) filter.append(histopt::default_x_condition_);
<a name="__line3034"></a>        if ( hopt.y_.initialized() ) filter.append(hopt.y_condition_);
<a name="__line3035"></a>        else if ( histopt::default_y_.initialized() ) filter.append(histopt::default_y_condition_);
<a name="__line3036"></a>        string line, buff;
<a name="__line3037"></a>        vector&lt;var&gt; col;
<a name="__line3038"></a>        datapoint pt;
<a name="__line3039"></a>        hist::point pos;
<a name="__line3040"></a>        int lines=0;
<a name="__line3041"></a>        int columns=0;
<a name="__line3042"></a>        int columns1=0;
<a name="__line3043"></a>        double weight=1.0;
<a name="__line3044"></a>        bool skip;
<a name="__line3045"></a>        std::istringstream iss;
<a name="__line3046"></a>        while ( getline(input, line) )
<a name="__line3047"></a>        {
<a name="__line3048"></a>            if ( hopt.maxlines_&gt;=0 &amp;&amp; lines&gt;=hopt.maxlines_ ) break;
<a name="__line3049"></a>            else if ( histopt::default_maxlines_&gt;=0 &amp;&amp; lines&gt;=histopt::default_maxlines_ ) break;
<a name="__line3050"></a>            iss.str(line);
<a name="__line3051"></a>            col.clear();
<a name="__line3052"></a>            while ( (iss&gt;&gt;buff) ) { col.push_back((var)(buff)); }
<a name="__line3053"></a>            iss.str("");
<a name="__line3054"></a>            iss.clear();
<a name="__line3055"></a>            if ( col.empty() ) continue;
<a name="__line3056"></a>            if ( col[0][0]=='#' ) continue;
<a name="__line3057"></a>            if ( hopt.condition().initialized() ) if ( hopt.condition().eval(col).dbl()==0.0 ) continue;
<a name="__line3058"></a>            if ( condition.initialized() ) if ( condition.eval(col).dbl()==0.0 ) continue;
<a name="__line3059"></a>            if ( filter.initialized() ) columns=filter.components();
<a name="__line3060"></a>            else columns=col.size();
<a name="__line3061"></a>            if ( columns&lt;=0 ) continue;
<a name="__line3062"></a>            pt.resize(columns);
<a name="__line3063"></a>            if ( filter.initialized() ) filter.meval(col, pt);
<a name="__line3064"></a>            else for( int i=0 ; i&lt;columns; ++i ) pt[i]=col[i];
<a name="__line3065"></a>            if ( hopt.y_.initialized() ) columns1=columns-1;
<a name="__line3066"></a>            else if ( histopt::default_y_.initialized() ) columns1=columns-1;
<a name="__line3067"></a>            else columns1=columns;
<a name="__line3068"></a>            if ( columns1&lt;=0 ) continue;
<a name="__line3069"></a>            pos.resize(columns1);
<a name="__line3070"></a>            skip=false;
<a name="__line3071"></a>            for ( int i=0 ; i&lt;columns1 ; ++i )
<a name="__line3072"></a>            {
<a name="__line3073"></a>                if ( ignore::it(pt[i])==true ) { skip=true; break; }
<a name="__line3074"></a>                pos[i+1]=pt[i].dbl();
<a name="__line3075"></a>            }
<a name="__line3076"></a>            if ( skip==true ) continue;
<a name="__line3077"></a>            if ( columns1&lt;columns ) weight=pt[columns1].dbl();
<a name="__line3078"></a>            else weight=1.0;
<a name="__line3079"></a>            this-&gt;fill(pos, weight);
<a name="__line3080"></a>            ++lines;
<a name="__line3081"></a>        }
<a name="__line3082"></a>        return *this;
<a name="__line3083"></a>    }
<a name="__line3084"></a>
<a name="__line3085"></a>
<a name="__line3086"></a>    hist&amp; hist::fill_from(const var &amp;datafilename, const histopt &amp;hopt)
<a name="__line3087"></a>    {
<a name="__line3088"></a>        istream *input=openin(datafilename);
<a name="__line3089"></a>        fill_from(*input, hopt);
<a name="__line3090"></a>        delete input;
<a name="__line3091"></a>        return *this;
<a name="__line3092"></a>    }
<a name="__line3093"></a>
<a name="__line3094"></a>
<a name="__line3095"></a>    hist&amp; hist::fill_from(const dgraph &amp;dg, const histopt &amp;hopt)
<a name="__line3096"></a>    {
<a name="__line3097"></a>        if(buffer_size_&gt;0) warning::print("hist::fill_from(const dgraph&amp;, const histopt &amp;) does not handle buffering yet","hist::fill_from");
<a name="__line3098"></a>        function condition=unset;
<a name="__line3099"></a>        if ( hopt.x_condition_.initialized() ) condition.append(hopt.x_condition_);
<a name="__line3100"></a>        else if ( histopt::default_x_condition_.initialized() ) condition.append(histopt::default_x_condition_);
<a name="__line3101"></a>        if ( hopt.y_condition_.initialized() ) condition.append(hopt.y_condition_);
<a name="__line3102"></a>        else if ( histopt::default_y_condition_.initialized() ) condition.append(histopt::default_y_condition_);
<a name="__line3103"></a>        function filter=unset;
<a name="__line3104"></a>        if ( hopt.x_.initialized() ) filter.append(hopt.x_);
<a name="__line3105"></a>        else if ( histopt::default_x_.initialized() ) filter.append(histopt::default_x_condition_);
<a name="__line3106"></a>        if ( hopt.y_.initialized() ) filter.append(hopt.y_condition_);
<a name="__line3107"></a>        else if ( histopt::default_y_.initialized() ) filter.append(histopt::default_y_condition_);
<a name="__line3108"></a>        datapoint pt;
<a name="__line3109"></a>        hist::point pos;
<a name="__line3110"></a>        int columns=0;
<a name="__line3111"></a>        int columns1=0;
<a name="__line3112"></a>        double weight=1.0;
<a name="__line3113"></a>        bool skip;
<a name="__line3114"></a>        for ( int j=0 ; j&lt;(int)dg.size() ; ++j )
<a name="__line3115"></a>        {
<a name="__line3116"></a>            if ( hopt.maxlines_&gt;=0 &amp;&amp; j&gt;=hopt.maxlines_ ) break;
<a name="__line3117"></a>            else if ( histopt::default_maxlines_&gt;=0 &amp;&amp; j&gt;=histopt::default_maxlines_ ) break;
<a name="__line3118"></a>            if ( dg.get(j)-&gt;empty() ) continue;
<a name="__line3119"></a>            if ( hopt.condition().initialized() ) if ( hopt.condition().eval((*dg.get(j))).dbl()==0.0 ) continue;
<a name="__line3120"></a>            if ( condition.initialized() ) if ( condition.eval((*dg.get(j))).dbl()==0.0 ) continue;
<a name="__line3121"></a>            if ( filter.initialized() ) columns=filter.components();
<a name="__line3122"></a>            else columns=dg.get(j)-&gt;size();
<a name="__line3123"></a>            if ( columns&lt;=0 ) continue;
<a name="__line3124"></a>            pt.resize(columns);
<a name="__line3125"></a>            if ( filter.initialized() ) filter.meval((*dg.get(j)), pt);
<a name="__line3126"></a>            else for( int i=0 ; i&lt;columns; ++i ) pt[i]=(*dg.get(j))[i];
<a name="__line3127"></a>            if ( hopt.y_.initialized() ) columns1=columns-1;
<a name="__line3128"></a>            else if ( histopt::default_y_.initialized() ) columns1=columns-1;
<a name="__line3129"></a>            else columns1=columns;
<a name="__line3130"></a>            if ( columns1&lt;=0 ) continue;
<a name="__line3131"></a>            pos.resize(columns1);
<a name="__line3132"></a>            skip=false;
<a name="__line3133"></a>            for( int i=0 ; i&lt;columns1; ++i )
<a name="__line3134"></a>            {
<a name="__line3135"></a>                if ( ignore::it(pt[i])==true ) { skip=true; break; }
<a name="__line3136"></a>                pos[i+1]=pt[i].dbl();
<a name="__line3137"></a>            }
<a name="__line3138"></a>            if ( skip==true ) continue;
<a name="__line3139"></a>            if ( columns1&lt;columns ) weight=pt[columns1].dbl();
<a name="__line3140"></a>            else weight=1.0;
<a name="__line3141"></a>            this-&gt;fill(pos, weight);
<a name="__line3142"></a>        }
<a name="__line3143"></a>        return *this;
<a name="__line3144"></a>    }
<a name="__line3145"></a>
<a name="__line3146"></a>
<a name="__line3147"></a>    hist::read_many::read_many()
<a name="__line3148"></a>        : input_(NULL), isFlushed_(false)
<a name="__line3149"></a>    {
<a name="__line3150"></a>    }
<a name="__line3151"></a>
<a name="__line3152"></a>
<a name="__line3153"></a>    hist::read_many::read_many(istream &amp;input)
<a name="__line3154"></a>        : input_(NULL), isFlushed_(false)
<a name="__line3155"></a>    {
<a name="__line3156"></a>        reinit(input);
<a name="__line3157"></a>    }
<a name="__line3158"></a>
<a name="__line3159"></a>
<a name="__line3160"></a>    hist::read_many::read_many(const var &amp;datafilename)
<a name="__line3161"></a>        : input_(NULL), isFlushed_(false)
<a name="__line3162"></a>    {
<a name="__line3163"></a>        reinit(datafilename);
<a name="__line3164"></a>    }
<a name="__line3165"></a>
<a name="__line3166"></a>
<a name="__line3167"></a>    hist::read_many&amp; hist::read_many::reinit(istream &amp;input)
<a name="__line3168"></a>    {
<a name="__line3169"></a>        dataFileName_="";
<a name="__line3170"></a>        input_=&amp;input;
<a name="__line3171"></a>        iHistos_.clear();
<a name="__line3172"></a>        isFlushed_=false;
<a name="__line3173"></a>        return *this;
<a name="__line3174"></a>    }
<a name="__line3175"></a>
<a name="__line3176"></a>
<a name="__line3177"></a>    hist::read_many&amp; hist::read_many::reinit(const var &amp;datafilename)
<a name="__line3178"></a>    {
<a name="__line3179"></a>        if ( input_!=NULL ) { delete input_; input_=NULL; }
<a name="__line3180"></a>        dataFileName_=datafilename;
<a name="__line3181"></a>        iHistos_.clear();
<a name="__line3182"></a>        isFlushed_=false;
<a name="__line3183"></a>        return *this;
<a name="__line3184"></a>    }
<a name="__line3185"></a>
<a name="__line3186"></a>
<a name="__line3187"></a>    hist::read_many&amp; hist::read_many::operator&gt;&gt;(hist &amp;h)
<a name="__line3188"></a>    {
<a name="__line3189"></a>        int number_of_histo=iHistos_.size()+1;
<a name="__line3190"></a>        iHistos_.push_back(std::pair&lt;hist*, int&gt;(&amp;h, number_of_histo));
<a name="__line3191"></a>        isFlushed_=false;
<a name="__line3192"></a>        return *this;
<a name="__line3193"></a>    }
<a name="__line3194"></a>
<a name="__line3195"></a>
<a name="__line3196"></a>    hist::read_many&amp; hist::read_many::operator&gt;&gt;(const int number_of_histo)
<a name="__line3197"></a>    {
<a name="__line3198"></a>        if ( iHistos_.size()&gt;0 ) iHistos_[iHistos_.size()-1].second=number_of_histo;
<a name="__line3199"></a>        isFlushed_=false;
<a name="__line3200"></a>        return *this;
<a name="__line3201"></a>    }
<a name="__line3202"></a>
<a name="__line3203"></a>
<a name="__line3204"></a>    hist::read_many&amp; hist::read_many::get(hist &amp;h, const int number_of_histo)
<a name="__line3205"></a>    {
<a name="__line3206"></a>        iHistos_.push_back(std::pair&lt;hist*, int&gt;(&amp;h, number_of_histo));
<a name="__line3207"></a>        isFlushed_=false;
<a name="__line3208"></a>        return *this;
<a name="__line3209"></a>    }
<a name="__line3210"></a>
<a name="__line3211"></a>
<a name="__line3212"></a>    hist::read_many&amp; hist::read_many::flush()
<a name="__line3213"></a>    {
<a name="__line3214"></a>        int numHist=iHistos_.size();
<a name="__line3215"></a>        if ( numHist==0 ) { isFlushed_=true; return *this; }
<a name="__line3216"></a>        bool close=false;
<a name="__line3217"></a>        if ( input_==NULL ) { input_=openin(dataFileName_); close=true; }
<a name="__line3218"></a>        if ( input_==NULL )
<a name="__line3219"></a>        {
<a name="__line3220"></a>            warning::print("File was not opened successfully!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3221"></a>            isFlushed_=true;
<a name="__line3222"></a>            return *this;
<a name="__line3223"></a>        }
<a name="__line3224"></a>        std::string linebuff, buff;
<a name="__line3225"></a>        std::istringstream iss;
<a name="__line3226"></a>
<a name="__line3227"></a>        if ( ! std::getline(*input_, linebuff) )
<a name="__line3228"></a>        {
<a name="__line3229"></a>            warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3230"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3231"></a>            isFlushed_=true;
<a name="__line3232"></a>            return *this;
<a name="__line3233"></a>        }
<a name="__line3234"></a>        iss.str(linebuff);
<a name="__line3235"></a>        int dim;
<a name="__line3236"></a>        if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dim) )
<a name="__line3237"></a>        {
<a name="__line3238"></a>            warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3239"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3240"></a>            isFlushed_=true;
<a name="__line3241"></a>            return *this;
<a name="__line3242"></a>        }
<a name="__line3243"></a>        iss.str("");
<a name="__line3244"></a>        iss.clear();
<a name="__line3245"></a>
<a name="__line3246"></a>        std::vector&lt;double&gt; dbegin(dim);
<a name="__line3247"></a>        std::vector&lt;double&gt; dend(dim);
<a name="__line3248"></a>        std::vector&lt;int&gt; dbins(dim);
<a name="__line3249"></a>        for ( int j=0 ; j&lt;dim ; ++j )
<a name="__line3250"></a>        {
<a name="__line3251"></a>            if ( ! std::getline(*input_, linebuff) )
<a name="__line3252"></a>            {
<a name="__line3253"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3254"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3255"></a>                isFlushed_=true;
<a name="__line3256"></a>                return *this;
<a name="__line3257"></a>            }
<a name="__line3258"></a>            iss.str(linebuff);
<a name="__line3259"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dbegin[j]) )
<a name="__line3260"></a>            {
<a name="__line3261"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3262"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3263"></a>                isFlushed_=true;
<a name="__line3264"></a>                return *this;
<a name="__line3265"></a>            }
<a name="__line3266"></a>            iss.str("");
<a name="__line3267"></a>            iss.clear();
<a name="__line3268"></a>            if ( ! std::getline(*input_, linebuff) )
<a name="__line3269"></a>            {
<a name="__line3270"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3271"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3272"></a>                isFlushed_=true;
<a name="__line3273"></a>                return *this;
<a name="__line3274"></a>            }
<a name="__line3275"></a>            iss.str(linebuff);
<a name="__line3276"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dend[j]) )
<a name="__line3277"></a>            {
<a name="__line3278"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3279"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3280"></a>                isFlushed_=true;
<a name="__line3281"></a>                return *this;
<a name="__line3282"></a>            }
<a name="__line3283"></a>            iss.str("");
<a name="__line3284"></a>            iss.clear();
<a name="__line3285"></a>            if ( ! std::getline(*input_, linebuff) )
<a name="__line3286"></a>            {
<a name="__line3287"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3288"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3289"></a>                isFlushed_=true;
<a name="__line3290"></a>                return *this;
<a name="__line3291"></a>            }
<a name="__line3292"></a>            iss.str(linebuff);
<a name="__line3293"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dbins[j]) )
<a name="__line3294"></a>            {
<a name="__line3295"></a>                warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3296"></a>                if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3297"></a>                isFlushed_=true;
<a name="__line3298"></a>                return *this;
<a name="__line3299"></a>            }
<a name="__line3300"></a>            iss.str("");
<a name="__line3301"></a>            iss.clear();
<a name="__line3302"></a>        }
<a name="__line3303"></a>
<a name="__line3304"></a>        if ( ! std::getline(*input_, linebuff) )
<a name="__line3305"></a>        {
<a name="__line3306"></a>            warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3307"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3308"></a>            isFlushed_=true;
<a name="__line3309"></a>            return *this;
<a name="__line3310"></a>        }
<a name="__line3311"></a>        int beginmarker=0;
<a name="__line3312"></a>        int endmarker=0;
<a name="__line3313"></a>        int nHist=0;
<a name="__line3314"></a>        std::vector&lt;var&gt; htitle;
<a name="__line3315"></a>        for ( unsigned int l=0 ; l&lt;linebuff.length() ; ++l )
<a name="__line3316"></a>        {
<a name="__line3317"></a>            if ( linebuff[l]=='`' )
<a name="__line3318"></a>            {
<a name="__line3319"></a>                if ( endmarker==beginmarker ) { beginmarker=l; endmarker=l+1; }
<a name="__line3320"></a>                else { endmarker=l; htitle.push_back(linebuff.substr(beginmarker+1, endmarker-beginmarker-1)); ++nHist; endmarker=beginmarker; }
<a name="__line3321"></a>            }
<a name="__line3322"></a>        }
<a name="__line3323"></a>
<a name="__line3324"></a>        if ( ! std::getline(*input_, linebuff) )
<a name="__line3325"></a>        {
<a name="__line3326"></a>            warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3327"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3328"></a>            isFlushed_=true;
<a name="__line3329"></a>            return *this;
<a name="__line3330"></a>        }
<a name="__line3331"></a>        beginmarker=0;
<a name="__line3332"></a>        endmarker=0;
<a name="__line3333"></a>        int nHist1=0;
<a name="__line3334"></a>        std::vector&lt;var&gt; dtitle;
<a name="__line3335"></a>        std::vector&lt;var&gt; rtitle;
<a name="__line3336"></a>        for ( unsigned int l=0 ; l&lt;linebuff.length() ; ++l )
<a name="__line3337"></a>        {
<a name="__line3338"></a>            if ( linebuff[l]=='`' )
<a name="__line3339"></a>            {
<a name="__line3340"></a>                if ( endmarker==beginmarker ) { beginmarker=l; endmarker=l+1; }
<a name="__line3341"></a>                else
<a name="__line3342"></a>                {
<a name="__line3343"></a>                    endmarker=l;
<a name="__line3344"></a>                    if ( nHist1&lt;dim ) dtitle.push_back(linebuff.substr(beginmarker+1, endmarker-beginmarker-1));
<a name="__line3345"></a>                    else rtitle.push_back(linebuff.substr(beginmarker+1, endmarker-beginmarker-1));
<a name="__line3346"></a>                    ++nHist1;
<a name="__line3347"></a>                    endmarker=beginmarker;
<a name="__line3348"></a>                }
<a name="__line3349"></a>            }
<a name="__line3350"></a>        }
<a name="__line3351"></a>        if ( nHist1-dim!=nHist )
<a name="__line3352"></a>        {
<a name="__line3353"></a>            warning::print("Could not read histogram!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3354"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3355"></a>            isFlushed_=true;
<a name="__line3356"></a>            return *this;
<a name="__line3357"></a>        }
<a name="__line3358"></a>        int NHist=(nHist&lt;numHist ? nHist : numHist);
<a name="__line3359"></a>        if ( NHist&lt;=0 )
<a name="__line3360"></a>        {
<a name="__line3361"></a>            warning::print("No histograms in file which can be read!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3362"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3363"></a>            isFlushed_=true;
<a name="__line3364"></a>            return *this;
<a name="__line3365"></a>        }
<a name="__line3366"></a>
<a name="__line3367"></a>        int iok=-1;
<a name="__line3368"></a>        for ( int k=0 ; k&lt;numHist ; ++k )
<a name="__line3369"></a>        {
<a name="__line3370"></a>            if ( iHistos_[k].second&lt;1 )
<a name="__line3371"></a>            {
<a name="__line3372"></a>                warning::print("Histogram index has to be greater than zero!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3373"></a>                continue;
<a name="__line3374"></a>            }
<a name="__line3375"></a>            if ( iHistos_[k].second&gt;nHist )
<a name="__line3376"></a>            {
<a name="__line3377"></a>                warning::print("There are not that many histograms in the file as was requested!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3378"></a>                continue;
<a name="__line3379"></a>            }
<a name="__line3380"></a>            iHistos_[k].first-&gt;reinit_(dim, dbegin, dend, dbins, dtitle, rtitle[iHistos_[k].second-1], htitle[iHistos_[k].second-1]);
<a name="__line3381"></a>            iHistos_[k].first-&gt;sequence_.clear();
<a name="__line3382"></a>            iHistos_[k].first-&gt;invsequence_.clear();
<a name="__line3383"></a>            if ( iok==-1 ) iok=k;
<a name="__line3384"></a>        }
<a name="__line3385"></a>        if ( iok==-1 )
<a name="__line3386"></a>        {
<a name="__line3387"></a>            warning::print("Specified histograms do not exist in file!", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3388"></a>            if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3389"></a>            isFlushed_=true;
<a name="__line3390"></a>            return *this;
<a name="__line3391"></a>        }
<a name="__line3392"></a>
<a name="__line3393"></a>        meas pos;
<a name="__line3394"></a>        std::vector&lt;int&gt; indprime(dim);
<a name="__line3395"></a>        std::vector&lt;int&gt; m(dim);
<a name="__line3396"></a>        meas val;
<a name="__line3397"></a>        int i=0, iprime=0, iprimemax=0, iprimeprime=0;
<a name="__line3398"></a>        int j=0, jprime=0;
<a name="__line3399"></a>        int k=0;
<a name="__line3400"></a>        bool skip=false;
<a name="__line3401"></a>        while ( getline(*input_, linebuff) )
<a name="__line3402"></a>        {
<a name="__line3403"></a>            if ( linebuff.length()==0 ) continue;
<a name="__line3404"></a>            if ( linebuff=="# end" ) break;
<a name="__line3405"></a>            if ( linebuff[0]=='#' ) continue;
<a name="__line3406"></a>            iss.str(linebuff);
<a name="__line3407"></a>            i=0;
<a name="__line3408"></a>            for ( j=0 ; j&lt;dim ; ++j )
<a name="__line3409"></a>            {
<a name="__line3410"></a>                if ( !(iss&gt;&gt;pos) )
<a name="__line3411"></a>                {
<a name="__line3412"></a>                    warning::print("Could not read histogram! Clearing histograms.", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3413"></a>                    for ( int kprime=0 ; kprime&lt;numHist ; ++kprime )
<a name="__line3414"></a>                    {
<a name="__line3415"></a>                        if ( iHistos_[kprime].second&lt;1 ) continue;
<a name="__line3416"></a>                        if ( iHistos_[kprime].second&gt;nHist ) continue;
<a name="__line3417"></a>                        iHistos_[kprime].first-&gt;reinit_(0, std::vector&lt;double&gt;(0), std::vector&lt;double&gt;(0), std::vector&lt;int&gt;(0), std::vector&lt;var&gt;(0), (var)"", (var)"");
<a name="__line3418"></a>                    }
<a name="__line3419"></a>                    if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3420"></a>                    isFlushed_=true;
<a name="__line3421"></a>                    return *this;
<a name="__line3422"></a>                }
<a name="__line3423"></a>                iHistos_[iok].first-&gt;ind_[j]=(int)((pos.v-pos.e+0.5*iHistos_[iok].first-&gt;binsize_[j]-dbegin[j])/iHistos_[iok].first-&gt;binsize_[j]);
<a name="__line3424"></a>                m[j]=(int)(pos.e/iHistos_[iok].first-&gt;binsize_[j]*2.0*(1.0+0.001/dbins[j]));
<a name="__line3425"></a>                i+=iHistos_[iok].first-&gt;mul_[j]*iHistos_[iok].first-&gt;ind_[j];
<a name="__line3426"></a>            }
<a name="__line3427"></a>            for ( k=0 ; k&lt;nHist ; ++k )
<a name="__line3428"></a>            {
<a name="__line3429"></a>                if ( !(iss&gt;&gt;val) )
<a name="__line3430"></a>                {
<a name="__line3431"></a>                    warning::print("Could not read histogram! Clearing histograms.", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3432"></a>                    for ( int kprime=0 ; kprime&lt;numHist ; ++kprime )
<a name="__line3433"></a>                    {
<a name="__line3434"></a>                        if ( iHistos_[kprime].second&lt;1 ) continue;
<a name="__line3435"></a>                        if ( iHistos_[kprime].second&gt;nHist ) continue;
<a name="__line3436"></a>                        iHistos_[kprime].first-&gt;reinit_(0, std::vector&lt;double&gt;(0), std::vector&lt;double&gt;(0), std::vector&lt;int&gt;(0), std::vector&lt;var&gt;(0), (var)"", (var)"");
<a name="__line3437"></a>                    }
<a name="__line3438"></a>                    if ( close==true ) { delete input_; input_=NULL; }
<a name="__line3439"></a>                    isFlushed_=true;
<a name="__line3440"></a>                    return *this;
<a name="__line3441"></a>                }
<a name="__line3442"></a>                for ( int kprime=0 ; kprime&lt;numHist ; ++kprime )
<a name="__line3443"></a>                {
<a name="__line3444"></a>                    if ( iHistos_[kprime].second&lt;1 ) continue;
<a name="__line3445"></a>                    if ( iHistos_[kprime].second&gt;nHist ) continue;
<a name="__line3446"></a>                    if ( iHistos_[kprime].second-1==k ) iHistos_[kprime].first-&gt;h_[i]=val;
<a name="__line3447"></a>                }
<a name="__line3448"></a>            }
<a name="__line3449"></a>            iprimemax=1;
<a name="__line3450"></a>            for ( j=0 ; j&lt;dim ; ++j ) iprimemax*=m[j];
<a name="__line3451"></a>            for ( iprime=0 ; iprime&lt;iprimemax ; ++iprime )
<a name="__line3452"></a>            {
<a name="__line3453"></a>                iprimeprime=0;
<a name="__line3454"></a>                indprime[dim-1]=iprime;
<a name="__line3455"></a>                for ( j=dim-1 ; j&gt;=0 ; --j )
<a name="__line3456"></a>                {
<a name="__line3457"></a>                    if ( j&lt;dim-1 ) indprime[j]=indprime[j+1]/m[j+1];
<a name="__line3458"></a>                    iprimeprime+=iHistos_[iok].first-&gt;mul_[j]*(iHistos_[iok].first-&gt;ind_[j]+indprime[j]%m[j]);
<a name="__line3459"></a>                }
<a name="__line3460"></a>                for ( j=0 ; j&lt;dim ; ++j )
<a name="__line3461"></a>                {
<a name="__line3462"></a>                    indprime[j]=indprime[j]%m[j];
<a name="__line3463"></a>                    if ( indprime[j]==0 )
<a name="__line3464"></a>                    {
<a name="__line3465"></a>                        for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line3466"></a>                        {
<a name="__line3467"></a>                            if ( iHistos_[k].second&lt;1 ) continue;
<a name="__line3468"></a>                            if ( iHistos_[k].second&gt;nHist ) continue;
<a name="__line3469"></a>                            iHistos_[k].first-&gt;m_[iprimeprime*dim+j]=m[j];
<a name="__line3470"></a>                        }
<a name="__line3471"></a>                    }
<a name="__line3472"></a>                    else
<a name="__line3473"></a>                    {
<a name="__line3474"></a>                        for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line3475"></a>                        {
<a name="__line3476"></a>                            if ( iHistos_[k].second&lt;1 ) continue;
<a name="__line3477"></a>                            if ( iHistos_[k].second&gt;nHist ) continue;
<a name="__line3478"></a>                            iHistos_[k].first-&gt;m_[iprimeprime*dim+j]=0;
<a name="__line3479"></a>                        }
<a name="__line3480"></a>                    }
<a name="__line3481"></a>                }
<a name="__line3482"></a>            }
<a name="__line3483"></a>            iss.str("");
<a name="__line3484"></a>            iss.clear();
<a name="__line3485"></a>        }
<a name="__line3486"></a>        if ( close==true ) { delete input_; input_=NULL; close=false; }
<a name="__line3487"></a>        int hsize=iHistos_[iok].first-&gt;h_.size();
<a name="__line3488"></a>        iprimeprime=0;
<a name="__line3489"></a>        for ( i=0 ; i&lt;hsize ; ++i )
<a name="__line3490"></a>        {
<a name="__line3491"></a>            skip=false;
<a name="__line3492"></a>            iHistos_[iok].first-&gt;ind_[dim-1]=i;
<a name="__line3493"></a>            for ( j=dim-1 ; j&gt;=0 ; --j )
<a name="__line3494"></a>            {
<a name="__line3495"></a>                if ( iHistos_[iok].first-&gt;m_[i*dim+j]==0 ) skip=true;
<a name="__line3496"></a>                if ( j&lt;dim-1 ) iHistos_[iok].first-&gt;ind_[j]=iHistos_[iok].first-&gt;ind_[j+1]/iHistos_[iok].first-&gt;bins_[j+1];
<a name="__line3497"></a>            }
<a name="__line3498"></a>            if ( skip==false )
<a name="__line3499"></a>            {
<a name="__line3500"></a>                for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line3501"></a>                {
<a name="__line3502"></a>                    if ( iHistos_[k].second&lt;1 ) continue;
<a name="__line3503"></a>                    if ( iHistos_[k].second&gt;nHist ) continue;
<a name="__line3504"></a>                    iHistos_[k].first-&gt;sequence_.push_back(i);
<a name="__line3505"></a>                    iHistos_[k].first-&gt;invsequence_.push_back(iprimeprime);
<a name="__line3506"></a>                }
<a name="__line3507"></a>                ++iprimeprime;
<a name="__line3508"></a>                continue;
<a name="__line3509"></a>            }
<a name="__line3510"></a>            for ( j=0 ; j&lt;dim ; ++j )
<a name="__line3511"></a>            {
<a name="__line3512"></a>                iHistos_[iok].first-&gt;ind_[j]=iHistos_[iok].first-&gt;ind_[j]%iHistos_[iok].first-&gt;bins_[j];
<a name="__line3513"></a>            }
<a name="__line3514"></a>            for ( j=0 ; j&lt;dim ; ++j )
<a name="__line3515"></a>            {
<a name="__line3516"></a>                while ( iHistos_[iok].first-&gt;ind_[j]&gt;=0 )
<a name="__line3517"></a>                {
<a name="__line3518"></a>                    iprime=0;
<a name="__line3519"></a>                    for ( jprime=0 ; jprime&lt;dim ; ++jprime ) iprime+=iHistos_[iok].first-&gt;ind_[jprime]*iHistos_[iok].first-&gt;mul_[jprime];
<a name="__line3520"></a>                    if ( iHistos_[iok].first-&gt;m_[iprime*dim+j]==0 ) { --(iHistos_[iok].first-&gt;ind_[j]); } else { break; }
<a name="__line3521"></a>                }
<a name="__line3522"></a>            }
<a name="__line3523"></a>            if ( (unsigned int)(iprime)&gt;=iHistos_[iok].first-&gt;invsequence_.size() )
<a name="__line3524"></a>            {
<a name="__line3525"></a>                warning::print("Index inconsistency when reading histogram! Clearing histograms.", "hist::read_many&amp; hist::read_many::flush()");
<a name="__line3526"></a>                for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line3527"></a>                {
<a name="__line3528"></a>                    if ( iHistos_[k].second&lt;1 ) continue;
<a name="__line3529"></a>                    if ( iHistos_[k].second&gt;nHist ) continue;
<a name="__line3530"></a>                    iHistos_[k].first-&gt;reinit_(0, std::vector&lt;double&gt;(0), std::vector&lt;double&gt;(0), std::vector&lt;int&gt;(0), std::vector&lt;var&gt;(0), (var)"", (var)"");
<a name="__line3531"></a>                }
<a name="__line3532"></a>                isFlushed_=true;
<a name="__line3533"></a>                return *this;
<a name="__line3534"></a>            }
<a name="__line3535"></a>            for ( k=0 ; k&lt;numHist ; ++k )
<a name="__line3536"></a>            {
<a name="__line3537"></a>                if ( iHistos_[k].second&lt;1 ) continue;
<a name="__line3538"></a>                if ( iHistos_[k].second&gt;nHist ) continue;
<a name="__line3539"></a>                iHistos_[k].first-&gt;invsequence_.push_back(iHistos_[iok].first-&gt;invsequence_[iprime]);
<a name="__line3540"></a>            }
<a name="__line3541"></a>        }
<a name="__line3542"></a>        isFlushed_=true;
<a name="__line3543"></a>        return *this;
<a name="__line3544"></a>    }
<a name="__line3545"></a>
<a name="__line3546"></a>
<a name="__line3547"></a>    hist::read_many::~read_many()
<a name="__line3548"></a>    {
<a name="__line3549"></a>        if ( isFlushed_==false ) flush();
<a name="__line3550"></a>    }
<a name="__line3551"></a>
<a name="__line3552"></a>
<a name="__line3553"></a>    int hist::read_many::dim(istream &amp;input)
<a name="__line3554"></a>    {
<a name="__line3555"></a>        std::string linebuff, buff;
<a name="__line3556"></a>        std::istringstream iss;
<a name="__line3557"></a>        if ( ! std::getline(input, linebuff) )
<a name="__line3558"></a>        {
<a name="__line3559"></a>            warning::print("Could not read histogram dimension!", "unsigned int hist::read_many::dim(const var&amp;)");
<a name="__line3560"></a>            return 0;
<a name="__line3561"></a>        }
<a name="__line3562"></a>        iss.str(linebuff);
<a name="__line3563"></a>        int d;
<a name="__line3564"></a>        if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;d) )
<a name="__line3565"></a>        {
<a name="__line3566"></a>            warning::print("Could not read histogram dimension!", "unsigned int hist::read_many::dim(const var&amp;)");
<a name="__line3567"></a>            return 0;
<a name="__line3568"></a>        }
<a name="__line3569"></a>        iss.str("");
<a name="__line3570"></a>        iss.clear();
<a name="__line3571"></a>        return d;
<a name="__line3572"></a>    }
<a name="__line3573"></a>
<a name="__line3574"></a>
<a name="__line3575"></a>    int hist::read_many::dim(const var &amp;datafilename)
<a name="__line3576"></a>    {
<a name="__line3577"></a>        int d;
<a name="__line3578"></a>        istream *input=openin(datafilename);
<a name="__line3579"></a>        d=dim(*input);
<a name="__line3580"></a>        delete input;
<a name="__line3581"></a>        return d;
<a name="__line3582"></a>    }
<a name="__line3583"></a>
<a name="__line3584"></a>
<a name="__line3585"></a>    int hist::read_many::numhists(istream &amp;input)
<a name="__line3586"></a>    {
<a name="__line3587"></a>        std::string linebuff, buff;
<a name="__line3588"></a>        std::istringstream iss;
<a name="__line3589"></a>        if ( ! std::getline(input, linebuff) )
<a name="__line3590"></a>        {
<a name="__line3591"></a>            warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3592"></a>            return 0;
<a name="__line3593"></a>        }
<a name="__line3594"></a>        iss.str(linebuff);
<a name="__line3595"></a>        int d;
<a name="__line3596"></a>        if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;d) )
<a name="__line3597"></a>        {
<a name="__line3598"></a>            warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3599"></a>            return 0;
<a name="__line3600"></a>        }
<a name="__line3601"></a>        iss.str("");
<a name="__line3602"></a>        iss.clear();
<a name="__line3603"></a>        double dbegindend;
<a name="__line3604"></a>        int dbins;
<a name="__line3605"></a>        for ( int j=0 ; j&lt;d ; ++j )
<a name="__line3606"></a>        {
<a name="__line3607"></a>            if ( ! std::getline(input, linebuff) )
<a name="__line3608"></a>            {
<a name="__line3609"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3610"></a>                return 0;
<a name="__line3611"></a>            }
<a name="__line3612"></a>            iss.str(linebuff);
<a name="__line3613"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dbegindend) )
<a name="__line3614"></a>            {
<a name="__line3615"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3616"></a>                return 0;
<a name="__line3617"></a>            }
<a name="__line3618"></a>            iss.str("");
<a name="__line3619"></a>            iss.clear();
<a name="__line3620"></a>            if ( ! std::getline(input, linebuff) )
<a name="__line3621"></a>            {
<a name="__line3622"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3623"></a>                return 0;
<a name="__line3624"></a>            }
<a name="__line3625"></a>            iss.str(linebuff);
<a name="__line3626"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dbegindend) )
<a name="__line3627"></a>            {
<a name="__line3628"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3629"></a>                return 0;
<a name="__line3630"></a>            }
<a name="__line3631"></a>            iss.str("");
<a name="__line3632"></a>            iss.clear();
<a name="__line3633"></a>            if ( ! std::getline(input, linebuff) )
<a name="__line3634"></a>            {
<a name="__line3635"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3636"></a>                return 0;
<a name="__line3637"></a>            }
<a name="__line3638"></a>            iss.str(linebuff);
<a name="__line3639"></a>            if ( !(iss&gt;&gt;buff&gt;&gt;buff&gt;&gt;dbins) )
<a name="__line3640"></a>            {
<a name="__line3641"></a>                warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3642"></a>                return 0;
<a name="__line3643"></a>            }
<a name="__line3644"></a>            iss.str("");
<a name="__line3645"></a>            iss.clear();
<a name="__line3646"></a>        }
<a name="__line3647"></a>        if ( ! std::getline(input, linebuff) )
<a name="__line3648"></a>        {
<a name="__line3649"></a>            warning::print("Could not read number of histograms!", "unsigned int hist::read_many::numhists(const var&amp;)");
<a name="__line3650"></a>            return 0;
<a name="__line3651"></a>        }
<a name="__line3652"></a>        int beginmarker=0;
<a name="__line3653"></a>        int endmarker=0;
<a name="__line3654"></a>        int nHist=0;
<a name="__line3655"></a>        for ( unsigned int l=0 ; l&lt;linebuff.length() ; ++l )
<a name="__line3656"></a>        {
<a name="__line3657"></a>            if ( linebuff[l]=='`' )
<a name="__line3658"></a>            {
<a name="__line3659"></a>                if ( endmarker==beginmarker ) { beginmarker=l; endmarker=l+1; }
<a name="__line3660"></a>                else { endmarker=l; ++nHist; endmarker=beginmarker; }
<a name="__line3661"></a>            }
<a name="__line3662"></a>        }
<a name="__line3663"></a>        return nHist;
<a name="__line3664"></a>    }
<a name="__line3665"></a>
<a name="__line3666"></a>
<a name="__line3667"></a>    int hist::read_many::numhists(const var &amp;datafilename)
<a name="__line3668"></a>    {
<a name="__line3669"></a>        int nhists;
<a name="__line3670"></a>        istream *input=openin(datafilename);
<a name="__line3671"></a>        nhists=numhists(*input);
<a name="__line3672"></a>        delete input;
<a name="__line3673"></a>        return nhists;
<a name="__line3674"></a>    }
<a name="__line3675"></a>
<a name="__line3676"></a>
<a name="__line3677"></a>    hist&amp; hist::read(istream &amp;input, int number_of_histo)
<a name="__line3678"></a>    {
<a name="__line3679"></a>        read_many(input)&gt;&gt;(*this)&gt;&gt;number_of_histo;
<a name="__line3680"></a>        return *this;
<a name="__line3681"></a>    }
<a name="__line3682"></a>
<a name="__line3683"></a>
<a name="__line3684"></a>    hist&amp; hist::read(const var &amp;datafilename, int number_of_histo)
<a name="__line3685"></a>    {
<a name="__line3686"></a>        read_many(datafilename)&gt;&gt;(*this)&gt;&gt;number_of_histo;
<a name="__line3687"></a>        return *this;
<a name="__line3688"></a>    }
<a name="__line3689"></a>
<a name="__line3690"></a>
<a name="__line3691"></a>    function hist::x_hint() const
<a name="__line3692"></a>    {
<a name="__line3693"></a>        return (dim_&gt;0 ? ARG(1) : function(unset));
<a name="__line3694"></a>    }
<a name="__line3695"></a>
<a name="__line3696"></a>
<a name="__line3697"></a>    function hist::dx_hint() const
<a name="__line3698"></a>    {
<a name="__line3699"></a>        return (dim_&gt;0 ? ARG(dim_+2) : function(unset));
<a name="__line3700"></a>    }
<a name="__line3701"></a>
<a name="__line3702"></a>
<a name="__line3703"></a>    function hist::x1_hint() const
<a name="__line3704"></a>    {
<a name="__line3705"></a>        return (dim_&gt;0 ? ARG(1)-ARG(dim_+2)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3706"></a>    }
<a name="__line3707"></a>
<a name="__line3708"></a>
<a name="__line3709"></a>    function hist::x2_hint() const
<a name="__line3710"></a>    {
<a name="__line3711"></a>        return (dim_&gt;0 ? ARG(1)+ARG(dim_+2)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3712"></a>    }
<a name="__line3713"></a>
<a name="__line3714"></a>
<a name="__line3715"></a>    function hist::y_hint() const
<a name="__line3716"></a>    {
<a name="__line3717"></a>        return (dim_&gt;0 ? ARG(2) : function(unset));
<a name="__line3718"></a>    }
<a name="__line3719"></a>
<a name="__line3720"></a>
<a name="__line3721"></a>    function hist::dy_hint() const
<a name="__line3722"></a>    {
<a name="__line3723"></a>        return (dim_&gt;0 ? ARG(dim_+3) : function(unset));
<a name="__line3724"></a>    }
<a name="__line3725"></a>
<a name="__line3726"></a>
<a name="__line3727"></a>    function hist::y1_hint() const
<a name="__line3728"></a>    {
<a name="__line3729"></a>        return (dim_&gt;0 ? ARG(2)-ARG(dim_+3)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3730"></a>    }
<a name="__line3731"></a>
<a name="__line3732"></a>
<a name="__line3733"></a>    function hist::y2_hint() const
<a name="__line3734"></a>    {
<a name="__line3735"></a>        return (dim_&gt;0 ? ARG(2)+ARG(dim_+3)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3736"></a>    }
<a name="__line3737"></a>
<a name="__line3738"></a>
<a name="__line3739"></a>    function hist::z_hint() const
<a name="__line3740"></a>    {
<a name="__line3741"></a>        return (dim_&gt;1 ? ARG(3) : function(unset));
<a name="__line3742"></a>    }
<a name="__line3743"></a>
<a name="__line3744"></a>
<a name="__line3745"></a>    function hist::dz_hint() const
<a name="__line3746"></a>    {
<a name="__line3747"></a>        return (dim_&gt;1 ? ARG(dim_+4) : function(unset));
<a name="__line3748"></a>    }
<a name="__line3749"></a>
<a name="__line3750"></a>
<a name="__line3751"></a>    function hist::z1_hint() const
<a name="__line3752"></a>    {
<a name="__line3753"></a>        return (dim_&gt;1 ? ARG(3)-ARG(dim_+4)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3754"></a>    }
<a name="__line3755"></a>
<a name="__line3756"></a>
<a name="__line3757"></a>    function hist::z2_hint() const
<a name="__line3758"></a>    {
<a name="__line3759"></a>        return (dim_&gt;1 ? ARG(3)+ARG(dim_+4)/2 : function(unset)); <span class=comment>// added the /2 D.B.</span>
<a name="__line3760"></a>    }
<a name="__line3761"></a>
<a name="__line3762"></a>
<a name="__line3763"></a>
<a name="__line3764"></a>
<a name="__line3765"></a>    const datapoint* hist::get(int i) const
<a name="__line3766"></a>    {
<a name="__line3767"></a>        if(!buffer_.empty()) flush_buffer();
<a name="__line3768"></a>        bool skip;
<a name="__line3769"></a>        int iprime=sequence_[i];
<a name="__line3770"></a>        int j;
<a name="__line3771"></a>        skip=false;
<a name="__line3772"></a>        ind_[dim_-1]=iprime;
<a name="__line3773"></a>        for ( j=dim_-1 ; j&gt;=0 ; --j )
<a name="__line3774"></a>        {
<a name="__line3775"></a>            if ( m_[iprime*dim_+j]==0 ) { skip=true; break; }
<a name="__line3776"></a>            if ( j&lt;dim_-1 ) ind_[j]=ind_[j+1]/bins_[j+1];
<a name="__line3777"></a>        }
<a name="__line3778"></a>        if ( skip==true )
<a name="__line3779"></a>        {
<a name="__line3780"></a>            warning::print("Index inconsistency!", "datapoint* hist::get(const int) const");
<a name="__line3781"></a>            return &amp;datapoint_;
<a name="__line3782"></a>        }
<a name="__line3783"></a>        for ( j=0 ; j&lt;dim_ ; ++j )
<a name="__line3784"></a>        {
<a name="__line3785"></a>            ind_[j]=ind_[j]%bins_[j];
<a name="__line3786"></a>            datapoint_[j]=min_[j]+(ind_[j]+0.5*m_[iprime*dim_+j])*binsize_[j];
<a name="__line3787"></a>            datapoint_[dim_+1+j]=binsize_[j]*m_[iprime*dim_+j]; <span class=comment>// removed a 0.5 factor! D.B.</span>
<a name="__line3788"></a>        }
<a name="__line3789"></a>        datapoint_[dim_]=h_[iprime].v;
<a name="__line3790"></a>        datapoint_[2*dim_+1]=h_[iprime].e;
<a name="__line3791"></a>        return &amp;datapoint_;
<a name="__line3792"></a>    }
<a name="__line3793"></a>
<a name="__line3794"></a>
<a name="__line3795"></a>    hist::size_type hist::size() const
<a name="__line3796"></a>    {
<a name="__line3797"></a>        return sequence_.size();
<a name="__line3798"></a>    }
<a name="__line3799"></a>
<a name="__line3800"></a>
<a name="__line3801"></a>    double hist::max(int j) const
<a name="__line3802"></a>    {
<a name="__line3803"></a>        if ( j==0 )
<a name="__line3804"></a>        {
<a name="__line3805"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::max(const int) const");
<a name="__line3806"></a>            return unset;
<a name="__line3807"></a>        }
<a name="__line3808"></a>        else if ( j&lt;=dim_ ) return max_[j-1];
<a name="__line3809"></a>        else if ( j==dim_+1 )
<a name="__line3810"></a>        {
<a name="__line3811"></a>            double v=0.0, vmax=unset;
<a name="__line3812"></a>            bool firstflag=true;
<a name="__line3813"></a>            unsigned int i, iprime;
<a name="__line3814"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3815"></a>            {
<a name="__line3816"></a>                iprime=sequence_[i];
<a name="__line3817"></a>                if ( std::isfinite(h_[iprime].v)==0 ) continue;
<a name="__line3818"></a>                if ( h_[iprime].v==unset ) continue;
<a name="__line3819"></a>                v=h_[iprime].v;
<a name="__line3820"></a>                if ( firstflag==true ) { vmax=v; firstflag=false; }
<a name="__line3821"></a>                if ( v&gt;vmax ) vmax=v;
<a name="__line3822"></a>            }
<a name="__line3823"></a>            return vmax;
<a name="__line3824"></a>        }
<a name="__line3825"></a>        else if ( j&lt;=dim_*2+1 )
<a name="__line3826"></a>        {
<a name="__line3827"></a>            double d=0.0, dmax=0.0;
<a name="__line3828"></a>            unsigned int i=0, iprime=0;
<a name="__line3829"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3830"></a>            {
<a name="__line3831"></a>                iprime=sequence_[i];
<a name="__line3832"></a>                d=0.5*binsize_[j-dim_-2]*m_[iprime*dim_+(j-dim_-2)];
<a name="__line3833"></a>                if ( i==0 ) dmax=d;
<a name="__line3834"></a>                if ( d&gt;dmax ) dmax=d;
<a name="__line3835"></a>            }
<a name="__line3836"></a>            return dmax;
<a name="__line3837"></a>        }
<a name="__line3838"></a>        else if ( j==dim_*2+2 )
<a name="__line3839"></a>        {
<a name="__line3840"></a>            double e=0.0, emax=unset;
<a name="__line3841"></a>            bool firstflag=true;
<a name="__line3842"></a>            unsigned int i=0, iprime=0;
<a name="__line3843"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3844"></a>            {
<a name="__line3845"></a>                iprime=sequence_[i];
<a name="__line3846"></a>                if ( std::isfinite(h_[iprime].e)==0 ) continue;
<a name="__line3847"></a>                if ( h_[iprime].e==unset ) continue;
<a name="__line3848"></a>                e=h_[iprime].e;
<a name="__line3849"></a>                if ( firstflag==true ) { emax=e; firstflag=false; }
<a name="__line3850"></a>                if ( e&gt;emax ) emax=e;
<a name="__line3851"></a>            }
<a name="__line3852"></a>            return emax;
<a name="__line3853"></a>        }
<a name="__line3854"></a>        else 
<a name="__line3855"></a>        {
<a name="__line3856"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::max(const int) const");
<a name="__line3857"></a>        }
<a name="__line3858"></a>        return unset;
<a name="__line3859"></a>    }
<a name="__line3860"></a>
<a name="__line3861"></a>
<a name="__line3862"></a>    var hist::max(const function &amp;f, function fret) const
<a name="__line3863"></a>    {
<a name="__line3864"></a>        const bool return_different = fret.initialized();
<a name="__line3865"></a>        if(!fret.initialized()) fret = f;
<a name="__line3866"></a>        int j=0;
<a name="__line3867"></a>        for ( int jtmp=1 ; jtmp&lt;=dim_ ; ++jtmp )
<a name="__line3868"></a>        {
<a name="__line3869"></a>            if ( f.equals(ARG(jtmp)) ) { j=jtmp; break; }
<a name="__line3870"></a>        }
<a name="__line3871"></a>        if ( j==0 )
<a name="__line3872"></a>        {
<a name="__line3873"></a>            double max_val=unset;
<a name="__line3874"></a>            var    max_pos="";
<a name="__line3875"></a>            for ( unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3876"></a>            {
<a name="__line3877"></a>                const double v=f.eval_dbl(*get(i));
<a name="__line3878"></a>                if ( i==0 || v&gt;max_val )
<a name="__line3879"></a>                {
<a name="__line3880"></a>                    max_val = v;
<a name="__line3881"></a>                    max_pos = fret.eval(*get(i));
<a name="__line3882"></a>                }
<a name="__line3883"></a>            }
<a name="__line3884"></a>            return max_pos;
<a name="__line3885"></a>        }
<a name="__line3886"></a>        else if ( j&lt;=dim_ )
<a name="__line3887"></a>        {
<a name="__line3888"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::max(const function &amp;f, function)");
<a name="__line3889"></a>            return max_[j-1];
<a name="__line3890"></a>        }
<a name="__line3891"></a>        else if ( j==dim_+1 )
<a name="__line3892"></a>        {
<a name="__line3893"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::max(const function &amp;f, function)");
<a name="__line3894"></a>            double v=0.0, vmax=unset;
<a name="__line3895"></a>            bool firstflag=true;
<a name="__line3896"></a>            unsigned int i, iprime;
<a name="__line3897"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3898"></a>            {
<a name="__line3899"></a>                iprime=sequence_[i];
<a name="__line3900"></a>                if ( std::isfinite(h_[iprime].v)==0 ) continue;
<a name="__line3901"></a>                if ( h_[iprime].v==unset ) continue;
<a name="__line3902"></a>                v=h_[iprime].v;
<a name="__line3903"></a>                if ( firstflag==true ) { vmax=v; firstflag=false; }
<a name="__line3904"></a>                if ( v&gt;vmax ) vmax=v;
<a name="__line3905"></a>            }
<a name="__line3906"></a>            return vmax;
<a name="__line3907"></a>        }
<a name="__line3908"></a>        else if ( j&lt;=dim_*2+1 )
<a name="__line3909"></a>        {
<a name="__line3910"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::max(const function &amp;f, function)");
<a name="__line3911"></a>            double d=0.0, dmax=0.0;
<a name="__line3912"></a>            unsigned int i=0, iprime=0;
<a name="__line3913"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3914"></a>            {
<a name="__line3915"></a>                iprime=sequence_[i];
<a name="__line3916"></a>                d=0.5*binsize_[j-dim_-2]*m_[iprime*dim_+(j-dim_-2)];
<a name="__line3917"></a>                if ( i==0 ) dmax=d;
<a name="__line3918"></a>                if ( d&gt;dmax ) dmax=d;
<a name="__line3919"></a>            }
<a name="__line3920"></a>            return dmax;
<a name="__line3921"></a>        }
<a name="__line3922"></a>        else if ( j==dim_*2+2 )
<a name="__line3923"></a>        {
<a name="__line3924"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::max(const function &amp;f, function)");
<a name="__line3925"></a>            double e=0.0, emax=unset;
<a name="__line3926"></a>            bool firstflag=true;
<a name="__line3927"></a>            unsigned int i=0, iprime=0;
<a name="__line3928"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3929"></a>            {
<a name="__line3930"></a>                iprime=sequence_[i];
<a name="__line3931"></a>                if ( std::isfinite(h_[iprime].e)==0 ) continue;
<a name="__line3932"></a>                if ( h_[iprime].e==unset ) continue;
<a name="__line3933"></a>                e=h_[iprime].e;
<a name="__line3934"></a>                if ( firstflag==true ) { emax=e; firstflag=false; }
<a name="__line3935"></a>                if ( e&gt;emax ) emax=e;
<a name="__line3936"></a>            }
<a name="__line3937"></a>            return emax;
<a name="__line3938"></a>        }
<a name="__line3939"></a>        else 
<a name="__line3940"></a>        {
<a name="__line3941"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::max(const int) const");
<a name="__line3942"></a>        }
<a name="__line3943"></a>        return unset;
<a name="__line3944"></a>    }
<a name="__line3945"></a>
<a name="__line3946"></a>
<a name="__line3947"></a>    double hist::min(int j) const
<a name="__line3948"></a>    {
<a name="__line3949"></a>        if ( j==0 )
<a name="__line3950"></a>        {
<a name="__line3951"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::min(const int) const");
<a name="__line3952"></a>            return unset;
<a name="__line3953"></a>        }
<a name="__line3954"></a>        else if ( j&lt;=dim_ ) return min_[j-1];
<a name="__line3955"></a>        else if ( j==dim_+1 )
<a name="__line3956"></a>        {
<a name="__line3957"></a>            double v=0.0, vmin=unset;
<a name="__line3958"></a>            bool firstflag=true;
<a name="__line3959"></a>            unsigned int i=0, iprime=0;
<a name="__line3960"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3961"></a>            {
<a name="__line3962"></a>                iprime=sequence_[i];
<a name="__line3963"></a>                if ( std::isfinite(h_[iprime].v)==0 ) continue;
<a name="__line3964"></a>                if ( h_[iprime].v==unset ) continue;
<a name="__line3965"></a>                v=h_[iprime].v;
<a name="__line3966"></a>                if ( firstflag==true ) { vmin=v; firstflag=false; }
<a name="__line3967"></a>                if ( vmin&lt;v ) vmin=v;
<a name="__line3968"></a>            }
<a name="__line3969"></a>            return vmin;
<a name="__line3970"></a>        }
<a name="__line3971"></a>        else if ( j&lt;=dim_*2+1 )
<a name="__line3972"></a>        {
<a name="__line3973"></a>            double d=0.0, dmin=0.0;
<a name="__line3974"></a>            unsigned int i=0, iprime=0;
<a name="__line3975"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3976"></a>            {
<a name="__line3977"></a>                iprime=sequence_[i];
<a name="__line3978"></a>                d=0.5*binsize_[j-dim_-2]*m_[iprime*dim_+(j-dim_-2)];
<a name="__line3979"></a>                if ( i==0 ) dmin=d;
<a name="__line3980"></a>                if ( d&gt;dmin ) dmin=d;
<a name="__line3981"></a>            }
<a name="__line3982"></a>            return dmin;
<a name="__line3983"></a>        }
<a name="__line3984"></a>        else if ( j==dim_*2+2 )
<a name="__line3985"></a>        {
<a name="__line3986"></a>            double e=0.0, emin=unset;
<a name="__line3987"></a>            bool firstflag=true;
<a name="__line3988"></a>            unsigned int i=0, iprime=0;
<a name="__line3989"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line3990"></a>            {
<a name="__line3991"></a>                iprime=sequence_[i];
<a name="__line3992"></a>                if ( std::isfinite(h_[iprime].e)==0 ) continue;
<a name="__line3993"></a>                if ( h_[iprime].e==unset ) continue;
<a name="__line3994"></a>                e=h_[iprime].e;
<a name="__line3995"></a>                if ( firstflag==true ) { emin=e; firstflag=false; }
<a name="__line3996"></a>                if ( e&gt;emin ) emin=e;
<a name="__line3997"></a>            }
<a name="__line3998"></a>            return emin;
<a name="__line3999"></a>        }
<a name="__line4000"></a>        else
<a name="__line4001"></a>        {
<a name="__line4002"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::min(const int) const");
<a name="__line4003"></a>        }
<a name="__line4004"></a>        return unset;
<a name="__line4005"></a>    }
<a name="__line4006"></a>
<a name="__line4007"></a>
<a name="__line4008"></a>    var hist::min(const function &amp;f, function fret) const
<a name="__line4009"></a>    {
<a name="__line4010"></a>        const bool return_different = fret.initialized();
<a name="__line4011"></a>        if(!fret.initialized()) fret = f;
<a name="__line4012"></a>        int j=0;
<a name="__line4013"></a>        for ( int jtmp=1; jtmp&lt;=dim_ ; ++jtmp )
<a name="__line4014"></a>        {
<a name="__line4015"></a>            if ( f.equals(ARG(jtmp)) ) { j=jtmp; break; }
<a name="__line4016"></a>        }
<a name="__line4017"></a>        if ( j==0 )
<a name="__line4018"></a>        {
<a name="__line4019"></a>            double min_val=unset;
<a name="__line4020"></a>            var    min_pos="";
<a name="__line4021"></a>            for (unsigned int i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line4022"></a>            {
<a name="__line4023"></a>                const double v=f.eval_dbl(*get(i));
<a name="__line4024"></a>                if ( i==0 || v&lt;min_val )
<a name="__line4025"></a>                {
<a name="__line4026"></a>                    min_val = v;
<a name="__line4027"></a>                    min_pos = fret.eval(*get(i));
<a name="__line4028"></a>                }
<a name="__line4029"></a>            }
<a name="__line4030"></a>            return min_pos;
<a name="__line4031"></a>        }
<a name="__line4032"></a>        else if ( j&lt;=dim_ )
<a name="__line4033"></a>        {
<a name="__line4034"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::min(const function &amp;f, function)");
<a name="__line4035"></a>            return min_[j-1];
<a name="__line4036"></a>        }
<a name="__line4037"></a>        else if ( j==dim_+1 )
<a name="__line4038"></a>        {
<a name="__line4039"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::min(const function &amp;f, function)");
<a name="__line4040"></a>            double v=0.0, vmin=unset;
<a name="__line4041"></a>            bool firstflag=true;
<a name="__line4042"></a>            unsigned int i=0, iprime=0;
<a name="__line4043"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line4044"></a>            {
<a name="__line4045"></a>                iprime=sequence_[i];
<a name="__line4046"></a>                if ( std::isfinite(h_[iprime].v)==0 ) continue;
<a name="__line4047"></a>                if ( h_[iprime].v==unset ) continue;
<a name="__line4048"></a>                v=h_[iprime].v;
<a name="__line4049"></a>                if ( firstflag==true ) { vmin=v; firstflag=false; }
<a name="__line4050"></a>                if ( vmin&lt;v ) vmin = v;
<a name="__line4051"></a>            }
<a name="__line4052"></a>            return vmin;
<a name="__line4053"></a>        }
<a name="__line4054"></a>        else if ( j&lt;=dim_*2+1 )
<a name="__line4055"></a>        {
<a name="__line4056"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::min(const function &amp;f, function)");
<a name="__line4057"></a>            double d=0.0, dmin=0.0;
<a name="__line4058"></a>            unsigned int i=0, iprime=0;
<a name="__line4059"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line4060"></a>            {
<a name="__line4061"></a>                iprime=sequence_[i];
<a name="__line4062"></a>                d=0.5*binsize_[j-dim_-2]*m_[iprime*dim_+(j-dim_-2)];
<a name="__line4063"></a>                if ( i==0 ) dmin=d;
<a name="__line4064"></a>                if ( d&gt;dmin ) dmin=d;
<a name="__line4065"></a>            }
<a name="__line4066"></a>            return dmin;
<a name="__line4067"></a>        }
<a name="__line4068"></a>        else if ( j==dim_*2+2 )
<a name="__line4069"></a>        {
<a name="__line4070"></a>            if(return_different) warning::print("Should update the code for returning the value of a different expression at the minimum","hist::min(const function &amp;f, function)");
<a name="__line4071"></a>            double e=0.0, emin=unset;
<a name="__line4072"></a>            bool firstflag=true;
<a name="__line4073"></a>            unsigned int i=0, iprime=0;
<a name="__line4074"></a>            for ( i=0 ; i&lt;sequence_.size() ; ++i )
<a name="__line4075"></a>            {
<a name="__line4076"></a>                iprime=sequence_[i];
<a name="__line4077"></a>                if ( std::isfinite(h_[iprime].e)==0 ) continue;
<a name="__line4078"></a>                if ( h_[iprime].e==unset ) continue;
<a name="__line4079"></a>                e=h_[iprime].e;
<a name="__line4080"></a>                if ( firstflag==true ) { emin=e; firstflag=false; }
<a name="__line4081"></a>                if ( e&gt;emin ) emin=e;
<a name="__line4082"></a>            }
<a name="__line4083"></a>            return emin;
<a name="__line4084"></a>        }
<a name="__line4085"></a>        else
<a name="__line4086"></a>        {
<a name="__line4087"></a>            warning::print("Index out of range! (1-based indices!!!)", "double hist::min(const int) const");
<a name="__line4088"></a>        }
<a name="__line4089"></a>        return unset;
<a name="__line4090"></a>    }
<a name="__line4091"></a>
<a name="__line4092"></a>
<a name="__line4093"></a>    int hist::columns() const
<a name="__line4094"></a>    {
<a name="__line4095"></a>        return dim_*2+2;
<a name="__line4096"></a>    }
<a name="__line4097"></a>
<a name="__line4098"></a>    void hist::prepare_for_draw(axis *,axis *, frame *f, int count)
<a name="__line4099"></a>    {
<a name="__line4100"></a>        flush_buffer();
<a name="__line4101"></a>        if ( dim_&lt;1 || dim_&gt;2 ) warning::print("Only can draw 1 or 2 dimensional histograms!", "void hist::prepare_for_draw(axis*, axis*, frame*)");
<a name="__line4102"></a>        if ( graph_drawer_ ) graph_drawer_-&gt;prepare_for_draw(this, f, count);
<a name="__line4103"></a>    }
<a name="__line4104"></a>
<a name="__line4105"></a>
<a name="__line4106"></a>    dgraph hist::to_dgraph() const
<a name="__line4107"></a>    {
<a name="__line4108"></a>        dgraph result;
<a name="__line4109"></a>        for ( unsigned int i=0 ; i&lt;size() ; ++i ) result.add(*get(i));
<a name="__line4110"></a>        result.copy_style(*this);
<a name="__line4111"></a>        return result;
<a name="__line4112"></a>    }
<a name="__line4113"></a>
<a name="__line4114"></a>
<a name="__line4115"></a>    hist::qplot::qplot(mpps &amp;bm)
<a name="__line4116"></a>        : blopMpps_(&amp;bm), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4117"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4118"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(false), isFlushed_(false)
<a name="__line4119"></a>    {
<a name="__line4120"></a>    }
<a name="__line4121"></a>
<a name="__line4122"></a>
<a name="__line4123"></a>    hist::qplot::qplot(const var &amp;blopepsname)
<a name="__line4124"></a>        : blopMpps_(NULL), blopEpsName_(blopepsname), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4125"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4126"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(false), isFlushed_(false)
<a name="__line4127"></a>    {
<a name="__line4128"></a>    }
<a name="__line4129"></a>
<a name="__line4130"></a>
<a name="__line4131"></a>    hist::qplot::qplot()
<a name="__line4132"></a>        : blopMpps_(NULL), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4133"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4134"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(false), isFlushed_(false)
<a name="__line4135"></a>    {
<a name="__line4136"></a>    }
<a name="__line4137"></a>
<a name="__line4138"></a>
<a name="__line4139"></a>    hist::qplot::qplot(mpps &amp;bm, hist &amp;h1, hist &amp;h2)
<a name="__line4140"></a>        : blopMpps_(&amp;bm), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4141"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4142"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4143"></a>    {
<a name="__line4144"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4145"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4146"></a>    }
<a name="__line4147"></a>
<a name="__line4148"></a>
<a name="__line4149"></a>    hist::qplot::qplot(const var &amp;blopepsname, hist &amp;h1, hist &amp;h2)
<a name="__line4150"></a>        : blopMpps_(NULL), blopEpsName_(blopepsname), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4151"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4152"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4153"></a>    {
<a name="__line4154"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4155"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4156"></a>    }
<a name="__line4157"></a>
<a name="__line4158"></a>
<a name="__line4159"></a>    hist::qplot::qplot(hist &amp;h1, hist &amp;h2)
<a name="__line4160"></a>        : blopMpps_(NULL), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4161"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4162"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4163"></a>    {
<a name="__line4164"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4165"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4166"></a>    }
<a name="__line4167"></a>
<a name="__line4168"></a>
<a name="__line4169"></a>    hist::qplot::qplot(mpps &amp;bm, hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4170"></a>        : blopMpps_(&amp;bm), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4171"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4172"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4173"></a>    {
<a name="__line4174"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4175"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4176"></a>    }
<a name="__line4177"></a>
<a name="__line4178"></a>
<a name="__line4179"></a>    hist::qplot::qplot(const var &amp;blopepsname, hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4180"></a>        : blopMpps_(NULL), blopEpsName_(blopepsname), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4181"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4182"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4183"></a>    {
<a name="__line4184"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4185"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4186"></a>    }
<a name="__line4187"></a>
<a name="__line4188"></a>
<a name="__line4189"></a>    hist::qplot::qplot(hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4190"></a>        : blopMpps_(NULL), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4191"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4192"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4193"></a>    {
<a name="__line4194"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4195"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4196"></a>    }
<a name="__line4197"></a>
<a name="__line4198"></a>
<a name="__line4199"></a>    hist::qplot::qplot(mpps &amp;bm, const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4200"></a>        : blopMpps_(&amp;bm), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4201"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4202"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4203"></a>    {
<a name="__line4204"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4205"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4206"></a>    }
<a name="__line4207"></a>
<a name="__line4208"></a>
<a name="__line4209"></a>    hist::qplot::qplot(const var &amp;blopepsname, const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4210"></a>        : blopMpps_(NULL), blopEpsName_(blopepsname), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4211"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4212"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4213"></a>    {
<a name="__line4214"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4215"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4216"></a>    }
<a name="__line4217"></a>
<a name="__line4218"></a>
<a name="__line4219"></a>    hist::qplot::qplot(const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4220"></a>        : blopMpps_(NULL), globaltitle_("__NULL"), rangemin_(false, 0.0), rangemax_(false, 0.0), 
<a name="__line4221"></a>          isomin_(false, 0.0), isomax_(false, 0.0), 
<a name="__line4222"></a>          rangelog_(false, false), isolog_(false, false), doubleplot_(true), isFlushed_(false)
<a name="__line4223"></a>    {
<a name="__line4224"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4225"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4226"></a>    }
<a name="__line4227"></a>
<a name="__line4228"></a>
<a name="__line4229"></a>    hist::qplot&amp; hist::qplot::reinit(mpps &amp;bm)
<a name="__line4230"></a>    {
<a name="__line4231"></a>        blopMpps_=&amp;bm;
<a name="__line4232"></a>        blopEpsName_="";
<a name="__line4233"></a>        globaltitle_="__NULL";
<a name="__line4234"></a>        min_.clear();
<a name="__line4235"></a>        max_.clear();
<a name="__line4236"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4237"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4238"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4239"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4240"></a>        log_.clear();
<a name="__line4241"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4242"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4243"></a>        oStuff_.clear();
<a name="__line4244"></a>        doubleplot_=false;
<a name="__line4245"></a>        isFlushed_=false;
<a name="__line4246"></a>        return *this;
<a name="__line4247"></a>    }
<a name="__line4248"></a>
<a name="__line4249"></a>
<a name="__line4250"></a>    hist::qplot&amp; hist::qplot::reinit(const var &amp;blopepsname)
<a name="__line4251"></a>    {
<a name="__line4252"></a>        blopMpps_=NULL;
<a name="__line4253"></a>        blopEpsName_=blopepsname;
<a name="__line4254"></a>        globaltitle_="__NULL";
<a name="__line4255"></a>        min_.clear();
<a name="__line4256"></a>        max_.clear();
<a name="__line4257"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4258"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4259"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4260"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4261"></a>        log_.clear();
<a name="__line4262"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4263"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4264"></a>        oStuff_.clear();
<a name="__line4265"></a>        doubleplot_=false;
<a name="__line4266"></a>        isFlushed_=false;
<a name="__line4267"></a>        return *this;
<a name="__line4268"></a>    }
<a name="__line4269"></a>
<a name="__line4270"></a>
<a name="__line4271"></a>    hist::qplot&amp; hist::qplot::reinit()
<a name="__line4272"></a>    {
<a name="__line4273"></a>        blopMpps_=NULL;
<a name="__line4274"></a>        blopEpsName_="";
<a name="__line4275"></a>        globaltitle_="__NULL";
<a name="__line4276"></a>        min_.clear();
<a name="__line4277"></a>        max_.clear();
<a name="__line4278"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4279"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4280"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4281"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4282"></a>        log_.clear();
<a name="__line4283"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4284"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4285"></a>        oStuff_.clear();
<a name="__line4286"></a>        doubleplot_=false;
<a name="__line4287"></a>        isFlushed_=false;
<a name="__line4288"></a>        return *this;
<a name="__line4289"></a>    }
<a name="__line4290"></a>
<a name="__line4291"></a>
<a name="__line4292"></a>    hist::qplot&amp; hist::qplot::reinit(mpps &amp;bm, hist &amp;h1, hist &amp;h2)
<a name="__line4293"></a>    {
<a name="__line4294"></a>        blopMpps_=&amp;bm;
<a name="__line4295"></a>        blopEpsName_="";
<a name="__line4296"></a>        globaltitle_="__NULL";
<a name="__line4297"></a>        min_.clear();
<a name="__line4298"></a>        max_.clear();
<a name="__line4299"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4300"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4301"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4302"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4303"></a>        log_.clear();
<a name="__line4304"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4305"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4306"></a>        oStuff_.clear();
<a name="__line4307"></a>        doubleplot_=true;
<a name="__line4308"></a>        isFlushed_=false;
<a name="__line4309"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4310"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4311"></a>        return *this;
<a name="__line4312"></a>    }
<a name="__line4313"></a>
<a name="__line4314"></a>
<a name="__line4315"></a>    hist::qplot&amp; hist::qplot::reinit(const var &amp;blopepsname, hist &amp;h1, hist &amp;h2)
<a name="__line4316"></a>    {
<a name="__line4317"></a>        blopMpps_=NULL;
<a name="__line4318"></a>        blopEpsName_=blopepsname;
<a name="__line4319"></a>        globaltitle_="__NULL";
<a name="__line4320"></a>        min_.clear();
<a name="__line4321"></a>        max_.clear();
<a name="__line4322"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4323"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4324"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4325"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4326"></a>        log_.clear();
<a name="__line4327"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4328"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4329"></a>        oStuff_.clear();
<a name="__line4330"></a>        doubleplot_=true;
<a name="__line4331"></a>        isFlushed_=false;
<a name="__line4332"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4333"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4334"></a>        return *this;
<a name="__line4335"></a>    }
<a name="__line4336"></a>
<a name="__line4337"></a>
<a name="__line4338"></a>    hist::qplot&amp; hist::qplot::reinit(hist &amp;h1, hist &amp;h2)
<a name="__line4339"></a>    {
<a name="__line4340"></a>        blopMpps_=NULL;
<a name="__line4341"></a>        blopEpsName_="";
<a name="__line4342"></a>        globaltitle_="__NULL";
<a name="__line4343"></a>        min_.clear();
<a name="__line4344"></a>        max_.clear();
<a name="__line4345"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4346"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4347"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4348"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4349"></a>        log_.clear();
<a name="__line4350"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4351"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4352"></a>        oStuff_.clear();
<a name="__line4353"></a>        doubleplot_=true;
<a name="__line4354"></a>        isFlushed_=false;
<a name="__line4355"></a>        oStuff_.push_back(oStuff_t(&amp;h1, unset, "__NULL"));
<a name="__line4356"></a>        oStuff_.push_back(oStuff_t(&amp;h2, unset, "__NULL"));
<a name="__line4357"></a>        return *this;
<a name="__line4358"></a>    }
<a name="__line4359"></a>
<a name="__line4360"></a>
<a name="__line4361"></a>    hist::qplot&amp; hist::qplot::reinit(mpps &amp;bm, hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4362"></a>    {
<a name="__line4363"></a>        blopMpps_=&amp;bm;
<a name="__line4364"></a>        blopEpsName_="";
<a name="__line4365"></a>        globaltitle_="__NULL";
<a name="__line4366"></a>        min_.clear();
<a name="__line4367"></a>        max_.clear();
<a name="__line4368"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4369"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4370"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4371"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4372"></a>        log_.clear();
<a name="__line4373"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4374"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4375"></a>        oStuff_.clear();
<a name="__line4376"></a>        doubleplot_=true;
<a name="__line4377"></a>        isFlushed_=false;
<a name="__line4378"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4379"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4380"></a>        return *this;
<a name="__line4381"></a>    }
<a name="__line4382"></a>
<a name="__line4383"></a>
<a name="__line4384"></a>    hist::qplot&amp; hist::qplot::reinit(const var &amp;blopepsname, hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4385"></a>    {
<a name="__line4386"></a>        blopMpps_=NULL;
<a name="__line4387"></a>        blopEpsName_=blopepsname;
<a name="__line4388"></a>        globaltitle_="__NULL";
<a name="__line4389"></a>        min_.clear();
<a name="__line4390"></a>        max_.clear();
<a name="__line4391"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4392"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4393"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4394"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4395"></a>        log_.clear();
<a name="__line4396"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4397"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4398"></a>        oStuff_.clear();
<a name="__line4399"></a>        doubleplot_=true;
<a name="__line4400"></a>        isFlushed_=false;
<a name="__line4401"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4402"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4403"></a>        return *this;
<a name="__line4404"></a>    }
<a name="__line4405"></a>
<a name="__line4406"></a>
<a name="__line4407"></a>    hist::qplot&amp; hist::qplot::reinit(hist &amp;h, const function &amp;f, const var &amp;legend)
<a name="__line4408"></a>    {
<a name="__line4409"></a>        blopMpps_=NULL;
<a name="__line4410"></a>        blopEpsName_="";
<a name="__line4411"></a>        globaltitle_="__NULL";
<a name="__line4412"></a>        min_.clear();
<a name="__line4413"></a>        max_.clear();
<a name="__line4414"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4415"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4416"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4417"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4418"></a>        log_.clear();
<a name="__line4419"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4420"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4421"></a>        oStuff_.clear();
<a name="__line4422"></a>        doubleplot_=true;
<a name="__line4423"></a>        isFlushed_=false;
<a name="__line4424"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4425"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4426"></a>        return *this;
<a name="__line4427"></a>    }
<a name="__line4428"></a>
<a name="__line4429"></a>
<a name="__line4430"></a>    hist::qplot&amp; hist::qplot::reinit(mpps &amp;bm, const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4431"></a>    {
<a name="__line4432"></a>        blopMpps_=&amp;bm;
<a name="__line4433"></a>        blopEpsName_="";
<a name="__line4434"></a>        globaltitle_="__NULL";
<a name="__line4435"></a>        min_.clear();
<a name="__line4436"></a>        max_.clear();
<a name="__line4437"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4438"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4439"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4440"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4441"></a>        log_.clear();
<a name="__line4442"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4443"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4444"></a>        oStuff_.clear();
<a name="__line4445"></a>        doubleplot_=true;
<a name="__line4446"></a>        isFlushed_=false;
<a name="__line4447"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4448"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4449"></a>        return *this;
<a name="__line4450"></a>    }
<a name="__line4451"></a>
<a name="__line4452"></a>
<a name="__line4453"></a>    hist::qplot&amp; hist::qplot::reinit(const var &amp;blopepsname, const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4454"></a>    {
<a name="__line4455"></a>        blopMpps_=NULL;
<a name="__line4456"></a>        blopEpsName_=blopepsname;
<a name="__line4457"></a>        globaltitle_="__NULL";
<a name="__line4458"></a>        min_.clear();
<a name="__line4459"></a>        max_.clear();
<a name="__line4460"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4461"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4462"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4463"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4464"></a>        log_.clear();
<a name="__line4465"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4466"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4467"></a>        oStuff_.clear();
<a name="__line4468"></a>        doubleplot_=true;
<a name="__line4469"></a>        isFlushed_=false;
<a name="__line4470"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4471"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4472"></a>        return *this;
<a name="__line4473"></a>    }
<a name="__line4474"></a>
<a name="__line4475"></a>
<a name="__line4476"></a>    hist::qplot&amp; hist::qplot::reinit(const function &amp;f1, const function &amp;f2, const var &amp;legend1, const var &amp;legend2)
<a name="__line4477"></a>    {
<a name="__line4478"></a>        blopMpps_=NULL;
<a name="__line4479"></a>        blopEpsName_="";
<a name="__line4480"></a>        globaltitle_="__NULL";
<a name="__line4481"></a>        min_.clear();
<a name="__line4482"></a>        max_.clear();
<a name="__line4483"></a>        rangemin_.first=false; rangemin_.second=0.0;
<a name="__line4484"></a>        rangemax_.first=false; rangemax_.second=0.0;
<a name="__line4485"></a>        isomin_.first=false; isomin_.second=0.0;
<a name="__line4486"></a>        isomax_.first=false; isomax_.second=0.0;
<a name="__line4487"></a>        log_.clear();
<a name="__line4488"></a>        rangelog_.first=false; rangelog_.second=false;
<a name="__line4489"></a>        isolog_.first=false; isolog_.second=false;
<a name="__line4490"></a>        oStuff_.clear();
<a name="__line4491"></a>        doubleplot_=true;
<a name="__line4492"></a>        isFlushed_=false;
<a name="__line4493"></a>        oStuff_.push_back(oStuff_t(NULL, f1, legend1));
<a name="__line4494"></a>        oStuff_.push_back(oStuff_t(NULL, f2, legend2));
<a name="__line4495"></a>        return *this;
<a name="__line4496"></a>    }
<a name="__line4497"></a>
<a name="__line4498"></a>
<a name="__line4499"></a>    hist::qplot&amp; hist::qplot::title(const var &amp;globaltitle)
<a name="__line4500"></a>    {
<a name="__line4501"></a>        globaltitle_=globaltitle;
<a name="__line4502"></a>        isFlushed_=false;
<a name="__line4503"></a>        return *this;
<a name="__line4504"></a>    }
<a name="__line4505"></a>
<a name="__line4506"></a>
<a name="__line4507"></a>    hist::qplot&amp; hist::qplot::min(const int axis, const double value)
<a name="__line4508"></a>    {
<a name="__line4509"></a>        min_.push_back(std::pair&lt;int, double&gt;(axis, value));
<a name="__line4510"></a>        isFlushed_=false;
<a name="__line4511"></a>        return *this;
<a name="__line4512"></a>    }
<a name="__line4513"></a>
<a name="__line4514"></a>
<a name="__line4515"></a>    hist::qplot&amp; hist::qplot::max(const int axis, const double value)
<a name="__line4516"></a>    {
<a name="__line4517"></a>        max_.push_back(std::pair&lt;int, double&gt;(axis, value));
<a name="__line4518"></a>        isFlushed_=false;
<a name="__line4519"></a>        return *this;
<a name="__line4520"></a>    }
<a name="__line4521"></a>
<a name="__line4522"></a>
<a name="__line4523"></a>    hist::qplot&amp; hist::qplot::rangemin(const double value)
<a name="__line4524"></a>    {
<a name="__line4525"></a>        rangemin_.first=true; rangemin_.second=value;
<a name="__line4526"></a>        isFlushed_=false;
<a name="__line4527"></a>        return *this;
<a name="__line4528"></a>    }
<a name="__line4529"></a>
<a name="__line4530"></a>
<a name="__line4531"></a>    hist::qplot&amp; hist::qplot::rangemax(const double value)
<a name="__line4532"></a>    {
<a name="__line4533"></a>        rangemax_.first=true; rangemax_.second=value;
<a name="__line4534"></a>        isFlushed_=false;
<a name="__line4535"></a>        return *this;
<a name="__line4536"></a>    }
<a name="__line4537"></a>
<a name="__line4538"></a>
<a name="__line4539"></a>    hist::qplot&amp; hist::qplot::isomin(const double value)
<a name="__line4540"></a>    {
<a name="__line4541"></a>        isomin_.first=true; isomin_.second=value;
<a name="__line4542"></a>        isFlushed_=false;
<a name="__line4543"></a>        return *this;
<a name="__line4544"></a>    }
<a name="__line4545"></a>
<a name="__line4546"></a>
<a name="__line4547"></a>    hist::qplot&amp; hist::qplot::isomax(const double value)
<a name="__line4548"></a>    {
<a name="__line4549"></a>        isomax_.first=true; isomax_.second=value;
<a name="__line4550"></a>        isFlushed_=false;
<a name="__line4551"></a>        return *this;
<a name="__line4552"></a>    }
<a name="__line4553"></a>
<a name="__line4554"></a>
<a name="__line4555"></a>    hist::qplot&amp; hist::qplot::log(const int axis, const bool flag)
<a name="__line4556"></a>    {
<a name="__line4557"></a>        log_.push_back(std::pair&lt;int, double&gt;(axis, flag));
<a name="__line4558"></a>        isFlushed_=false;
<a name="__line4559"></a>        return *this;
<a name="__line4560"></a>    }
<a name="__line4561"></a>
<a name="__line4562"></a>
<a name="__line4563"></a>    hist::qplot&amp; hist::qplot::rangelog(const bool flag)
<a name="__line4564"></a>    {
<a name="__line4565"></a>        rangelog_.first=true; rangelog_.second=flag;
<a name="__line4566"></a>        isFlushed_=false;
<a name="__line4567"></a>        return *this;
<a name="__line4568"></a>    }
<a name="__line4569"></a>
<a name="__line4570"></a>
<a name="__line4571"></a>    hist::qplot&amp; hist::qplot::isolog(const bool flag)
<a name="__line4572"></a>    {
<a name="__line4573"></a>        isolog_.first=true; isolog_.second=flag;
<a name="__line4574"></a>        isFlushed_=false;
<a name="__line4575"></a>        return *this;
<a name="__line4576"></a>    }
<a name="__line4577"></a>
<a name="__line4578"></a>
<a name="__line4579"></a>    hist::qplot&amp; hist::qplot::operator&lt;&lt;(hist &amp;h)
<a name="__line4580"></a>    {
<a name="__line4581"></a>        if ( doubleplot_==true )
<a name="__line4582"></a>        {
<a name="__line4583"></a>            warning::print("Cannot append histogram in double-plot mode!", "hist::qplot&amp; hist::qplot::operator&lt;&lt;(hist&amp;)");
<a name="__line4584"></a>            isFlushed_=false;
<a name="__line4585"></a>            return *this;
<a name="__line4586"></a>        }
<a name="__line4587"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4588"></a>        isFlushed_=false;
<a name="__line4589"></a>        return *this;
<a name="__line4590"></a>    }
<a name="__line4591"></a>
<a name="__line4592"></a>
<a name="__line4593"></a>    hist::qplot&amp; hist::qplot::put(hist &amp;h)
<a name="__line4594"></a>    {
<a name="__line4595"></a>        if ( doubleplot_==true )
<a name="__line4596"></a>        {
<a name="__line4597"></a>            warning::print("Cannot append histogram in double-plot mode!", "hist::qplot&amp; hist::qplot::put(hist&amp;)");
<a name="__line4598"></a>            isFlushed_=false;
<a name="__line4599"></a>            return *this;
<a name="__line4600"></a>        }
<a name="__line4601"></a>        oStuff_.push_back(oStuff_t(&amp;h, unset, "__NULL"));
<a name="__line4602"></a>        isFlushed_=false;
<a name="__line4603"></a>        return *this;
<a name="__line4604"></a>    }
<a name="__line4605"></a>
<a name="__line4606"></a>
<a name="__line4607"></a>    hist::qplot&amp; hist::qplot::operator&lt;&lt;(const function &amp;f)
<a name="__line4608"></a>    {
<a name="__line4609"></a>        if ( doubleplot_==true )
<a name="__line4610"></a>        {
<a name="__line4611"></a>            warning::print("Cannot append function in double-plot mode!", "hist::qplot&amp; hist::qplot::operator&lt;&lt;(const function&amp;)");
<a name="__line4612"></a>            isFlushed_=false;
<a name="__line4613"></a>            return *this;
<a name="__line4614"></a>        }
<a name="__line4615"></a>        oStuff_.push_back(oStuff_t(NULL, f, "__NULL"));
<a name="__line4616"></a>        isFlushed_=false;
<a name="__line4617"></a>        return *this;
<a name="__line4618"></a>    }
<a name="__line4619"></a>
<a name="__line4620"></a>
<a name="__line4621"></a>    hist::qplot&amp; hist::qplot::operator&lt;&lt;(const var &amp;legend)
<a name="__line4622"></a>    {
<a name="__line4623"></a>        if ( doubleplot_==true )
<a name="__line4624"></a>        {
<a name="__line4625"></a>            warning::print("Cannot append function legend in double-plot mode!", "hist::qplot&amp; hist::qplot::operator&lt;&lt;(const var&amp;)");
<a name="__line4626"></a>            isFlushed_=false;
<a name="__line4627"></a>            return *this;
<a name="__line4628"></a>        }
<a name="__line4629"></a>        if ( oStuff_.empty() )
<a name="__line4630"></a>        {
<a name="__line4631"></a>            warning::print("Cannot append function legend: no function appended, yet!", "hist::qplot&amp; hist::qplot::operator&lt;&lt;(const var&amp;)");
<a name="__line4632"></a>            isFlushed_=false;
<a name="__line4633"></a>            return *this;
<a name="__line4634"></a>        }
<a name="__line4635"></a>        int i=oStuff_.size()-1;
<a name="__line4636"></a>        while ( i&gt;=0 ) { if ( oStuff_[i].h==NULL ) { break; } --i; }
<a name="__line4637"></a>        if ( i&lt;0 )
<a name="__line4638"></a>        {
<a name="__line4639"></a>            warning::print("Cannot append function legend: no function appended, yet!", "hist::qplot&amp; hist::qplot::operator&lt;&lt;(const var&amp;)");
<a name="__line4640"></a>            isFlushed_=false;
<a name="__line4641"></a>            return *this;
<a name="__line4642"></a>        }
<a name="__line4643"></a>        oStuff_[i].l=legend;
<a name="__line4644"></a>        isFlushed_=false;
<a name="__line4645"></a>        return *this;
<a name="__line4646"></a>    }
<a name="__line4647"></a>
<a name="__line4648"></a>
<a name="__line4649"></a>    hist::qplot&amp; hist::qplot::put(const function &amp;f, const var &amp;legend)
<a name="__line4650"></a>    {
<a name="__line4651"></a>        if ( doubleplot_==true )
<a name="__line4652"></a>        {
<a name="__line4653"></a>            warning::print("Cannot append function in double-plot mode!", "hist::qplot&amp; hist::qplot::put(const function&amp;)");
<a name="__line4654"></a>            isFlushed_=false;
<a name="__line4655"></a>            return *this;
<a name="__line4656"></a>        }
<a name="__line4657"></a>        oStuff_.push_back(oStuff_t(NULL, f, legend));
<a name="__line4658"></a>        isFlushed_=false;
<a name="__line4659"></a>        return *this;
<a name="__line4660"></a>    }
<a name="__line4661"></a>
<a name="__line4662"></a>
<a name="__line4663"></a>    color hist::qplot::color_sequence(const int i)
<a name="__line4664"></a>    {
<a name="__line4665"></a>        static color color_array[]={red, green, blue, magenta, cyan, sienna, orange, pink};
<a name="__line4666"></a>        return color_array[::abs(i)%8];
<a name="__line4667"></a>    }
<a name="__line4668"></a>
<a name="__line4669"></a>
<a name="__line4670"></a>    color hist::qplot::color_mapping(const double value, const double min, const double max)
<a name="__line4671"></a>    {
<a name="__line4672"></a>        const double d=(value-min)/(max-min);
<a name="__line4673"></a>        return color((::fabs(2.0*d-0.5)&gt;1.0 ? 1.0 : ::fabs(2.0*d-0.5)), ::sin(M_PI*d), ::cos(M_PI/2.0*d));
<a name="__line4674"></a>    }
<a name="__line4675"></a>
<a name="__line4676"></a>
<a name="__line4677"></a>    hist::qplot&amp; hist::qplot::flush()
<a name="__line4678"></a>    {
<a name="__line4679"></a>        int numStuff=oStuff_.size();
<a name="__line4680"></a>        if ( numStuff==0 )
<a name="__line4681"></a>        {
<a name="__line4682"></a>            warning::print("Empty plot!", "hist::qplot&amp; hist::qplot::flush()");
<a name="__line4683"></a>            isFlushed_=true;
<a name="__line4684"></a>            return *this;
<a name="__line4685"></a>        }
<a name="__line4686"></a>        int k;
<a name="__line4687"></a>        int dim=0;
<a name="__line4688"></a>        for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4689"></a>        {
<a name="__line4690"></a>            if ( oStuff_[k].h!=NULL )
<a name="__line4691"></a>            {
<a name="__line4692"></a>                if ( k!=0 &amp;&amp; oStuff_[k].h-&gt;dim_!=dim )
<a name="__line4693"></a>                {
<a name="__line4694"></a>                    warning::print("Dimensions of histograms do not match!", "hist::qplot&amp; hist::qplot::flush()");
<a name="__line4695"></a>                    isFlushed_=true;
<a name="__line4696"></a>                    return *this;
<a name="__line4697"></a>                }
<a name="__line4698"></a>                dim=oStuff_[k].h-&gt;dim_;
<a name="__line4699"></a>            }
<a name="__line4700"></a>            else
<a name="__line4701"></a>            {
<a name="__line4702"></a>                if ( k!=0 &amp;&amp; oStuff_[k].f.nargs()!=dim )
<a name="__line4703"></a>                {
<a name="__line4704"></a>                    warning::print("Argument number of functions do not match!", "hist::qplot&amp; hist::qplot::flush()");
<a name="__line4705"></a>                    isFlushed_=true;
<a name="__line4706"></a>                    return *this;
<a name="__line4707"></a>                }
<a name="__line4708"></a>                dim=oStuff_[k].f.nargs();
<a name="__line4709"></a>            }
<a name="__line4710"></a>            if ( dim&lt;1 || dim&gt;3 )
<a name="__line4711"></a>            {
<a name="__line4712"></a>                warning::print("Dimension has to be 1, 2, or 3 !", "hist::qplot&amp; hist::qplot::flush()");
<a name="__line4713"></a>                isFlushed_=true;
<a name="__line4714"></a>                return *this;
<a name="__line4715"></a>            }
<a name="__line4716"></a>        }
<a name="__line4717"></a>        int j;
<a name="__line4718"></a>        if ( globaltitle_.str()!="__NULL" ) frame::current().title(globaltitle_);
<a name="__line4719"></a>        if ( dim==1 )
<a name="__line4720"></a>        {
<a name="__line4721"></a>            for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line4722"></a>            {
<a name="__line4723"></a>                if ( min_[j].first==1 ) frame::current().x1axis()-&gt;min(min_[j].second);
<a name="__line4724"></a>            }
<a name="__line4725"></a>            for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line4726"></a>            {
<a name="__line4727"></a>                if ( max_[j].first==1 ) frame::current().x1axis()-&gt;max(max_[j].second);
<a name="__line4728"></a>            }
<a name="__line4729"></a>            if ( rangemin_.first==true ) frame::current().y1axis()-&gt;min(rangemin_.second);
<a name="__line4730"></a>            if ( rangemax_.first==true ) frame::current().y1axis()-&gt;max(rangemax_.second);
<a name="__line4731"></a>            bool switchlinx=false;
<a name="__line4732"></a>            for ( j=0 ; j&lt;(int)log_.size() ; ++j )
<a name="__line4733"></a>            {
<a name="__line4734"></a>                if ( log_[j].first==1 ) { frame::current().x1axis()-&gt;logscale(log_[j].second); switchlinx=true; }
<a name="__line4735"></a>            }
<a name="__line4736"></a>            bool switchliny=false;
<a name="__line4737"></a>            if ( rangelog_.first==true ) { frame::current().y1axis()-&gt;logscale(rangelog_.second); switchliny=true; }
<a name="__line4738"></a>            int iok=-1;
<a name="__line4739"></a>            for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4740"></a>            {
<a name="__line4741"></a>                if ( oStuff_[k].h!=NULL ) { iok=k; break; }
<a name="__line4742"></a>            }
<a name="__line4743"></a>            if ( iok&gt;=0 )
<a name="__line4744"></a>            {
<a name="__line4745"></a>                if ( oStuff_[iok].h-&gt;axistitle_[0].str()!="" ) frame::current().x1axis()-&gt;title(oStuff_[iok].h-&gt;axistitle_[0]);
<a name="__line4746"></a>                if ( oStuff_[iok].h-&gt;rangetitle_.str()!="" ) frame::current().y1axis()-&gt;title(oStuff_[iok].h-&gt;rangetitle_);
<a name="__line4747"></a>            }
<a name="__line4748"></a>            std::vector&lt;fgraph&gt; fg;
<a name="__line4749"></a>            for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4750"></a>            {
<a name="__line4751"></a>                if ( oStuff_[k].h!=NULL )
<a name="__line4752"></a>                {
<a name="__line4753"></a>                    oStuff_[k].h-&gt;drawstyle(sxyerrorbars().clip_errorbars(true));
<a name="__line4754"></a>                    oStuff_[k].h-&gt;allcolor(color_sequence(k));
<a name="__line4755"></a>                    oStuff_[k].h-&gt;pointtype(fsquare());
<a name="__line4756"></a>                    frame::current().add(oStuff_[k].h);
<a name="__line4757"></a>                }
<a name="__line4758"></a>                else
<a name="__line4759"></a>                {
<a name="__line4760"></a>                    fg.push_back(function(_1, oStuff_[k].f(_1)));
<a name="__line4761"></a>                    fg[fg.size()-1].drawstyle(lines());
<a name="__line4762"></a>                    fg[fg.size()-1].allcolor(color_sequence(k));
<a name="__line4763"></a>                    if ( oStuff_[k].l.str()!="__NULL" ) fg[fg.size()-1].legend(oStuff_[k].l);
<a name="__line4764"></a>                    frame::current().add(&amp;fg[fg.size()-1]);
<a name="__line4765"></a>                }
<a name="__line4766"></a>            }
<a name="__line4767"></a>            if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line4768"></a>            else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_);
<a name="__line4769"></a>            else x11_ps::print();
<a name="__line4770"></a>            frame::current().clear_graphs();
<a name="__line4771"></a>            frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line4772"></a>            frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line4773"></a>            frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line4774"></a>            frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line4775"></a>            if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line4776"></a>            if ( switchliny ) { frame::current().y1axis()-&gt;logscale(false); }
<a name="__line4777"></a>        }
<a name="__line4778"></a>        else if ( dim==2 )
<a name="__line4779"></a>        {
<a name="__line4780"></a>            for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line4781"></a>            {
<a name="__line4782"></a>                if ( min_[j].first==1 ) frame::current().x1axis()-&gt;min(min_[j].second);
<a name="__line4783"></a>                if ( min_[j].first==2 ) frame::current().y1axis()-&gt;min(min_[j].second);
<a name="__line4784"></a>            }
<a name="__line4785"></a>            for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line4786"></a>            {
<a name="__line4787"></a>                if ( max_[j].first==1 ) frame::current().x1axis()-&gt;max(max_[j].second);
<a name="__line4788"></a>                if ( max_[j].first==2 ) frame::current().y1axis()-&gt;max(max_[j].second);
<a name="__line4789"></a>            }
<a name="__line4790"></a>            bool switchlinx=false, switchliny=false;
<a name="__line4791"></a>            for ( j=0 ; j&lt;(int)log_.size() ; ++j )
<a name="__line4792"></a>            {
<a name="__line4793"></a>                if ( log_[j].first==1 ) { frame::current().x1axis()-&gt;logscale(log_[j].second); switchlinx=true; }
<a name="__line4794"></a>                if ( log_[j].first==2 ) { frame::current().y1axis()-&gt;logscale(log_[j].second); switchliny=true; }
<a name="__line4795"></a>            }
<a name="__line4796"></a>            int iok=-1;
<a name="__line4797"></a>            for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4798"></a>            {
<a name="__line4799"></a>                if ( oStuff_[k].h!=NULL ) { iok=k; break; }
<a name="__line4800"></a>            }
<a name="__line4801"></a>            if ( iok&gt;=0 )
<a name="__line4802"></a>            {
<a name="__line4803"></a>                if ( oStuff_[iok].h-&gt;axistitle_[0].str()!="" ) frame::current().x1axis()-&gt;title(oStuff_[iok].h-&gt;axistitle_[0]);
<a name="__line4804"></a>                if ( oStuff_[iok].h-&gt;axistitle_[1].str()!="" ) frame::current().y1axis()-&gt;title(oStuff_[iok].h-&gt;axistitle_[1]);
<a name="__line4805"></a>            }
<a name="__line4806"></a>            double rmin, rmax;
<a name="__line4807"></a>            bool rlog;
<a name="__line4808"></a>            if ( rangemin_.first==true ) rmin=rangemin_.second; else rmin=unset;
<a name="__line4809"></a>            if ( rangemax_.first==true ) rmax=rangemax_.second; else rmax=unset;
<a name="__line4810"></a>            if ( rangelog_.first==true) rlog=rangelog_.second; else rlog=false;
<a name="__line4811"></a>            double cmin, cmax;
<a name="__line4812"></a>            bool clog;
<a name="__line4813"></a>            if ( isomin_.first==true ) cmin=isomin_.second; else cmin=unset;
<a name="__line4814"></a>            if ( isomax_.first==true ) cmax=isomax_.second; else cmax=unset;
<a name="__line4815"></a>            if ( isolog_.first==true) clog=isolog_.second; else clog=false;
<a name="__line4816"></a>            if ( doubleplot_==false )
<a name="__line4817"></a>            {
<a name="__line4818"></a>                for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4819"></a>                {
<a name="__line4820"></a>                    fgraph *fg=0;
<a name="__line4821"></a>                    if ( oStuff_[k].h!=NULL )
<a name="__line4822"></a>                    {
<a name="__line4823"></a>                        if ( oStuff_[k].h-&gt;rangetitle_.str()!="" ) oStuff_[k].h-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).title(oStuff_[k].h-&gt;rangetitle_).grid_foreground(true).color_logscale(rlog));
<a name="__line4824"></a>                        else oStuff_[k].h-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line4825"></a>                        frame::current().add(oStuff_[k].h);
<a name="__line4826"></a>                    }
<a name="__line4827"></a>                    else
<a name="__line4828"></a>                    {
<a name="__line4829"></a>                        if ( fg!=0 ) { delete fg; fg=0; }
<a name="__line4830"></a>                        fg=new fgraph(function(_1, _2, oStuff_[k].f(_1, _2)));
<a name="__line4831"></a>                        fg-&gt;drawstyle(cboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line4832"></a>                        if ( oStuff_[k].l.str()!="__NULL" ) fg-&gt;legend(oStuff_[k].l);
<a name="__line4833"></a>                        frame::current().add(fg);
<a name="__line4834"></a>                    }
<a name="__line4835"></a>                    if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line4836"></a>                    else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_&amp;k);
<a name="__line4837"></a>                    else
<a name="__line4838"></a>                    {
<a name="__line4839"></a>                        x11_ps::print();
<a name="__line4840"></a>                        if ( k&lt;numStuff-1 )
<a name="__line4841"></a>                        {
<a name="__line4842"></a>                            std::cerr &lt;&lt; "Press ENTER for next plot.\n";
<a name="__line4843"></a>                            std::string buff;
<a name="__line4844"></a>                            std::getline(std::cin, buff);
<a name="__line4845"></a>                        }
<a name="__line4846"></a>                    }
<a name="__line4847"></a>                    frame::current().clear_graphs();
<a name="__line4848"></a>                    if ( fg!=0 ) { delete fg; fg=0; }
<a name="__line4849"></a>                    frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line4850"></a>                    frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line4851"></a>                    frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line4852"></a>                    frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line4853"></a>                }
<a name="__line4854"></a>                if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line4855"></a>                if ( switchliny ) frame::current().y1axis()-&gt;logscale(false);
<a name="__line4856"></a>            }
<a name="__line4857"></a>            else
<a name="__line4858"></a>            {
<a name="__line4859"></a>                fgraph *fg0=0;
<a name="__line4860"></a>                fgraph *fg1=0;
<a name="__line4861"></a>                for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4862"></a>                {
<a name="__line4863"></a>                    if ( oStuff_[k].h!=NULL )
<a name="__line4864"></a>                    {		    
<a name="__line4865"></a>                        if ( k==0 )
<a name="__line4866"></a>                        {
<a name="__line4867"></a>                            if ( oStuff_[k].h-&gt;rangetitle_.str()!="" ) oStuff_[k].h-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).title(oStuff_[k].h-&gt;rangetitle_).grid_foreground(true).color_logscale(rlog));
<a name="__line4868"></a>                            else oStuff_[k].h-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line4869"></a>                        }
<a name="__line4870"></a>                        else
<a name="__line4871"></a>                        {
<a name="__line4872"></a>                            if ( oStuff_[k].h-&gt;rangetitle_.str()!="" )
<a name="__line4873"></a>                                oStuff_[k].h-&gt;drawstyle(isolines().min(cmin).max(cmax)
<a name="__line4874"></a>                                                        <span class=comment>//.title(oStuff_[k].h-&gt;rangetitle_)</span>
<a name="__line4875"></a>                                                        .logscale(clog));
<a name="__line4876"></a>                            else oStuff_[k].h-&gt;drawstyle(isolines().min(cmin).max(cmax)
<a name="__line4877"></a>                                                         .logscale(clog));
<a name="__line4878"></a>                        }
<a name="__line4879"></a>                        frame::current().add(oStuff_[k].h);
<a name="__line4880"></a>                    }
<a name="__line4881"></a>                    else
<a name="__line4882"></a>                    {
<a name="__line4883"></a>                        if ( k==0 )
<a name="__line4884"></a>                        {
<a name="__line4885"></a>                            if ( fg0!=0 ) { delete fg0 ; fg0=0; }
<a name="__line4886"></a>                            fg0=new fgraph(function(_1, _2, oStuff_[k].f(_1, _2)));
<a name="__line4887"></a>                            fg0-&gt;drawstyle(cboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line4888"></a>                            if ( oStuff_[k].l.str()!="__NULL" ) fg0-&gt;legend(oStuff_[k].l);
<a name="__line4889"></a>                            frame::current().add(fg0);
<a name="__line4890"></a>                        }
<a name="__line4891"></a>                        else
<a name="__line4892"></a>                        {
<a name="__line4893"></a>                            if ( fg1!=0 ) { delete fg1 ; fg1=0; }
<a name="__line4894"></a>                            fg1=new fgraph(function(_1, _2, oStuff_[k].f(_1, _2)));
<a name="__line4895"></a>                            fg1-&gt;drawstyle(isolines().min(cmin).max(cmax).logscale(clog));
<a name="__line4896"></a>                            if ( oStuff_[k].l.str()!="__NULL" ) fg1-&gt;legend(oStuff_[k].l);
<a name="__line4897"></a>                            frame::current().add(fg1);
<a name="__line4898"></a>                        }
<a name="__line4899"></a>                    }
<a name="__line4900"></a>                }
<a name="__line4901"></a>                if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line4902"></a>                else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_);
<a name="__line4903"></a>                else x11_ps::print();
<a name="__line4904"></a>                frame::current().clear_graphs();
<a name="__line4905"></a>                if ( fg0!=0 ) { delete fg0; fg0=0; }
<a name="__line4906"></a>                if ( fg1!=0 ) { delete fg1; fg1=0; }
<a name="__line4907"></a>                frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line4908"></a>                frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line4909"></a>                frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line4910"></a>                frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line4911"></a>                if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line4912"></a>                if ( switchliny ) frame::current().y1axis()-&gt;logscale(false);
<a name="__line4913"></a>            }
<a name="__line4914"></a>        }
<a name="__line4915"></a>        else if ( dim==3)
<a name="__line4916"></a>        {
<a name="__line4917"></a>            for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line4918"></a>            {
<a name="__line4919"></a>                if ( min_[j].first==2 ) frame::current().x1axis()-&gt;min(min_[j].second);
<a name="__line4920"></a>                if ( min_[j].first==3 ) frame::current().y1axis()-&gt;min(min_[j].second);
<a name="__line4921"></a>            }
<a name="__line4922"></a>            for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line4923"></a>            {
<a name="__line4924"></a>                if ( max_[j].first==2 ) frame::current().x1axis()-&gt;max(max_[j].second);
<a name="__line4925"></a>                if ( max_[j].first==3 ) frame::current().y1axis()-&gt;max(max_[j].second);
<a name="__line4926"></a>            }
<a name="__line4927"></a>            bool switchlinx=false, switchliny=false;
<a name="__line4928"></a>            for ( j=0 ; j&lt;(int)log_.size() ; ++j )
<a name="__line4929"></a>            {
<a name="__line4930"></a>                if ( log_[j].first==2 ) { frame::current().x1axis()-&gt;logscale(log_[j].second); switchlinx=true; }
<a name="__line4931"></a>                if ( log_[j].first==3 ) { frame::current().y1axis()-&gt;logscale(log_[j].second); switchliny=true; }
<a name="__line4932"></a>            }
<a name="__line4933"></a>            int iok=-1;
<a name="__line4934"></a>            for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4935"></a>            {
<a name="__line4936"></a>                if ( oStuff_[k].h!=NULL ) { iok=k; break; }
<a name="__line4937"></a>            }
<a name="__line4938"></a>            if ( iok&gt;=0 )
<a name="__line4939"></a>            {
<a name="__line4940"></a>                if ( oStuff_[iok].h-&gt;axistitle_[1].str()!="" ) frame::current().x1axis()-&gt;title(oStuff_[iok].h-&gt;axistitle_[1]);
<a name="__line4941"></a>                if ( oStuff_[iok].h-&gt;axistitle_[2].str()!="" ) frame::current().y1axis()-&gt;title(oStuff_[iok].h-&gt;axistitle_[2]);
<a name="__line4942"></a>            }
<a name="__line4943"></a>            double rmin, rmax;
<a name="__line4944"></a>            bool rlog;
<a name="__line4945"></a>            if ( rangemin_.first==true ) rmin=rangemin_.second; else rmin=unset;
<a name="__line4946"></a>            if ( rangemax_.first==true ) rmax=rangemax_.second; else rmax=unset;
<a name="__line4947"></a>            if ( rangelog_.first==true) rlog=rangelog_.second; else rlog=false;
<a name="__line4948"></a>            double cmin, cmax;
<a name="__line4949"></a>            bool clog;
<a name="__line4950"></a>            if ( isomin_.first==true ) cmin=isomin_.second; else cmin=unset;
<a name="__line4951"></a>            if ( isomax_.first==true ) cmax=isomax_.second; else cmax=unset;
<a name="__line4952"></a>            if ( isolog_.first==true) clog=isolog_.second; else clog=false;
<a name="__line4953"></a>            if ( doubleplot_==false )
<a name="__line4954"></a>            {
<a name="__line4955"></a>                for ( k=0 ; k&lt;numStuff ; ++k )
<a name="__line4956"></a>                {
<a name="__line4957"></a>                    if ( oStuff_[k].h!=NULL )
<a name="__line4958"></a>                    {
<a name="__line4959"></a>                        for ( int i=0 ; i&lt;oStuff_[k].h-&gt;bins_[0] ; ++i )
<a name="__line4960"></a>                        {
<a name="__line4961"></a>                            double pos=(oStuff_[k].h-&gt;max_[0]-oStuff_[k].h-&gt;min_[0])/oStuff_[k].h-&gt;bins_[0]*(i+0.5)+oStuff_[k].h-&gt;min_[0];
<a name="__line4962"></a>                            bool skip=false;
<a name="__line4963"></a>                            for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line4964"></a>                            {
<a name="__line4965"></a>                                if ( min_[j].first==1 ) if ( pos&lt;min_[j].second ) { skip=true; break; }
<a name="__line4966"></a>                            }
<a name="__line4967"></a>                            if ( skip==true ) continue;
<a name="__line4968"></a>                            for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line4969"></a>                            {
<a name="__line4970"></a>                                if ( max_[j].first==1 ) if ( pos&gt;max_[j].second ) { skip=true; break; }
<a name="__line4971"></a>                            }
<a name="__line4972"></a>                            if ( skip==true ) continue;
<a name="__line4973"></a>                            hist *ohist=new hist(oStuff_[k].h-&gt;slice(1, pos));
<a name="__line4974"></a>                            ohist-&gt;legend_=oStuff_[k].h-&gt;legend_&amp;" at axis("&amp;1&amp;")="&amp;pos;
<a name="__line4975"></a>                            if ( oStuff_[k].h-&gt;rangetitle_.str()!="" ) ohist-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).title(oStuff_[k].h-&gt;rangetitle_).grid_foreground(true).color_logscale(rlog));
<a name="__line4976"></a>                            else ohist-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line4977"></a>                            frame::current().add(ohist);
<a name="__line4978"></a>                            if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line4979"></a>                            else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_&amp;k);
<a name="__line4980"></a>                            else
<a name="__line4981"></a>                            {
<a name="__line4982"></a>                                x11_ps::print();
<a name="__line4983"></a>                                if ( k&lt;numStuff-1 || i&lt;oStuff_[k].h-&gt;bins_[0]-1 )
<a name="__line4984"></a>                                {
<a name="__line4985"></a>                                    std::cerr &lt;&lt; "Press ENTER for next plot.\n";
<a name="__line4986"></a>                                    std::string buff;
<a name="__line4987"></a>                                    std::getline(std::cin, buff);
<a name="__line4988"></a>                                }
<a name="__line4989"></a>                            }
<a name="__line4990"></a>                            frame::current().clear_graphs();
<a name="__line4991"></a>                            delete ohist; ohist=0;
<a name="__line4992"></a>                            frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line4993"></a>                            frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line4994"></a>                            frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line4995"></a>                            frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line4996"></a>                        }
<a name="__line4997"></a>                    }
<a name="__line4998"></a>                    else
<a name="__line4999"></a>                    {
<a name="__line5000"></a>                        int bins0=10;
<a name="__line5001"></a>                        double defmin=0.0, defmax=10.0;
<a name="__line5002"></a>                        for ( int i=0 ; i&lt;bins0 ; ++i )
<a name="__line5003"></a>                        {
<a name="__line5004"></a>                            double pos, min=unset, max=unset;
<a name="__line5005"></a>                            for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line5006"></a>                            {
<a name="__line5007"></a>                                if ( min_[j].first==1 ) min=min_[j].second;
<a name="__line5008"></a>                            }
<a name="__line5009"></a>                            for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line5010"></a>                            {
<a name="__line5011"></a>                                if ( max_[j].first==1 ) max=max_[j].second;
<a name="__line5012"></a>                            }
<a name="__line5013"></a>                            if ( min==unset &amp;&amp; max==unset ) { min=defmin; max=defmax; }
<a name="__line5014"></a>                            else if ( min==unset &amp;&amp; max!=unset ) { min=max-(defmax-defmin); }
<a name="__line5015"></a>                            else if ( min!=unset &amp;&amp; max==unset ) { max=min+(defmax-defmin); }
<a name="__line5016"></a>                            pos=(max-min)/bins0*(i+0.5)+min;
<a name="__line5017"></a>                            fgraph *ofunc=new fgraph(function(_1, _2, oStuff_[k].f(function(pos), _1, _2)));
<a name="__line5018"></a>                            if ( oStuff_[k].l.str()!="__NULL" ) ofunc-&gt;legend(oStuff_[k].l&amp;" at axis("&amp;1&amp;")="&amp;pos);
<a name="__line5019"></a>                            ofunc-&gt;drawstyle(cboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line5020"></a>                            frame::current().add(ofunc);
<a name="__line5021"></a>                            if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line5022"></a>                            else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_&amp;k);
<a name="__line5023"></a>                            else
<a name="__line5024"></a>                            {
<a name="__line5025"></a>                                x11_ps::print();
<a name="__line5026"></a>                                if ( k&lt;numStuff-1 || i&lt;bins0-1 )
<a name="__line5027"></a>                                {
<a name="__line5028"></a>                                    std::cerr &lt;&lt; "Press ENTER for next plot.\n";
<a name="__line5029"></a>                                    std::string buff;
<a name="__line5030"></a>                                    std::getline(std::cin, buff);
<a name="__line5031"></a>                                }
<a name="__line5032"></a>                            }
<a name="__line5033"></a>                            frame::current().clear_graphs();
<a name="__line5034"></a>                            delete ofunc; ofunc=0;
<a name="__line5035"></a>                            frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line5036"></a>                            frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line5037"></a>                            frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line5038"></a>                            frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line5039"></a>                        }
<a name="__line5040"></a>                    }
<a name="__line5041"></a>                }
<a name="__line5042"></a>                if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line5043"></a>                if ( switchliny ) frame::current().y1axis()-&gt;logscale(false);
<a name="__line5044"></a>            }
<a name="__line5045"></a>            else
<a name="__line5046"></a>            {
<a name="__line5047"></a>                if ( oStuff_[0].h!=NULL || oStuff_[1].h!=NULL )
<a name="__line5048"></a>                {
<a name="__line5049"></a>                    int kok=0;
<a name="__line5050"></a>                    int kother=1;
<a name="__line5051"></a>                    if ( oStuff_[0].h!=NULL ) { kok=0; kother=1; }
<a name="__line5052"></a>                    else { kok=1; kother=0; }
<a name="__line5053"></a>                    for ( int i=0 ; i&lt;oStuff_[kok].h-&gt;bins_[0] ; ++i )
<a name="__line5054"></a>                    {
<a name="__line5055"></a>                        double pos=(oStuff_[kok].h-&gt;max_[0]-oStuff_[kok].h-&gt;min_[0])/oStuff_[kok].h-&gt;bins_[0]*(i+0.5)+oStuff_[kok].h-&gt;min_[0];
<a name="__line5056"></a>                        bool skip=false;
<a name="__line5057"></a>                        for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line5058"></a>                        {
<a name="__line5059"></a>                            if ( min_[j].first==1 ) if ( pos&lt;min_[j].second ) { skip=true; break; }
<a name="__line5060"></a>                        }
<a name="__line5061"></a>                        if ( skip==true ) continue;
<a name="__line5062"></a>                        for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line5063"></a>                        {
<a name="__line5064"></a>                            if ( max_[j].first==1 ) if ( pos&gt;max_[j].second ) { skip=true; break; }
<a name="__line5065"></a>                        }
<a name="__line5066"></a>                        if ( skip==true ) continue;
<a name="__line5067"></a>                        hist *ohist=new hist(oStuff_[kok].h-&gt;slice(1, pos));
<a name="__line5068"></a>                        ohist-&gt;legend_=oStuff_[kok].h-&gt;legend_&amp;" at axis("&amp;1&amp;")="&amp;pos;
<a name="__line5069"></a>                        if ( kok==0 )
<a name="__line5070"></a>                        {
<a name="__line5071"></a>                            if ( oStuff_[kok].h-&gt;rangetitle_.str()!="" ) ohist-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).title(oStuff_[kok].h-&gt;rangetitle_).grid_foreground(true).color_logscale(rlog));
<a name="__line5072"></a>                            else ohist-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line5073"></a>                        }
<a name="__line5074"></a>                        else
<a name="__line5075"></a>                        {
<a name="__line5076"></a>                            if ( oStuff_[kok].h-&gt;rangetitle_.str()!="" )
<a name="__line5077"></a>                                ohist-&gt;drawstyle(isolines().min(cmin).max(cmax)
<a name="__line5078"></a>                                                 <span class=comment>//.title(oStuff_[kok].h-&gt;rangetitle_)</span>
<a name="__line5079"></a>                                                 .logscale(clog));
<a name="__line5080"></a>                            else ohist-&gt;drawstyle(isolines().min(cmin).max(cmax).logscale(clog));
<a name="__line5081"></a>                        }
<a name="__line5082"></a>                        hist *ohistother=0;
<a name="__line5083"></a>                        hist *ofuncother=0;
<a name="__line5084"></a>                        if ( oStuff_[kother].h!=NULL )
<a name="__line5085"></a>                        {
<a name="__line5086"></a>                            hist *ohistother=new hist(oStuff_[kother].h-&gt;slice(1, pos));
<a name="__line5087"></a>                            ohistother-&gt;legend_=oStuff_[kother].h-&gt;legend_&amp;" at axis("&amp;1&amp;")="&amp;pos;
<a name="__line5088"></a>                            if ( kother==0 )
<a name="__line5089"></a>                            {
<a name="__line5090"></a>                                if ( oStuff_[kother].h-&gt;rangetitle_.str()!="" ) ohistother-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).title(oStuff_[kother].h-&gt;rangetitle_).grid_foreground(true).color_logscale(rlog));
<a name="__line5091"></a>                                else ohistother-&gt;drawstyle(csboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line5092"></a>                            }
<a name="__line5093"></a>                            else
<a name="__line5094"></a>                            {
<a name="__line5095"></a>                                if ( oStuff_[kother].h-&gt;rangetitle_.str()!="" )
<a name="__line5096"></a>                                    ohistother-&gt;drawstyle(isolines().min(cmin).max(cmax)
<a name="__line5097"></a>                                                          <span class=comment>//.title(oStuff_[kother].h-&gt;rangetitle_)</span>
<a name="__line5098"></a>                                                          .logscale(clog));
<a name="__line5099"></a>                                else ohistother-&gt;drawstyle(isolines().min(cmin).max(cmax).logscale(clog));
<a name="__line5100"></a>                            }
<a name="__line5101"></a>                        }
<a name="__line5102"></a>                        else
<a name="__line5103"></a>                        {
<a name="__line5104"></a>                            fgraph *ofuncother=new fgraph(function(_1, _2, oStuff_[kother].f(function(pos), _1, _2)));
<a name="__line5105"></a>                            if ( oStuff_[kother].l.str()!="__NULL" ) ofuncother-&gt;legend(oStuff_[kother].l&amp;" at axis("&amp;1&amp;")="&amp;pos);
<a name="__line5106"></a>                            if ( kother==0 )
<a name="__line5107"></a>                            {
<a name="__line5108"></a>                                ofuncother-&gt;drawstyle(cboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line5109"></a>                            }
<a name="__line5110"></a>                            else
<a name="__line5111"></a>                            {
<a name="__line5112"></a>                                ohistother-&gt;drawstyle(isolines().min(cmin).max(cmax).logscale(clog));
<a name="__line5113"></a>                            }
<a name="__line5114"></a>                        }
<a name="__line5115"></a>                        if ( kok==0 )
<a name="__line5116"></a>                        {
<a name="__line5117"></a>                            frame::current().add(ohist);
<a name="__line5118"></a>                            if ( ohistother!=0 ) frame::current().add(ohistother);
<a name="__line5119"></a>                            else frame::current().add(ofuncother);
<a name="__line5120"></a>                        }
<a name="__line5121"></a>                        else
<a name="__line5122"></a>                        {
<a name="__line5123"></a>                            if ( ohistother!=0 ) frame::current().add(ohistother);
<a name="__line5124"></a>                            else frame::current().add(ofuncother);
<a name="__line5125"></a>                            frame::current().add(ohist);
<a name="__line5126"></a>                        }
<a name="__line5127"></a>                        if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line5128"></a>                        else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_&amp;k);
<a name="__line5129"></a>                        else
<a name="__line5130"></a>                        {
<a name="__line5131"></a>                            x11_ps::print();
<a name="__line5132"></a>                            if ( i&lt;oStuff_[kok].h-&gt;bins_[0]-1 )
<a name="__line5133"></a>                            {
<a name="__line5134"></a>                                std::cerr &lt;&lt; "Press ENTER for next plot.\n";
<a name="__line5135"></a>                                std::string buff;
<a name="__line5136"></a>                                std::getline(std::cin, buff);
<a name="__line5137"></a>                            }
<a name="__line5138"></a>                        }
<a name="__line5139"></a>                        frame::current().clear_graphs();
<a name="__line5140"></a>                        delete ohist; ohist=0;
<a name="__line5141"></a>                        if ( ohistother!=0 ) { delete ohistother; ohistother=0; }
<a name="__line5142"></a>                        if ( ofuncother!=0 ) { delete ofuncother; ofuncother=0; }
<a name="__line5143"></a>                        frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line5144"></a>                        frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line5145"></a>                        frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line5146"></a>                        frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line5147"></a>                    }
<a name="__line5148"></a>                    if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line5149"></a>                    if ( switchliny ) frame::current().y1axis()-&gt;logscale(false);
<a name="__line5150"></a>                }
<a name="__line5151"></a>                else
<a name="__line5152"></a>                {
<a name="__line5153"></a>                    int bins0=10;
<a name="__line5154"></a>                    double defmin=0.0, defmax=10.0;
<a name="__line5155"></a>                    for ( int i=0 ; i&lt;bins0 ; ++i )
<a name="__line5156"></a>                    {
<a name="__line5157"></a>                        double pos, min=unset, max=unset;
<a name="__line5158"></a>                        for ( j=0 ; j&lt;(int)min_.size() ; ++j )
<a name="__line5159"></a>                        {
<a name="__line5160"></a>                            if ( min_[j].first==1 ) min=min_[j].second;
<a name="__line5161"></a>                        }
<a name="__line5162"></a>                        for ( j=0 ; j&lt;(int)max_.size() ; ++j )
<a name="__line5163"></a>                        {
<a name="__line5164"></a>                            if ( max_[j].first==1 ) max=max_[j].second;
<a name="__line5165"></a>                        }
<a name="__line5166"></a>                        if ( min==unset &amp;&amp; max==unset ) { min=defmin; max=defmax; }
<a name="__line5167"></a>                        else if ( min==unset &amp;&amp; max!=unset ) { min=max-(defmax-defmin); }
<a name="__line5168"></a>                        else if ( min!=unset &amp;&amp; max==unset ) { max=min+(defmax-defmin); }
<a name="__line5169"></a>                        pos=(max-min)/bins0*(i+0.5)+min;
<a name="__line5170"></a>                        fgraph *ofunc=new fgraph(function(_1, _2, oStuff_[0].f(function(pos), _1, _2)));
<a name="__line5171"></a>                        if ( oStuff_[0].l.str()!="__NULL" ) ofunc-&gt;legend(oStuff_[0].l&amp;" at axis("&amp;1&amp;")="&amp;pos);
<a name="__line5172"></a>                        ofunc-&gt;drawstyle(cboxes()(color_mapping)(rmin, rmax).grid_foreground(true).color_logscale(rlog));
<a name="__line5173"></a>                        frame::current().add(ofunc);
<a name="__line5174"></a>                        fgraph *ofuncother=new fgraph(function(_1, _2, oStuff_[1].f(function(pos), _1, _2)));
<a name="__line5175"></a>                        if ( oStuff_[1].l.str()!="__NULL" ) ofuncother-&gt;legend(oStuff_[1].l&amp;" at axis("&amp;1&amp;")="&amp;pos);
<a name="__line5176"></a>                        ofuncother-&gt;drawstyle(isolines().min(cmin).max(cmax).logscale(clog));
<a name="__line5177"></a>                        frame::current().add(ofuncother);
<a name="__line5178"></a>                        if ( blopMpps_!=NULL ) blopMpps_-&gt;print();
<a name="__line5179"></a>                        else if ( blopEpsName_.str()!="" ) blopeps::print(blopEpsName_&amp;k);
<a name="__line5180"></a>                        else
<a name="__line5181"></a>                        {
<a name="__line5182"></a>                            x11_ps::print();
<a name="__line5183"></a>                            if ( i&lt;bins0-1 )
<a name="__line5184"></a>                            {
<a name="__line5185"></a>                                std::cerr &lt;&lt; "Press ENTER for next plot.\n";
<a name="__line5186"></a>                                std::string buff;
<a name="__line5187"></a>                                std::getline(std::cin, buff);
<a name="__line5188"></a>                            }
<a name="__line5189"></a>                        }
<a name="__line5190"></a>                        frame::current().clear_graphs();
<a name="__line5191"></a>                        delete ofunc; ofunc=0;
<a name="__line5192"></a>                        delete ofuncother; ofuncother=0;
<a name="__line5193"></a>                        frame::current().x1axis()-&gt;clear_autosettings();
<a name="__line5194"></a>                        frame::current().x2axis()-&gt;clear_autosettings();
<a name="__line5195"></a>                        frame::current().y1axis()-&gt;clear_autosettings();
<a name="__line5196"></a>                        frame::current().y2axis()-&gt;clear_autosettings();
<a name="__line5197"></a>                    }
<a name="__line5198"></a>                    if ( switchlinx ) frame::current().x1axis()-&gt;logscale(false);
<a name="__line5199"></a>                    if ( switchliny ) frame::current().y1axis()-&gt;logscale(false);
<a name="__line5200"></a>                }
<a name="__line5201"></a>            }
<a name="__line5202"></a>        }
<a name="__line5203"></a>        isFlushed_=true;
<a name="__line5204"></a>        return *this;
<a name="__line5205"></a>    }
<a name="__line5206"></a>
<a name="__line5207"></a>
<a name="__line5208"></a>    hist::qplot::~qplot()
<a name="__line5209"></a>    {
<a name="__line5210"></a>        if ( isFlushed_==false ) flush();
<a name="__line5211"></a>    }
<a name="__line5212"></a>
<a name="__line5213"></a>
<a name="__line5214"></a>    hist&amp; mkhist(istream &amp;input, const histopt &amp;hopt)
<a name="__line5215"></a>    {
<a name="__line5216"></a>        hist *h=new hist(hopt);
<a name="__line5217"></a>        h-&gt;fill_from(input, hopt);
<a name="__line5218"></a>        return *h;
<a name="__line5219"></a>    }
<a name="__line5220"></a>
<a name="__line5221"></a>
<a name="__line5222"></a>    hist&amp; mkhist(const var &amp;filename, const histopt &amp;hopt)
<a name="__line5223"></a>    {
<a name="__line5224"></a>        hist *h=new hist(hopt);
<a name="__line5225"></a>        h-&gt;fill_from(filename, hopt);
<a name="__line5226"></a>        return *h;
<a name="__line5227"></a>    }
<a name="__line5228"></a>
<a name="__line5229"></a>
<a name="__line5230"></a>    hist&amp; mkhist(const dgraph &amp;dg, const histopt &amp;hopt)
<a name="__line5231"></a>    {
<a name="__line5232"></a>        hist *h=new hist(hopt);
<a name="__line5233"></a>        h-&gt;fill_from(dg, hopt);
<a name="__line5234"></a>        return *h;
<a name="__line5235"></a>    }
<a name="__line5236"></a>
<a name="__line5237"></a>
<a name="__line5238"></a>    hist&amp; histplot(istream &amp;input, const histopt &amp;hopt)
<a name="__line5239"></a>    {
<a name="__line5240"></a>        hist &amp;h=mkhist(input, hopt);
<a name="__line5241"></a>        h.autodel(true);
<a name="__line5242"></a>        frame::current().clear_graphs();
<a name="__line5243"></a>        frame::current().add(&amp;h);
<a name="__line5244"></a>        return h;
<a name="__line5245"></a>    }
<a name="__line5246"></a>
<a name="__line5247"></a>
<a name="__line5248"></a>    hist&amp; mhistplot(istream &amp;input, const histopt &amp;hopt)
<a name="__line5249"></a>    {
<a name="__line5250"></a>        hist &amp;h=mkhist(input, hopt);
<a name="__line5251"></a>        h.autodel(true);
<a name="__line5252"></a>        frame::current().add(&amp;h);
<a name="__line5253"></a>        return h;
<a name="__line5254"></a>    }
<a name="__line5255"></a>
<a name="__line5256"></a>
<a name="__line5257"></a>    hist&amp; histplot(const var &amp;filename, const histopt &amp;hopt)
<a name="__line5258"></a>    {
<a name="__line5259"></a>        hist &amp;h=mkhist(filename, hopt);
<a name="__line5260"></a>        h.autodel(true);
<a name="__line5261"></a>        frame::current().clear_graphs();
<a name="__line5262"></a>        frame::current().add(&amp;h);
<a name="__line5263"></a>        return h;
<a name="__line5264"></a>    }
<a name="__line5265"></a>
<a name="__line5266"></a>
<a name="__line5267"></a>    hist&amp; mhistplot(const var &amp;filename, const histopt &amp;hopt)
<a name="__line5268"></a>    {
<a name="__line5269"></a>        hist &amp;h=mkhist(filename, hopt);
<a name="__line5270"></a>        h.autodel(true);
<a name="__line5271"></a>        frame::current().add(&amp;h);
<a name="__line5272"></a>        return h;
<a name="__line5273"></a>    }
<a name="__line5274"></a>
<a name="__line5275"></a>
<a name="__line5276"></a>    hist&amp; histplot(const dgraph &amp;dg, const histopt &amp;hopt)
<a name="__line5277"></a>    {
<a name="__line5278"></a>        hist &amp;h=mkhist(dg, hopt);
<a name="__line5279"></a>        h.autodel(true);
<a name="__line5280"></a>        frame::current().clear_graphs();
<a name="__line5281"></a>        frame::current().add(&amp;h);
<a name="__line5282"></a>        return h;
<a name="__line5283"></a>    }
<a name="__line5284"></a>
<a name="__line5285"></a>
<a name="__line5286"></a>    hist&amp; mhistplot(const dgraph &amp;dg, const histopt &amp;hopt)
<a name="__line5287"></a>    {
<a name="__line5288"></a>        hist &amp;h=mkhist(dg, hopt);
<a name="__line5289"></a>        h.autodel(true);
<a name="__line5290"></a>        frame::current().add(&amp;h);
<a name="__line5291"></a>        return h;
<a name="__line5292"></a>    }
<a name="__line5293"></a>
<a name="__line5294"></a>
<a name="__line5295"></a>}
<a name="__line5296"></a>
<a name="__line5297"></a>
<a name="__line5298"></a>

</pre>
<hr> 
<a href="../index.html" title="Home"> 
<img src="../home.png"  style="border-width:0cm;"> 
</a>
<a href="source.html" title="List of sourcefiles"> 
<img src="../up.png"    style="border-width:0cm;"> 
</a>

</body></html>
